<h2 id="制作-archlinux-启动盘">制作 archlinux 启动盘</h2>

<p>  从 archlinux 官方或者是镜像源下载到 iso 文件，并使用以下命令制作启动U盘。</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">dd </span><span class="k">if</span><span class="o">=</span>image.iso <span class="nv">of</span><span class="o">=</span>/dev/sd[x]
</code></pre></div></div>

<h2 id="安装准备">安装准备</h2>

<p>电脑插入启动 U盘，并选择从 U盘 的 <strong>uefi</strong> 模式启动</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 键盘布局:</span>
loadkeys us

<span class="c"># 验证启动模式: </span>
<span class="nb">ls</span> /sys/firmware/efi/efivars
<span class="c"># 如果目录不存在，系统即为 BIOS 或 CSM 模式启动</span>

<span class="c"># 联网:</span>
ping <span class="nt">-c</span> 3 www.baidu.com

<span class="c"># 若发现网络不通，则使用以下命令停用dhcpcd进程</span>
systemctl stop dhcpcd

<span class="c"># 更新系统时间: </span>
timedatectl set-ntp <span class="nb">true</span>
<span class="c">#用`timedatectl status`检查服务状态</span>

<span class="c"># 建立硬盘分区:</span>
<span class="c"># 比如磁盘为 /dev/sda，则使用以下命令对磁盘进行操作；</span>
fdisk /dev/sda
<span class="c"># 首先使用 g 转换成 gpt 分区格式；</span>
<span class="c"># 其次使用 n 分别建立 512MB 的EFI分区和剩余硬盘大小的根目录分区</span>

<span class="c"># 挂载分区: </span>
mount /dev/sda2 /mnt
<span class="nb">mkdir</span> /mnt/boot
mount /dev/sda1 /mnt/boot
</code></pre></div></div>

<h2 id="安装">安装</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 选择镜像地址: 编辑 /etc/pacman.d/mirrorlist ，建议使用以下首选 mirror</span>
Server <span class="o">=</span> https://mirrors.shuosc.org/archlinux/<span class="nv">$repo</span>/os/<span class="nv">$arch</span>
Server <span class="o">=</span> https://mirrors.ustc.edu.cn/archlinux/<span class="nv">$repo</span>/os/<span class="nv">$arch</span>
<span class="c"># 安装基本系统及AUR: </span>
pacstrap /mnt base base-devel<span class="sb">`</span>
</code></pre></div></div>

<h2 id="配置系统">配置系统</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Fstab: </span>
genfstab <span class="nt">-U</span> /mnt <span class="o">&gt;&gt;</span> /mnt/etc/fstab

<span class="c"># Chroot: Change root到新的安装系统</span>
arch-chroot /mnt

<span class="c"># 时区: 使用以下命令设置时区及时间标准为 UTC</span>
<span class="nb">ln</span> <span class="nt">-sf</span> /usr/share/zoneinfo/Asia/Shanghai /etc/localtime
hwclock <span class="nt">--systohc</span> <span class="nt">--utc</span>

<span class="c"># Locale: 修改 /etc/locale.gen 文件，将所需语言前的注释删除，比如以下几个，再使用 locale-gen 生成locale配置文件，并提交默认语言</span>

en_US.UTF-8 UTF-8
zh_CN.UTF-8 UTF-8
zh_SG.UTF-8 UTF-8
zh_TW.UTF-8 UTF-8

locale-gen
<span class="nb">echo </span><span class="nv">LANG</span><span class="o">=</span>en_US.UTF-8 <span class="o">&gt;</span> /etc/locale.conf

<span class="c"># 主机名: 使用 echo arch &gt; /etc/hostname 设置主机名，并添加对应信息至 /etc/hosts，如下所示：</span>
127.0.1.1        arch.localdomain  <span class="nb">arch</span>

<span class="c"># 网络配置: 让 DHCP 服务开机自启动</span>
systemctl <span class="nb">enable </span>dhcpcd.service 
<span class="c"># 设置用户: 首先新增用户</span>

useradd username
passwd username
<span class="nb">mkdir</span> /home/username
<span class="nb">chown</span> <span class="nt">-R</span> username:username /home/username
<span class="c"># 然后往 /etc/sudoers 添加</span>
username <span class="nv">ALL</span><span class="o">=(</span>ALL<span class="o">)</span> NOPASSWD:ALL

<span class="c"># 安装引导程序: </span>
pacman <span class="nt">-S</span> grub os-prober efibootmgr dosfstools
grub-install <span class="nt">--target-x86_64-efi</span> <span class="nt">--efi-directory</span><span class="o">=</span>/boot <span class="nt">--bootloader-id</span><span class="o">=</span>grub <span class="nt">--recheck</span>
grub-mkconfig <span class="nt">-o</span> /boot/grub/grub.cfg
</code></pre></div></div>

<h2 id="其他配置">其他配置</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 配置显卡: </span>
pacman <span class="nt">-S</span> nvidia

<span class="c"># 删除`/etc/pacman.conf`中的`multilib`部分注释，</span>
pacman <span class="nt">-Syy</span>

<span class="c"># 刷新软件缓存</span>
pacman <span class="nt">-S</span> lib32-nvidia-utils

<span class="c"># 安装对应的基本库。</span>
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 安装 xorg</span>
pacman <span class="nt">-S</span> xorg
nvidia-xconfig

<span class="c"># 安装 gnome: </span>
pacman <span class="nt">-S</span> gnome gnome-extra
pacman <span class="nt">-S</span> gnome gdm
systemctl <span class="nb">enable </span>gdm
</code></pre></div></div>

<h2 id="重启">重启</h2>

<p>  重启之后从硬盘启动就会进入 gdm 登录界面，使用上面设置的 username 和密码登录即可，如果用户名和密码都正确无法登录，说明该用户未建立对应用户主目录，重新创建用户即可。</p>

<h2 id="参考资料">参考资料</h2>

<ul>
  <li><a href="https://wiki.archlinux.org/index.php/USB_flash_installation_media">Install_from_a_USB_flash_drive</a></li>
  <li><a href="https://wiki.archlinux.org/index.php/NVIDIA">NVIDIA</a></li>
</ul>
