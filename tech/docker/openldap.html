<h2 id="ldap-协议入门">LDAP 协议入门</h2>

<p>  LDAP 是一种通讯协议，支持 TCP/IP 。在这套标准下，有多种的实现方式，比如 <a href="https://www.openldap.org">OpenLDAP</a>、微软大佬的 AD (Active Directory)。拿 AD 来举例子，LDAP 有点像是数据库一样，但是又不完全是，读起来非常快、写起来慢一点。同时它也有 Server 端和 Client 端，其中 Server 端用来存放资源，Client 端用来操作增删改查等操作，即 AD = LDAP服务器 + LDAP 应用。</p>

<p>  与数据库不同的地方是，数据库是按照记录一条条存放在表中，而 LDAP 数据库是<strong>树结构</strong>的，数据存储在叶子节点上。下面举个例子来说明一下<strong>树结构</strong>上的一条记录是如何定义的。</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 描述：苹果是在树的东边那个分叉上的靠西边那个分叉的再靠北边的分叉上的半红半绿的。</span>

树 <span class="o">(</span><span class="nv">dc</span><span class="o">=</span>tree<span class="o">)</span>
分叉 <span class="o">(</span><span class="nv">ou</span><span class="o">=</span>bei,ou<span class="o">=</span>xi,ou<span class="o">=</span>dong<span class="o">)</span>
苹果 <span class="o">(</span><span class="nv">cn</span><span class="o">=</span>redApple<span class="o">)</span>

<span class="c"># 综合起来描述为</span>
dn:cn<span class="o">=</span>redApple,ou<span class="o">=</span>bei,ou<span class="o">=</span>xi,ou<span class="o">=</span>dong,dc<span class="o">=</span>tree
</code></pre></div></div>

<p>一个完整的 LDAP 树形结构数据库应包含以下几个因素：</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dn: 一条记录的详细位置
dc: 一条记录所属的区域<span class="o">(</span>即哪一棵树<span class="o">)</span>
ou: 一条记录所属的组织<span class="o">(</span>即哪一个分支<span class="o">)</span>
cn/uid: 一条记录的名字/ID <span class="o">(</span>即哪一个苹果名字<span class="o">)</span>
LDAP 目录树的最顶部就是根，也就是所谓的<span class="s2">"基准 DN"</span>
</code></pre></div></div>

<blockquote>
  <p>info “小提示”
为什么要用 LDAP 目录树来存储数据，用 MySQL 不行吗？<br />
  用树形结构存储数据，查询效率更高。在某些特定的场景下，使用树形数据库更理想。比如，需要存储大量的数据，而且数据不是经常更改的，需要很快速的查找。<br />
  把 LDAP 与传统的数据库相比，LDAP 除了快速查找的特点，它还有很多的运用场景，比如域验证等。</p>
</blockquote>

<h3 id="如何操作-ldap-服务器">如何操作 LDAP 服务器？</h3>

<p>  LDAP 服务器的客户端操作方式有很多种，常见的有 JDBC 、 JNDI 、 phpLDAPadmin 等。由于本人不怎么用 Java，所以首选 phpLDAPadmin 来进行实战操作。</p>

<h2 id="采用-docker-快速部署">采用 Docker 快速部署</h2>

<p>  其实在 Ubuntu 上安装 OpenLDAP 和 phpLDAPadmin 两个软件是比较简单的，使用 <code class="language-plaintext highlighter-rouge">sudo apt install openldap phpldapadmin -y</code> 即可完成，但是配置起来就有点小麻烦了，不大适合对 LDAP 没有深入了解的人使用，最简单的方式就是使用别人已经封装好的 Docker 镜像进行快速部署。docker-compose.yml 文件内容如下：</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">version</span><span class="pi">:</span> <span class="s1">'</span><span class="s">2'</span>

<span class="na">services</span><span class="pi">:</span>
    <span class="na">phpldapadmin</span><span class="pi">:</span>
      <span class="na">image</span><span class="pi">:</span> <span class="s">osixia/phpldapadmin</span>
      <span class="na">environment</span><span class="pi">:</span>
        <span class="na">PHPLDAPADMIN_LDAP_HOSTS</span><span class="pi">:</span> <span class="s">openldap</span>
      <span class="na">links</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">openldap</span>
      <span class="na">ports</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">6443:443</span>
      <span class="na">restart</span><span class="pi">:</span> <span class="s">always</span>
    <span class="na">openldap</span><span class="pi">:</span>
      <span class="na">image</span><span class="pi">:</span> <span class="s">osixia/openldap</span>
      <span class="na">environment</span><span class="pi">:</span>
        <span class="na">LDAP_ORGANISATION</span><span class="pi">:</span> <span class="s2">"</span><span class="s">example"</span>
        <span class="na">LDAP_DOMAIN</span><span class="pi">:</span> <span class="s">example.org</span>
        <span class="na">LDAP_ADMIN_PASSWORD</span><span class="pi">:</span> <span class="s">admin</span>
      <span class="na">volumes</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">./data/slapd/database:/var/lib/ldap</span>
        <span class="pi">-</span> <span class="s">./data/slapd/config:/etc/ldap/slapd.d</span>
      <span class="na">restart</span><span class="pi">:</span> <span class="s">always</span>
      <span class="na">ports</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">389:389</span>
        <span class="pi">-</span> <span class="s">689:689</span>
</code></pre></div></div>

<h2 id="访问">访问</h2>

<p>  安装完成之后使用 <code class="language-plaintext highlighter-rouge">https://localhost:6443</code> 即可访问 phpLDAPadmin ，Login DN 为 <code class="language-plaintext highlighter-rouge">cn=admin,dc=example,dc=org</code>，Password 为 <code class="language-plaintext highlighter-rouge">admin</code>。</p>

<h2 id="参考资料">参考资料</h2>

<ul>
  <li><a href="https://www.jianshu.com/p/7e4d99f6baaf">LDAP入门</a></li>
  <li><a href="https://lostfocus.de/2018/03/openldap-and-phpldapadmin-running-in-docker-containers/">OpenLDAP and phpLDAPadmin running in Docker containers</a></li>
</ul>
