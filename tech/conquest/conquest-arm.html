<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CONQUEST 编译安装指南 ARM 篇 - 仲儿的自留地</title>
    <meta name="author"  content="zhonger">
    <meta name="description" content="CONQUEST 编译安装指南 ARM 篇">
    <meta name="keywords"  content="CONQUEST, 量子化学, ARM">
    <!-- Open Graph -->
    <meta property="og:title" content="CONQUEST 编译安装指南 ARM 篇 - 仲儿的自留地">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://lisz.me/tech/conquest/conquest-arm.html">
    <meta property="og:description" content="个人的一个技术博客站点，主要用于记录个人在学习过程中遇到的技术问题及解决方法、技术实验，以及一些比较有趣的事情。">
    <meta property="og:site_name" content="仲儿的自留地">
    <link rel="Shortcut Icon" href="/assets/icons/favicon.ico">
    <link rel="bookmark" href="/assets/icons/favicon.ico" type="image/x-icon" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/normalize.min.css">
    <link rel="stylesheet" href="https://at.alicdn.com/t/font_roc50gemkxpw4s4i.css">
    <link rel="stylesheet" href="/assets/css/plugins.min.css">
    <link rel="preload" href="/assets/fonts/Merriweather-Regular.ttf" as="font" crossorigin=”anonymous”>
    <link rel="stylesheet" href="/assets/css/app.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" />
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-164207041-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-164207041-1');
    </script>
</head>
<body>
    <!--[if lt IE 10]>
<div class="alert-danger" role="alert">你的浏览器实在太太太旧了，放学别走，升级完浏览器再说！<a target="_blank" class="alert-link" href="http://browsehappy.com">立即升级</a></div>
<![endif]-->
<input id="nm-switch" type="hidden" value="false">

<header class="g-header">
    <div class="g-logo">
      <a href="/" aria-label="Homepage"></a>
    </div>
    <!-- <i id="menu-toggle" class="iconfont icon-menu"></i> -->
    <svg id="menu-toggle" class="icon-menu" aria-hidden="true">
        <use xlink:href="#icon-menu"></use>
    </svg>
    <nav class="g-nav">
        <ul>
            
            <li><a href="/">home</a></li>
            
            <li><a href="/blog/index.html">blog</a></li>
            
            <li><a href="/archives.html">archives</a></li>
            
            <li><a href="{"CONQUEST"=>"/tags.html#CONQUEST", "LDAP"=>"/tags.html#LDAP", "博客"=>"/tags.html#blog"}">collections</a></li>
            
            <li><a href="/tags.html">tags</a></li>
            
            <li><a href="{"logs"=>"/logs.html", "tos"=>"/tos.html", "RSS"=>"/feed.xml", "CV"=>"/cv.html", "links"=>"/links.html"}">about</a></li>
            
        </ul>
    </nav>
</header>


<header class="g-banner post-header post-pattern-food bgcolor-default " data-theme="default">
    <div class="post-wrapper">
        <div class="post-tags">
            
            
            <a href="/tags.html#CONQUEST" class="post-tag">CONQUEST</a>
            
            <a href="/tags.html#%E9%87%8F%E5%AD%90%E5%8C%96%E5%AD%A6" class="post-tag">量子化学</a>
            
            <a href="/tags.html#ARM" class="post-tag">ARM</a>
            
            
        </div>
        <h1>CONQUEST 编译安装指南 ARM 篇</h1>
        <div class="post-meta">
            <span class="post-meta-item"><i class="iconfont icon-author"></i><a href="https://lisz.me" target="_blank" rel="author">zhonger</a></span>
            <time class="post-meta-item" datetime="21-02-07"><i class="iconfont icon-date"></i>Sun, 07 Feb 2021 21:20:00 +0900</time>
        </div>
        <div class="post-meta">
            <span>本文总共 3563 字 <b>·</b> 阅读全文大约需要 11 分钟</span>
        </div>
    </div>
    
    <div class="filter"></div>
    <div class="post-cover" style="background: url('https://i.lisz.top/cover/YOgkDb.webp') center no-repeat; background-size: cover;">
    
</header>

<div class="post-content">
    
    <h2 class="post-subtitle">欢迎进入量子化学的世界</h2>
    
    <article class="markdown-body" id="lightgallery">
        <h2 id="前言">前言</h2>

<p>  随着近年来 AMD、Apple 等科技公司对于 ARM 芯片的研发技术的成熟，以 MacbookPro M1 为代表的 ARM 架构的普通 PC 开始进入市场。其实由于 ARM 的低功耗、高性能的优势，以 AWS、Azure 为首的云服务产商早已经推出了 ARM 服务器。当然，操作系统提供商们也对 ARM 架构的 CPU 进行了支持，比如 Ubuntu Server 就有 ARM 版本。还有像树莓派、路由器等这样的基于 ARM 芯片运行的小平台，都是 ARM 操作系统。截止现在为止，各种常用的软件、依赖库都相继支持 ARM 芯片，使得 ARM 版本的普通 PC、服务器也有了很大的发展势头。</p>

<p>  在去年12月份 MacbookPro M1 发布之后，笔者得到了一台 1台 由实验室购买的 13寸 定制版 MacbookPro M1。刚拿到手的时候，绝大多数的软件还未来得及支持，只有少数大厂进行了支持，比如 Chrome，VS code 开发版，Homebrew。由于想要在 M1 上编译安装 CONQUEST 来进行第一性原理计算，在网络上也没有找到相关资料，所以很是头疼。最开始的时候按照官网给的指南是需要安装 OpenMPI 等一系列依赖库，而笔者在 Mac 平台下习惯使用 Homebrew 来安装软件，一番调查下发现 OpenMPI 还没有发行 big_sur_arm 的安装包，于是无法安装。后来想着 Ubuntu ARM 系统是有 OpenMPI 支持的，就像是不是能运行一个 Ubuntu ARM 的虚拟机，在虚拟机里面编译安装。事实证明这种思路是行得通的，不过比较难搞的就是目前并没有完全支持 M1 的虚拟化软件，只有还在测试版的 Parallel 和 Docker。抱着试一试学一学的态度，我分别使用了这两款软件在 Ubuntu ARM 20.04 上进行了相关的编译安装测试。后来随着 OpenMPI 等依赖库开始支持 big_sur_arm 之后，笔者也在 M1 的物理机上做了相关的测试。以下为 Ubuntu ARM 和 M1 上的编译安装过程。</p>

<h2 id="ubuntu-arm">Ubuntu ARM</h2>

<p>  以下为 CONQUEST 所需的软件或依赖库列表：</p>

<table>
  <thead>
    <tr>
      <th>名称</th>
      <th>安装包名称</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>gcc</td>
      <td>gcc</td>
    </tr>
    <tr>
      <td>fortran</td>
      <td>gfortran</td>
    </tr>
    <tr>
      <td>openmpi</td>
      <td>openmpi-bin</td>
    </tr>
    <tr>
      <td>openmpi library</td>
      <td>libopenmpi-dev</td>
    </tr>
    <tr>
      <td>libxc library</td>
      <td>libxc-dev</td>
    </tr>
    <tr>
      <td>blas library</td>
      <td>libblas3 liblas-dev</td>
    </tr>
    <tr>
      <td>blapack library</td>
      <td>liblapack3 liblapack-dev libatlas-base-dev</td>
    </tr>
    <tr>
      <td>scalapack library</td>
      <td>libscalapack-mpi-dev libmlpack-dev</td>
    </tr>
    <tr>
      <td>fftw3 library</td>
      <td>fftw3 fftw3-dev pkg-config</td>
    </tr>
  </tbody>
</table>

<h3 id="安装依赖">安装依赖</h3>

<p>  使用以下命令安装上述软件或者依赖库。</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>apt update
<span class="nb">sudo </span>apt <span class="nb">install</span> <span class="nt">-y</span> git build-essential gcc gfortran openmpi-bin
<span class="nb">sudo </span>apt <span class="nb">install</span> <span class="nt">-y</span> libopenmpi-dev libxc-dev
<span class="nb">sudo </span>apt <span class="nb">install</span> <span class="nt">-y</span> libblas3 libblas-dev liblapack3 liblapack-dev libatlas-base-dev
<span class="nb">sudo </span>apt <span class="nb">install</span> <span class="nt">-y</span> libscalapack-mpi-dev libmlpack-dev
<span class="nb">sudo </span>apt <span class="nb">install</span> <span class="nt">-y</span> fftw3 fftw3-dev pkg-config
</code></pre></div></div>

<h3 id="编译-conquest">编译 CONQUEST</h3>

<p>  下载 CONQUEST 最新源代码：</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone https://github.com/OrderN/CONQUEST-release conquest
</code></pre></div></div>

<p>  修改 conquest/src/system.make 文件如下所示：</p>

<div class="language-ini highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># For Docker
</span>
<span class="c"># Set compilers
</span><span class="py">FC</span><span class="p">=</span><span class="s">mpif90</span>
<span class="py">F77</span><span class="p">=</span><span class="s">mpif77</span>

<span class="c"># Linking flags
</span><span class="py">LINKFLAGS</span><span class="p">=</span> <span class="s">-L/usr/local/lib</span>
<span class="py">ARFLAGS</span><span class="p">=</span>

<span class="c"># Compilation flags
</span><span class="py">COMPFLAGS</span><span class="p">=</span> <span class="s">-O3 $(XC_COMPFLAGS)</span>
<span class="py">COMPFLAGS_F77</span><span class="p">=</span> <span class="s">$(COMPFLAGS)</span>

<span class="c"># Set BLAS and LAPACK libraries
# BLAS= -lvecLibFort
</span><span class="py">BLAS</span><span class="p">=</span> <span class="s">-lblas -llapack</span>

<span class="c"># Full library call; remove scalapack if using dummy diag module
</span><span class="py">LIBS</span><span class="p">=</span> <span class="s">$(FFT_LIB) $(XC_LIB) -lscalapack-openmpi $(BLAS)</span>

<span class="c"># LibXC compatibility (LibXC below) or Conquest XC library
</span>
<span class="c"># Conquest XC library
</span><span class="py">XC_LIBRARY</span> <span class="p">=</span> <span class="s">CQ</span>
<span class="py">XC_LIB</span> <span class="p">=</span>
<span class="py">XC_COMPFLAGS</span> <span class="p">=</span>

<span class="c"># LibXC compatibility
# Choose old LibXC (v2.x) or modern versions
#XC_LIBRARY = LibXC_v2
#XC_LIBRARY = LibXC
#XC_LIB = -lxcf90 -lxc
#XC_COMPFLAGS = -I/usr/include
</span>
<span class="c"># Set FFT library
</span><span class="py">FFT_LIB</span><span class="p">=</span><span class="s">-lfftw3</span>
<span class="py">FFT_OBJ</span><span class="p">=</span><span class="s">fft_fftw3.o</span>

<span class="c"># Matrix multiplication kernel type
</span><span class="py">MULT_KERN</span> <span class="p">=</span> <span class="s">default</span>
<span class="c"># Use dummy DiagModule or not
</span><span class="py">DIAG_DUMMY</span> <span class="p">=</span>
</code></pre></div></div>

<p>  执行编译安装命令：</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd </span>conquest/src/
make clean <span class="o">&amp;&amp;</span> make
</code></pre></div></div>

<p>  执行成功后会在 conquest/bin/ 目录下生成 Conquest 可执行文件，具体使用请见 <a href="/tech/conquest-introduction">使用指南</a>。</p>

<blockquote>
  <p>info “小提示”
有一点有意思的事是，在 Ubuntu 平台下可能会出现无法寻找对应的依赖库的问题。解决这一问题比较好的办法是在所使用的 .bashrc 或者 .zshrc 文件里添加完整的 LIBRARY_PATH 和 LD_LIBRARY_PATH 配置。</p>
</blockquote>

<h2 id="m1">M1</h2>

<h3 id="安装依赖-1">安装依赖</h3>

<p>  M1 平台下的依赖库安装相对比较简单一点，直接使用 Homebrew 和以下命令即可一键式安装所需的所有依赖库和软件。M1 平台下的 Homebrew 的安装请移步 <a href="https://brew.sh/">brew.sh</a>。</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>brew <span class="nb">install </span>gcc scalapack openblas liblas lapack open-mpi libxc fftw vecLibFort
</code></pre></div></div>

<h3 id="编译-conquest-1">编译 CONQUEST</h3>

<p>  下载 CONQUEST 最新源代码：</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone https://github.com/OrderN/CONQUEST-release conquest
</code></pre></div></div>

<p>  以下为 M1 平台下对应的 system.make 文件：</p>

<div class="language-ini highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># For Mac M1 aarch64
</span>
<span class="c"># Set compilers
</span><span class="py">FC</span><span class="p">=</span><span class="s">mpif90 -std=legacy</span>
<span class="py">F77</span><span class="p">=</span><span class="s">mpif77</span>

<span class="c"># Linking flags
</span><span class="py">LINKFLAGS</span><span class="p">=</span> <span class="s">-L/usr/local/lib -L/opt/homebrew/lib</span>
<span class="py">ARFLAGS</span><span class="p">=</span>

<span class="c"># Compilation flags
</span><span class="py">COMPFLAGS</span><span class="p">=</span> <span class="s">-O3 $(XC_COMPFLAGS)</span>
<span class="py">COMPFLAGS_F77</span><span class="p">=</span> <span class="s">$(COMPFLAGS)</span>

<span class="c"># Set BLAS and LAPACK libraries
</span><span class="py">BLAS</span><span class="p">=</span> <span class="s">-lvecLibFort</span>

<span class="c"># Full library call; remove scalapack if using dummy diag module
</span><span class="py">LIBS</span><span class="p">=</span> <span class="s">$(FFT_LIB) $(XC_LIB) -lscalapack $(BLAS)</span>

<span class="c"># LibXC compatibility (LibXC below) or Conquest XC library
</span>
<span class="c"># Conquest XC library
#XC_LIBRARY = CQ
#XC_LIB =
#XC_COMPFLAGS =
</span>
<span class="c"># LibXC compatibility
# Choose old LibXC (v2.x) or modern versions
#XC_LIBRARY = LibXC_v2
</span><span class="py">XC_LIBRARY</span> <span class="p">=</span> <span class="s">LibXC</span>
<span class="py">XC_LIB</span> <span class="p">=</span> <span class="s">-lxcf90 -lxc</span>
<span class="c">#XC_COMPFLAGS = -I/usr/local/include
</span><span class="py">XC_COMPFLAGS</span> <span class="p">=</span> <span class="s">-I/opt/homebrew/include</span>

<span class="c"># Set FFT library
</span><span class="py">FFT_LIB</span><span class="p">=</span><span class="s">-lfftw3</span>
<span class="py">FFT_OBJ</span><span class="p">=</span><span class="s">fft_fftw3.o</span>

<span class="c"># Matrix multiplication kernel type
</span><span class="py">MULT_KERN</span> <span class="p">=</span> <span class="s">default</span>
<span class="c"># Use dummy DiagModule or not
</span><span class="py">DIAG_DUMMY</span> <span class="p">=</span>
</code></pre></div></div>

<p>  执行编译安装命令：</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd </span>conquest/src/
make clean <span class="o">&amp;&amp;</span> make
</code></pre></div></div>

<p>  执行成功后会在 conquest/bin/ 目录下生成 Conquest 可执行文件，具体使用请见<a href="/tech/conquest-introduction">使用指南</a>。</p>

    </article>
    
    <div class="social-share-wrapper">
        <div class="social-share"></div>
    </div>
    
</div>

<section class="author-detail">
    <section class="post-footer-item author-card">
        <div class="avatar">
            <img src="/assets/img/profile.webp" alt="">
        </div>
        <div class="author-name" rel="author">zhonger</div>
        <div class="bio">
            <p>Developer & Maintainer</p>
        </div>
        
        <ul class="sns-links">
            
            <li>
                <a href="https://scholar.google.com/citations?user=AUupIooAAAAJ" target="_blank">
                    <svg class="icon" aria-hidden="true">
                        <use xlink:href="#icon-google-scholar"></use>
                    </svg>
                </a>
            </li>
            
            <li>
                <a href="https://www.researchgate.net/profile/Shengzhou-Li" target="_blank">
                    <svg class="icon" aria-hidden="true">
                        <use xlink:href="#icon-researchgate"></use>
                    </svg>
                </a>
            </li>
            
            <li>
                <a href="https://orcid.org/0000-0001-6973-3825" target="_blank">
                    <svg class="icon" aria-hidden="true">
                        <use xlink:href="#icon-ORCID"></use>
                    </svg>
                </a>
            </li>
            
            <li>
                <a href="https://github.com/zhonger" target="_blank">
                    <svg class="icon" aria-hidden="true">
                        <use xlink:href="#icon-github"></use>
                    </svg>
                </a>
            </li>
            
            <li>
                <a href="https://www.linkedin.com/in/shengzhouli/" target="_blank">
                    <svg class="icon" aria-hidden="true">
                        <use xlink:href="#icon-linkedin"></use>
                    </svg>
                </a>
            </li>
            
            <li>
                <a href="https://segmentfault.com/u/wuwozhonger" target="_blank">
                    <svg class="icon" aria-hidden="true">
                        <use xlink:href="#icon-segmentfault"></use>
                    </svg>
                </a>
            </li>
            
        </ul>
        
    </section>
    <section class="post-footer-item read-next">
        
        <div class="read-next-item">
            <a href="/tech/conquest/conquest-intel.html" class="read-next-link"></a>
            <section>
                <span>CONQUEST 编译安装指南 Intel 篇</span>
                <p>前言</p>
            </section>
            
            <div class="filter"></div>
            <img src="https://i.lisz.top/cover/THXqW2.webp" alt="">
            
        </div>
        
        
        <div class="read-next-item">
            <a href="/tech/conquest/conquest-introduction.html" class="read-next-link"></a>
            <section>
                <span>CONQUEST 第一性原理计算框架</span>
                <p>前言</p>
            </section>
            
            <div class="filter"></div>
            <img src="https://i.lisz.top/cover/rg7Rwh.webp" alt="">
            
        </div>
        
    </section>
    
</section>

<footer class="g-footer">
    <section>仲儿的自留地 © 
        
          2015
          -
        
        2023
        
        <a href="https://beian.miit.gov.cn/" target="_blank"></a>
        
    </section>
    <section>Powered by <a href="//jekyllrb.com">Jekyll</a> & <a href="https://github.com/zhonger/jekyll-theme-H2O-ac">Theme H2O-ac</a> (based on <a href="https://github.com/kaeyleo/jekyll-theme-H2O">Theme H2O</a>)  <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"><img alt="知识共享许可协议" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/80x15.png" /></a>  <script type="text/javascript">document.write(unescape("%3Cspan id='cnzz_stat_icon_1280712061'%3E%3C/span%3E%3Cscript src='https://v1.cnzz.com/z_stat.php%3Fid%3D1280712061%26show%3Dpic' type='text/javascript'%3E%3C/script%3E"));</script> </section>
</footer>
<script src="//at.alicdn.com/t/font_3046306_4quk6r21fv8.js"></script>

<script src="/assets/js/social-share.min.js"></script>
<script>
    socialShare('.social-share', {
        sites: ['wechat','weibo','douban','twitter'],
        wechatQrcodeTitle: "分享到微信朋友圈",
        wechatQrcodeHelper: '<p>扫码后点击右上角</p><p>将本文分享至朋友圈</p>'
    });
</script>
<script>
/**
*  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
/*
var disqus_config = function () {
this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};
*/
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
/*写入自己的disqus信息*/
s.src = '';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<script src="https://cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script>
<script>
    // 给图片添加链接
    $(document).ready(function() {
        $("p img").each(function() {
            var strA = "<a data-fancybox='gallery' ref='gallery1' href='" + this.src + "'></a>";
            $(this).wrapAll(strA);
        });

        $('[data-fancybox="gallery"]').fancybox();
    });
</script>
<script src="/assets/js/prism.js"></script>
<script src="/assets/js/index.min.js"></script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<script> 
    MathJax = {
      tex: {
        inlineMath: [['$', '$']],
        processEscapes: true
      }
    };
</script>
</body>
</html>
