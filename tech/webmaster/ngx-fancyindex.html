<h2 id="安装-nginx">安装 Nginx</h2>

<h3 id="centos-系统">CentOS 系统</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>yum <span class="nb">install</span> <span class="nt">-y</span> nginx
</code></pre></div></div>

<h3 id="ubuntu-系统">Ubuntu 系统</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo tee</span> <span class="nt">-a</span> /etc/apt/sources.list.d/nginx.list <span class="o">&lt;&lt;</span> <span class="no">EOF</span><span class="sh">
deb http://ppa.launchpad.net/nginx/stable/ubuntu </span><span class="si">$(</span>lsb_release <span class="nt">-c</span> <span class="nt">--short</span><span class="si">)</span><span class="sh"> main 
deb-src http://ppa.launchpad.net/nginx/stable/ubuntu </span><span class="si">$(</span>lsb_release <span class="nt">-c</span> <span class="nt">--short</span><span class="si">)</span><span class="sh"> main 
</span><span class="no">EOF
</span><span class="nb">sudo </span>apt-key adv <span class="nt">--keyserver</span> hkp://keyserver.ubuntu.com <span class="nt">--recv</span> 8B3981E7A6852F782CC4951600A6F0A3C300EE8C
<span class="nb">sudo </span>apt <span class="nb">install</span> <span class="nt">-y</span> nginx
</code></pre></div></div>

<h2 id="安装-ngx-fancyindex-插件">安装 Ngx-fancyindex 插件</h2>

<p>  下面的所有操作均以 Ubuntu 操作系统为例。</p>

<h3 id="安装编译工具及依赖">安装编译工具及依赖</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>apt <span class="nb">install</span> <span class="nt">-y</span> build-esstenial libpcre3 libpcre3-dev libxslt1-dev libgd-dev libgeoip-dev
</code></pre></div></div>

<h3 id="下载-nginx-源码">下载 Nginx 源码</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 查看 Nginx 版本及编译选项</span>
nginx <span class="nt">-V</span>
<span class="c"># 返回为 1.12.2 版本</span>

<span class="c"># 下载源码并解压</span>
<span class="nb">cd</span> ~/downloads
wget <span class="nt">-c</span> https://nginx.org/download/nginx-1.12.2.tar.gz
<span class="nb">tar </span>zxf nginx-1.12.2.tar.gz
<span class="c"># 得到文件夹 nginx-1.12.2</span>
</code></pre></div></div>

<h3 id="下载插件源码">下载插件源码</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd</span> ~/downloads
wget <span class="nt">-c</span> https://github.com/aperezdc/ngx-fancyindex/archive/v0.4.2.tar.gz
<span class="nb">tar </span>zxf v0.4.2.tar.gz
<span class="c"># 得到文件夹  ngx-fancyindex-0.4.2</span>
</code></pre></div></div>

<h3 id="编译生成新的-nginx">编译生成新的 Nginx</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd </span>nginx-1.12.2
./configure <span class="nt">--with-cc-opt</span><span class="o">=</span><span class="s1">'-g -O2 -fPIE -fstack-protector-strong -Wformat -Werror=format-security -fPIC -Wdate-time -D_FORTIFY_SOURCE=2'</span> <span class="nt">--with-ld-opt</span><span class="o">=</span><span class="s1">'-Wl,-Bsymbolic-functions -fPIE -pie -Wl,-z,relro -Wl,-z,now -fPIC'</span> <span class="nt">--prefix</span><span class="o">=</span>/usr/share/nginx <span class="nt">--conf-path</span><span class="o">=</span>/etc/nginx/nginx.conf <span class="nt">--http-log-path</span><span class="o">=</span>/var/log/nginx/access.log <span class="nt">--error-log-path</span><span class="o">=</span>/var/log/nginx/error.log <span class="nt">--lock-path</span><span class="o">=</span>/var/lock/nginx.lock <span class="nt">--pid-path</span><span class="o">=</span>/run/nginx.pid <span class="nt">--modules-path</span><span class="o">=</span>/usr/lib/nginx/modules <span class="nt">--http-client-body-temp-path</span><span class="o">=</span>/var/lib/nginx/body <span class="nt">--http-fastcgi-temp-path</span><span class="o">=</span>/var/lib/nginx/fastcgi <span class="nt">--http-proxy-temp-path</span><span class="o">=</span>/var/lib/nginx/proxy <span class="nt">--http-scgi-temp-path</span><span class="o">=</span>/var/lib/nginx/scgi <span class="nt">--http-uwsgi-temp-path</span><span class="o">=</span>/var/lib/nginx/uwsgi <span class="nt">--with-debug</span> <span class="nt">--with-pcre-jit</span> <span class="nt">--with-http_ssl_module</span> <span class="nt">--with-http_stub_status_module</span> <span class="nt">--with-http_realip_module</span> <span class="nt">--with-http_auth_request_module</span> <span class="nt">--with-http_v2_module</span> <span class="nt">--with-http_dav_module</span> <span class="nt">--with-http_slice_module</span> <span class="nt">--with-threads</span> <span class="nt">--with-http_addition_module</span> <span class="nt">--with-http_geoip_module</span><span class="o">=</span>dynamic <span class="nt">--with-http_gunzip_module</span> <span class="nt">--with-http_gzip_static_module</span> <span class="nt">--with-http_image_filter_module</span><span class="o">=</span>dynamic <span class="nt">--with-http_sub_module</span> <span class="nt">--with-http_xslt_module</span><span class="o">=</span>dynamic <span class="nt">--with-stream</span><span class="o">=</span>dynamic <span class="nt">--with-stream_ssl_module</span> <span class="nt">--with-stream_ssl_preread_module</span> <span class="nt">--with-mail</span><span class="o">=</span>dynamic <span class="nt">--with-mail_ssl_module</span> <span class="nt">--add-module</span><span class="o">=</span>../ngx-fancyindex-0.4.2

<span class="c"># 动态模块编译选项可以忽略</span>

<span class="c"># 使用 -j12 参数来多核并行编译</span>
make <span class="nt">-j12</span>

<span class="c"># 查看新生成的 nginx 二进制文件</span>
<span class="nb">ls </span>objs

<span class="c"># 将原来的二进制文件备份，并使用新生成的文件替换</span>
<span class="nb">sudo mv</span> /usr/sbin/nginx /usr/sbin/nginx.bak
<span class="nb">sudo cp </span>objs/nginx /usr/sbin/nginx
</code></pre></div></div>

<h3 id="安装主题">安装主题</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 下载主题</span>
<span class="nb">cd</span> ~/downloads
git clone https://github.com/lanffy/Nginx-Fancyindex-Theme.git

<span class="c"># 将主题目录与目录列表所在根目录软连接一下</span>
<span class="nb">sudo ln</span> <span class="nt">-s</span> ~/downloads/Nginx-Fancyindex-Theme /var/www/html/Nginx-Fancyindex-Theme
</code></pre></div></div>

<div class="language-nginx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># 修改 Nginx 虚拟主机配置文件</span>
<span class="k">server</span> <span class="p">{</span>
    <span class="kn">listen</span> <span class="mi">80</span><span class="p">;</span>
    <span class="c1">#listen [::]:80;</span>
	<span class="kn">server_name</span> <span class="s">ftp.example.org</span><span class="p">;</span>
	<span class="kn">return</span> <span class="mi">301</span> <span class="s">https://</span><span class="nv">$host$request_uri</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">server</span> <span class="p">{</span>
	<span class="kn">listen</span> <span class="mi">443</span><span class="p">;</span>
	<span class="kn">listen</span> <span class="s">[::]:443</span><span class="p">;</span>
	<span class="kn">server_name</span> <span class="s">ftp.example.org</span><span class="p">;</span>
	<span class="kn">ssl</span> <span class="no">on</span><span class="p">;</span>
	<span class="kn">ssl_certificate</span> <span class="n">/home/ubuntu/ssl/ftp.example.org.cert.pem</span><span class="p">;</span>
	<span class="kn">ssl_certificate_key</span> <span class="n">/home/ubuntu/ssl/ftp.example.org.key.pem</span><span class="p">;</span>
	<span class="kn">root</span> <span class="n">/var/www/html</span><span class="p">;</span>
	<span class="kn">index</span> <span class="s">index.html</span><span class="p">;</span>
    
    <span class="kn">location</span> <span class="n">/</span> <span class="p">{</span>
		<span class="kn">include</span> <span class="n">/var/www/html/Nginx-Fancyindex-Theme/fancyindex.conf</span><span class="p">;</span>
		<span class="kn">autoindex_format</span> <span class="s">html</span><span class="p">;</span>
		<span class="kn">charset</span> <span class="s">utf-8,gbk</span><span class="p">;</span>
		<span class="kn">disable_symlinks</span> <span class="no">off</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>
