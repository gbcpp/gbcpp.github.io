<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Mr Chen</title>
    <description>个人的一个技术博客站点，主要用于记录个人在学习过程中遇到的技术问题及解决方法、技术实验，以及一些比较有趣的事情。</description>
    <link>https://gbcpp.github.io//</link>
    <atom:link href="https://gbcpp.github.io/feed.xml" rel="self" type="application/rss+xml" />
    <pubDate>Tue, 14 Jan 2025 15:34:19 +0000</pubDate>
    <lastBuildDate>Tue, 14 Jan 2025 15:34:19 +0000</lastBuildDate>
    <generator>Jekyll v4.3.4</generator>
    
      <item>
        <title>直播场景TCP秒开优化</title>
        <description>&lt;blockquote&gt;
  &lt;p&gt;当前公司直播项目拨测的秒开指标远未达到预期，经过数据对比和分析，发现主要问题出在拨测节点 Player 与边缘节点之间的 Lastmile 网络质量上，由于目前 Player 的拉流协议使用的是基于 TCP 的标准协议(RTMP/HTTP-FLV/HLS等），并且 Player 是 Web 平台，不受控制，所以重点只能通过单边优化公司边缘节点与 Player 之间的 TCP 连接质量，尽量加快 TCP 的建连速度，以及关键帧的下发速度。&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h2 id=&quot;现状&quot;&gt;现状&lt;/h2&gt;

&lt;p&gt;公司使用静态节点和动态节点作为边缘以节省成本，且多种业务集中进行混布，其中动态节点质量较差，但成本较低，也是导致问题的关键所在，在对Linux 内核的升级和参数调整操作上一定要慎重。&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;当前动态节点版本及相关配置：&lt;/strong&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;内核版本：5.4.119-19-0006&lt;/li&gt;
  &lt;li&gt;见下面章节&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;优化验证&quot;&gt;优化验证&lt;/h2&gt;

&lt;h3 id=&quot;环境准备&quot;&gt;环境准备&lt;/h3&gt;

&lt;p&gt;#### TC 配置&lt;/p&gt;

&lt;p&gt;首先安装 tc 工具，系统默认不安装：&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;apt update
&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;apt &lt;span class=&quot;nb&quot;&gt;install&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-y&lt;/span&gt; iproute2

tc &lt;span class=&quot;nt&quot;&gt;--version&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;启动配置网损:&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;比如配置 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;lo&lt;/code&gt; 网卡 50～150ms 左右的延迟，且包含 0～15% 的一个随机丢包，配置如下：&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;su
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;tc qdisc add dev lo root netem delay 50ms 25ms distribution normal loss random 0% 15%

&lt;span class=&quot;c&quot;&gt;# 查看配置是否生效&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;tc qdisc show dev lo
  qdisc netem 8002: root refcnt 2 limit 1000 delay 50ms  25ms
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;验证：&lt;/strong&gt;&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;ping 127.0.0.1 &lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt; 0.2
PING 127.0.0.1 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;127.0.0.1&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; 56&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;84&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; bytes of data.
64 bytes from 127.0.0.1: &lt;span class=&quot;nv&quot;&gt;icmp_seq&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;1 &lt;span class=&quot;nv&quot;&gt;ttl&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;64 &lt;span class=&quot;nb&quot;&gt;time&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;102 ms
64 bytes from 127.0.0.1: &lt;span class=&quot;nv&quot;&gt;icmp_seq&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;2 &lt;span class=&quot;nv&quot;&gt;ttl&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;64 &lt;span class=&quot;nb&quot;&gt;time&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;115 ms
64 bytes from 127.0.0.1: &lt;span class=&quot;nv&quot;&gt;icmp_seq&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;3 &lt;span class=&quot;nv&quot;&gt;ttl&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;64 &lt;span class=&quot;nb&quot;&gt;time&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;175 ms
64 bytes from 127.0.0.1: &lt;span class=&quot;nv&quot;&gt;icmp_seq&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;4 &lt;span class=&quot;nv&quot;&gt;ttl&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;64 &lt;span class=&quot;nb&quot;&gt;time&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;80.4 ms
64 bytes from 127.0.0.1: &lt;span class=&quot;nv&quot;&gt;icmp_seq&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;5 &lt;span class=&quot;nv&quot;&gt;ttl&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;64 &lt;span class=&quot;nb&quot;&gt;time&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;55.7 ms
64 bytes from 127.0.0.1: &lt;span class=&quot;nv&quot;&gt;icmp_seq&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;6 &lt;span class=&quot;nv&quot;&gt;ttl&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;64 &lt;span class=&quot;nb&quot;&gt;time&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;118 ms
64 bytes from 127.0.0.1: &lt;span class=&quot;nv&quot;&gt;icmp_seq&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;7 &lt;span class=&quot;nv&quot;&gt;ttl&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;64 &lt;span class=&quot;nb&quot;&gt;time&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;95.2 ms
64 bytes from 127.0.0.1: &lt;span class=&quot;nv&quot;&gt;icmp_seq&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;8 &lt;span class=&quot;nv&quot;&gt;ttl&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;64 &lt;span class=&quot;nb&quot;&gt;time&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;106 ms
64 bytes from 127.0.0.1: &lt;span class=&quot;nv&quot;&gt;icmp_seq&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;9 &lt;span class=&quot;nv&quot;&gt;ttl&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;64 &lt;span class=&quot;nb&quot;&gt;time&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;113 ms
64 bytes from 127.0.0.1: &lt;span class=&quot;nv&quot;&gt;icmp_seq&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;10 &lt;span class=&quot;nv&quot;&gt;ttl&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;64 &lt;span class=&quot;nb&quot;&gt;time&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;48.2 ms
64 bytes from 127.0.0.1: &lt;span class=&quot;nv&quot;&gt;icmp_seq&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;11 &lt;span class=&quot;nv&quot;&gt;ttl&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;64 &lt;span class=&quot;nb&quot;&gt;time&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;108 ms
64 bytes from 127.0.0.1: &lt;span class=&quot;nv&quot;&gt;icmp_seq&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;12 &lt;span class=&quot;nv&quot;&gt;ttl&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;64 &lt;span class=&quot;nb&quot;&gt;time&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;164 ms
64 bytes from 127.0.0.1: &lt;span class=&quot;nv&quot;&gt;icmp_seq&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;13 &lt;span class=&quot;nv&quot;&gt;ttl&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;64 &lt;span class=&quot;nb&quot;&gt;time&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;50.0 ms
64 bytes from 127.0.0.1: &lt;span class=&quot;nv&quot;&gt;icmp_seq&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;14 &lt;span class=&quot;nv&quot;&gt;ttl&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;64 &lt;span class=&quot;nb&quot;&gt;time&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;207 ms
64 bytes from 127.0.0.1: &lt;span class=&quot;nv&quot;&gt;icmp_seq&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;15 &lt;span class=&quot;nv&quot;&gt;ttl&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;64 &lt;span class=&quot;nb&quot;&gt;time&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;56.3 ms
64 bytes from 127.0.0.1: &lt;span class=&quot;nv&quot;&gt;icmp_seq&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;16 &lt;span class=&quot;nv&quot;&gt;ttl&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;64 &lt;span class=&quot;nb&quot;&gt;time&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;137 ms
64 bytes from 127.0.0.1: &lt;span class=&quot;nv&quot;&gt;icmp_seq&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;17 &lt;span class=&quot;nv&quot;&gt;ttl&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;64 &lt;span class=&quot;nb&quot;&gt;time&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;92.5 ms
64 bytes from 127.0.0.1: &lt;span class=&quot;nv&quot;&gt;icmp_seq&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;18 &lt;span class=&quot;nv&quot;&gt;ttl&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;64 &lt;span class=&quot;nb&quot;&gt;time&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;141 ms
64 bytes from 127.0.0.1: &lt;span class=&quot;nv&quot;&gt;icmp_seq&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;19 &lt;span class=&quot;nv&quot;&gt;ttl&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;64 &lt;span class=&quot;nb&quot;&gt;time&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;154 ms
64 bytes from 127.0.0.1: &lt;span class=&quot;nv&quot;&gt;icmp_seq&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;20 &lt;span class=&quot;nv&quot;&gt;ttl&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;64 &lt;span class=&quot;nb&quot;&gt;time&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;141 ms
&lt;span class=&quot;nt&quot;&gt;---&lt;/span&gt; 127.0.0.1 ping statistics &lt;span class=&quot;nt&quot;&gt;---&lt;/span&gt;
21 packets transmitted, 20 received, 4.7619% packet loss, &lt;span class=&quot;nb&quot;&gt;time &lt;/span&gt;4016ms
rtt min/avg/max/mdev &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 48.201/113.013/207.390/42.338 ms, pipe 2
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;恢复：&lt;/strong&gt;&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# 删除配置&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;tc qdisc del dev lo root
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;注意：&lt;/strong&gt; 不要无脑 copy 别人的 tc 配置命令，使用了 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;channge&lt;/code&gt; 而非 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;add&lt;/code&gt;，导致 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Error: Qdisc not found. To create specify NLM_F_CREATE flag.&lt;/code&gt; 报错，还以为内核缺少 sch_netem 模块，差点重新安装完整内核。
可以通过命令：&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;modinfo sch_netem&lt;/code&gt; 查看系统是否已经安装有 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;sche_netem&lt;/code&gt; 模块，如果没有就会报错，有的话会有模块信息输出：&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;filename:       /lib/modules/6.8.0-51-generic/kernel/net/sched/sch_netem.ko.zst
description:    Network characteristics emulator qdisc
license:        GPL
srcversion:     7631AD62974660130A36DCA
depends:
retpoline:      Y
intree:         Y
name:           sch_netem
vermagic:       6.8.0-51-generic SMP preempt mod_unload modversions
sig_id:         PKCS#7
signer:         Build &lt;span class=&quot;nb&quot;&gt;time &lt;/span&gt;autogenerated kernel key
sig_key:        29:0D:80:5A:E0:B3:D6:D4:D4:D3:D0:EF:AB:48:F3:DB:73:58:2F:63
sig_hashalgo:   sha512
signature:      03:A4:1E:0E:CA:01:0F:58:3E:93:93:A7:25:97:FC:82:3E:4F:60:CA:
                00:84:75:DF:A3:20:F7:1B:92:9D:B1:58:6D:E2:47:92:84:83:00:FD:
                88:31:2B:84:32:FE:04:38:1F:24:FB:3E:D0:38:75:35:DB:11:C4:EE:
                19:B8:C1:1F:FE:B8:77:AF:AA:4B:DE:05:E7:5F:53:A4:79:65:B4:C7:
                1F:A1:6D:46:70:FA:26:00:5D:B1:08:F2:52:DD:2F:EF:AD:6E:B3:0C:
                E6:FA:9A:9A:C2:9D:00:E0:EA:D2:D2:FE:F1:40:3B:32:E3:09:20:27:
                CB:A9:8C:7E:0A:A7:2E:E4:F1:EE:89:3E:59:71:81:91:2F:CA:02:77:
                84:8B:68:92:E5:2F:CF:45:8E:31:5C:BD:54:99:0D:3E:72:55:85:79:
                A8:D6:A5:8E:EA:9A:32:21:1D:EB:28:4F:C4:54:36:1F:33:EC:82:61:
                D9:0A:DC:B7:CD:17:9B:A5:1A:89:78:94:93:42:6D:25:29:A0:E8:CD:
                7E:22:C6:BE:2F:7E:1F:E6:06:43:E3:33:2E:6F:19:1B:E8:22:45:BB:
                FC:F2:C2:A3:2D:31:F6:A3:80:19:8A:64:54:7A:BF:9C:BE:A1:D6:1B:
                2F:85:E7:F0:45:90:BC:52:42:4B:DE:5E:B5:DE:9A:1E:92:F7:F5:B3:
                9D:D5:52:03:C6:DC:2E:43:F2:4E:C6:3E:10:A0:F8:4F:24:99:66:06:
                A5:B8:48:3C:2D:AF:41:D7:84:F4:2A:61:66:3A:D2:6F:13:EA:67:5F:
                A5:DF:D3:36:F7:94:0C:85:AD:6E:CA:D7:56:E2:22:CD:AF:8A:33:25:
                41:86:10:A3:DC:47:56:DF:00:67:2D:DE:2D:66:B8:21:DF:4B:E5:B0:
                62:CC:44:7D:2F:49:C4:FD:BE:ED:35:98:C8:7E:2E:8B:27:62:32:4E:
                3A:8C:24:A9:CF:3F:69:FC:08:F9:D6:55:B1:2D:56:FB:27:8E:71:BB:
                7A:20:1C:45:77:0E:B7:83:B9:82:A4:F9:BD:C4:F1:C7:0F:6B:FB:B0:
                3D:A9:AC:A6:4B:F2:2D:AA:E0:8B:89:84:9E:35:9A:EB:C3:8A:B8:53:
                4D:A5:B3:AD:8A:2C:28:41:E7:EC:CA:46:3F:03:1C:D2:C3:EA:4E:1B:
                05:24:07:9D:A7:8A:67:58:02:9B:69:3C:ED:27:A2:33:44:4F:9A:DD:
                3D:99:D5:20:A2:AA:31:9E:9A:00:A2:F9:63:7A:F7:1A:C9:4F:9A:A7:
                F9:26:F4:F6:0B:38:BF:8A:7B:75:2B:B1:37:6C:12:4B:A0:01:E8:29:
                E0:CF:97:54:EA:1D:ED:B9:1C:D2:6F:A8
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;netperf&quot;&gt;NetPerf&lt;/h4&gt;

&lt;ul&gt;
  &lt;li&gt;启动 netserver&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;启动 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;netserver&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;netserver&lt;/code&gt; 与 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;netperf&lt;/code&gt; 是同一套 Tools，只是 server 测启动命令：&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;~&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;netserver &lt;span class=&quot;nt&quot;&gt;-h&lt;/span&gt;

Usage: netserver &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;options]

Options:
    &lt;span class=&quot;nt&quot;&gt;-h&lt;/span&gt;                Display this text
    &lt;span class=&quot;nt&quot;&gt;-D&lt;/span&gt;                Do not daemonize
    &lt;span class=&quot;nt&quot;&gt;-d&lt;/span&gt;                Increase debugging output
    &lt;span class=&quot;nt&quot;&gt;-f&lt;/span&gt;                Do not spawn chilren &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;each &lt;span class=&quot;nb&quot;&gt;test&lt;/span&gt;, run serially
    &lt;span class=&quot;nt&quot;&gt;-L&lt;/span&gt; name,family    Use name to pick listen address and family &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;family
    &lt;span class=&quot;nt&quot;&gt;-N&lt;/span&gt;                No debugging output, even &lt;span class=&quot;k&quot;&gt;if &lt;/span&gt;netperf asks
    &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; portnum        Listen &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;connect requests on portnum.
    &lt;span class=&quot;nt&quot;&gt;-4&lt;/span&gt;                Do IPv4
    &lt;span class=&quot;nt&quot;&gt;-6&lt;/span&gt;                Do IPv6
    &lt;span class=&quot;nt&quot;&gt;-v&lt;/span&gt; verbosity      Specify the verbosity level
    &lt;span class=&quot;nt&quot;&gt;-V&lt;/span&gt;                Display version information and &lt;span class=&quot;nb&quot;&gt;exit&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;-Z&lt;/span&gt; passphrase     Expect passphrase as the first thing received


&lt;span class=&quot;c&quot;&gt;# 启动命令&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;~&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;netserver &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; 1234 &lt;span class=&quot;nt&quot;&gt;-D&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-4&lt;/span&gt;
check_if_inetd: enter
setup_listens: enter
create_listens: called with host &lt;span class=&quot;s1&quot;&gt;&apos;0.0.0.0&apos;&lt;/span&gt; port &lt;span class=&quot;s1&quot;&gt;&apos;1234&apos;&lt;/span&gt; family AF_INET&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;2&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
getaddrinfo returned the following &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;host &lt;span class=&quot;s1&quot;&gt;&apos;0.0.0.0&apos;&lt;/span&gt; port &lt;span class=&quot;s1&quot;&gt;&apos;1234&apos;&lt;/span&gt;  family AF_INET
        cannonical name: &lt;span class=&quot;s1&quot;&gt;&apos;(nil)&apos;&lt;/span&gt;
        flags: 1 family: AF_INET: socktype: SOCK_STREAM protocol IPPROTO_TCP addrlen 16
        sa_family: AF_INET sadata: 4 210 0 0 0 0 0 0 0 0 0 0 0 0 0 0
Starting netserver with host &lt;span class=&quot;s1&quot;&gt;&apos;IN(6)ADDR_ANY&apos;&lt;/span&gt; port &lt;span class=&quot;s1&quot;&gt;&apos;1234&apos;&lt;/span&gt; and family AF_INET
accept_connections: enter
set_fdset: enter list 0x5f3130ac4740 fd_set 0x7fff92fb9450
setting 3 &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;fdset

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;使 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;netserver&lt;/code&gt; 监听在 1234 端口上，并指定 IPv4 协议，-D 表示不在后台运行。&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;启动 Client&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;netperf &lt;span class=&quot;nt&quot;&gt;-H&lt;/span&gt; 127.0.0.1  &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; 1234 &lt;span class=&quot;nt&quot;&gt;-l&lt;/span&gt; 10  &lt;span class=&quot;nt&quot;&gt;-t&lt;/span&gt; TCP_CRR &lt;span class=&quot;nt&quot;&gt;--&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-r&lt;/span&gt; 100,3000000
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;参数说明：
-H： 指定 server 的 IP 地址
-p： 指定 server 的 port
-l： 指定测试运行多长时间，单位：秒
-t： 运行模式，我们使用 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;TCP_CRR&lt;/code&gt; 来模拟 client 请求与 server 建连以后，由server 下发一定的数据量以后，关闭连接的这种 request/response 模式
-r： 分别指定 request 和 response 的字节数大小&lt;/p&gt;

&lt;h3 id=&quot;默认配置benchmark&quot;&gt;默认配置Benchmark&lt;/h3&gt;

&lt;p&gt;记录下当前内核参数中与 tcp 相关的配置，并获取当前配置的 Benchmark 数据，用以在后续的优化中进行对比。
首先直接用 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;netperf&lt;/code&gt; 执行 20分钟的测试数据获取：&lt;/p&gt;

&lt;p&gt;首先获取下当前测试流的关键帧的大小用以模拟尽量贴近实际业务场景的模拟：&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# 首先 dump 到本地&lt;/span&gt;
ffmpeg &lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt; http://xxxx/yyyyy/zzzzzzz.flv &lt;span class=&quot;nt&quot;&gt;-c&lt;/span&gt; copy  1.flv

&lt;span class=&quot;c&quot;&gt;# 然后获取该片段的的首个关键帧的大小&lt;/span&gt;
ffmpeg &lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt; 1.flv &lt;span class=&quot;nt&quot;&gt;-frames&lt;/span&gt;:v 1 &lt;span class=&quot;nt&quot;&gt;-f&lt;/span&gt; image2pipe &lt;span class=&quot;nt&quot;&gt;-vcodec&lt;/span&gt; mjpeg - | &lt;span class=&quot;nb&quot;&gt;wc&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-c&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# 可以看到最后输出的为：117118，即 114KB 左右。&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;netperf 模拟 Player 请求下发直播数据，这里设置让 server 一次性下发 300KB 的数据，同时假设 Client 的 request 默认为 1KB,
测试 20分钟，命令如下：&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;测试数据：&lt;/strong&gt;&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;~&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;netperf &lt;span class=&quot;nt&quot;&gt;-H&lt;/span&gt; 127.0.0.1  &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; 1234 &lt;span class=&quot;nt&quot;&gt;-l&lt;/span&gt; 1200  &lt;span class=&quot;nt&quot;&gt;-t&lt;/span&gt; TCP_CRR &lt;span class=&quot;nt&quot;&gt;--&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-r&lt;/span&gt; 1000,3000000
MIGRATED TCP Connect/Request/Response TEST from 0.0.0.0 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;0.0.0.0&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; port 0 AF_INET to 127.0.0.1 &lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; port 0 AF_INET : demo
Local /Remote
Socket Size   Request  Resp.   Elapsed  Trans.
Send   Recv   Size     Size    Time     Rate
bytes  Bytes  bytes    bytes   secs.    per sec

16384  131072 100      3000000  100.01      0.79
16384  131072
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;blockquote&gt;
  &lt;p&gt;上述测试数据输出的 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Local /Remote&lt;/code&gt; 可以看到在下面多出一行，分别表示的是 local 和 remote 的 socket send and recv buffer’s bytes。
最后一列 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Trans&lt;/code&gt; 表示的便是在测试的这段时间内平均每秒钟可以执行了多少次请求，即 0.79 次，相当于 Qps，越大说明效率越高。&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h2 id=&quot;tcp-优化记录&quot;&gt;TCP 优化记录：&lt;/h2&gt;

&lt;h3 id=&quot;默认内核参数配置&quot;&gt;默认内核参数配置&lt;/h3&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@XXXLink64 ~]# sysctl &lt;span class=&quot;nt&quot;&gt;-a&lt;/span&gt; | &lt;span class=&quot;nb&quot;&gt;grep&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;net&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\.&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;ipv4&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\.&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;tcp&quot;&lt;/span&gt;

net.ipv4.tcp_abort_on_overflow &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 0
net.ipv4.tcp_adv_win_scale &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 1
net.ipv4.tcp_allowed_congestion_control &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; reno cubic bbr
net.ipv4.tcp_app_win &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 31
net.ipv4.tcp_autocorking &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 1
net.ipv4.tcp_available_congestion_control &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; reno cubic bbr
net.ipv4.tcp_available_ulp &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 
net.ipv4.tcp_base_mss &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 1024
net.ipv4.tcp_challenge_ack_limit &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 1000
net.ipv4.tcp_comp_sack_delay_ns &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 1000000
net.ipv4.tcp_comp_sack_nr &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 44
net.ipv4.tcp_congestion_control &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; cubic
net.ipv4.tcp_dsack &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 1
net.ipv4.tcp_early_demux &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 1
net.ipv4.tcp_early_retrans &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 3
net.ipv4.tcp_ecn &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 2
net.ipv4.tcp_ecn_fallback &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 1
net.ipv4.tcp_fack &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 0
net.ipv4.tcp_fastopen &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 1
net.ipv4.tcp_fastopen_blackhole_timeout_sec &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 3600
net.ipv4.tcp_fastopen_key &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 5b1b3bb0-e9881f5a-8bf3fda0-1c410b36
net.ipv4.tcp_fin_timeout &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 30
net.ipv4.tcp_frto &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 2
net.ipv4.tcp_fwmark_accept &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 0
net.ipv4.tcp_inherit_buffsize &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 1
net.ipv4.tcp_init_cwnd &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 15
net.ipv4.tcp_init_rto &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 1000
net.ipv4.tcp_invalid_ratelimit &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 500
net.ipv4.tcp_keepalive_intvl &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 75
net.ipv4.tcp_keepalive_probes &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 9
net.ipv4.tcp_keepalive_time &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 7200
net.ipv4.tcp_l3mdev_accept &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 0
net.ipv4.tcp_limit_output_bytes &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 1048576
net.ipv4.tcp_loss_init_cwnd &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 10
net.ipv4.tcp_low_latency &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 0
net.ipv4.tcp_max_orphans &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 524288
net.ipv4.tcp_max_reordering &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 300
net.ipv4.tcp_max_syn_backlog &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 62144
net.ipv4.tcp_max_tw_buckets &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 6000
net.ipv4.tcp_mem &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 2621440      3932160 5242880
net.ipv4.tcp_min_rtt_wlen &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 300
net.ipv4.tcp_min_snd_mss &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 48
net.ipv4.tcp_min_tso_segs &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 2
net.ipv4.tcp_moderate_rcvbuf &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 1
net.ipv4.tcp_mtu_probe_floor &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 48
net.ipv4.tcp_mtu_probing &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 0
net.ipv4.tcp_no_metrics_save &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 1
net.ipv4.tcp_notsent_lowat &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 8388608
net.ipv4.tcp_orphan_retries &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 0
net.ipv4.tcp_pacing_ca_ratio &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 120
net.ipv4.tcp_pacing_ss_ratio &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 200
net.ipv4.tcp_probe_interval &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 600
net.ipv4.tcp_probe_threshold &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 8
net.ipv4.tcp_proc_sched &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 1
net.ipv4.tcp_recovery &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 1
net.ipv4.tcp_reordering &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 3
net.ipv4.tcp_retrans_collapse &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 1
net.ipv4.tcp_retries1 &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 5
net.ipv4.tcp_retries2 &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 15
net.ipv4.tcp_rfc1337 &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 0
net.ipv4.tcp_rmem &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 131072      1048576 16384000
net.ipv4.tcp_rto_max &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 120
net.ipv4.tcp_rto_min &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 200
net.ipv4.tcp_rx_skb_cache &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 0
net.ipv4.tcp_sack &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 1
net.ipv4.tcp_slow_start_after_idle &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 0
net.ipv4.tcp_stdurg &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 0
sysctl: net.ipv4.tcp_syn_retries &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 2
net.ipv4.tcp_synack_retries &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 2
reading key &lt;span class=&quot;s2&quot;&gt;&quot;net.ipv6.conf.all.stable_secret&quot;&lt;/span&gt;net.ipv4.tcp_synack_rto_interval &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 200

net.ipv4.tcp_syncookies &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 1
net.ipv4.tcp_thin_linear_timeouts &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 0
net.ipv4.tcp_timestamps &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 0
net.ipv4.tcp_tso_win_divisor &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 3
net.ipv4.tcp_tw_ignore_syn_tsval_zero &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 1
net.ipv4.tcp_tw_reuse &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 1
net.ipv4.tcp_tw_timeout &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 60
net.ipv4.tcp_tx_skb_cache &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 0
net.ipv4.tcp_wan_timestamps &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 0
net.ipv4.tcp_window_scaling &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 1
net.ipv4.tcp_wmem &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 4096000     16384000        32768000
net.ipv4.tcp_workaround_signed_windows &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 0
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;优化内容&quot;&gt;优化内容&lt;/h3&gt;

&lt;p&gt;以下均为仅优化单边的 Server 测参数。&lt;/p&gt;

&lt;p&gt;编辑 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/sysctl.conf&lt;/code&gt;，添加或修改如下参数：&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# 设置 tcp 拥塞算法为 bbr&lt;/span&gt;
net.ipv4.tcp_congestion_control &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; bbr

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;使参数立即生效：&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;sysctl &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;测试结果&quot;&gt;测试结果&lt;/h4&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;~&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;netperf &lt;span class=&quot;nt&quot;&gt;-H&lt;/span&gt; 127.0.0.1  &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; 1234 &lt;span class=&quot;nt&quot;&gt;-l&lt;/span&gt; 300  &lt;span class=&quot;nt&quot;&gt;-t&lt;/span&gt; TCP_CRR &lt;span class=&quot;nt&quot;&gt;--&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-r&lt;/span&gt; 1000,3000000
MIGRATED TCP Connect/Request/Response TEST from 0.0.0.0 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;0.0.0.0&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; port 0 AF_INET to 127.0.0.1 &lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; port 0 AF_INET : demo
Local /Remote
Socket Size   Request  Resp.   Elapsed  Trans.
Send   Recv   Size     Size    Time     Rate
bytes  Bytes  bytes    bytes   secs.    per sec

436600 87380  100      3000000  300.00      1.06
436600 87380
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;可以看到在开启了 bbr 拥塞算法后，&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Trans&lt;/code&gt; 由 0.79 升到了 1.06，有了明显的提升。
但是实际优化数据不会这么明显，因为线上环境我们只能开启 server 测的 bbr，而无法控制 client 同时开启。&lt;/p&gt;
</description>
        <pubDate>Fri, 10 Jan 2025 00:00:00 +0000</pubDate>
        <link>https://gbcpp.github.io/notes/tcp-optimize-livestream-scene.html</link>
        <guid isPermaLink="true">https://gbcpp.github.io/notes/tcp-optimize-livestream-scene.html</guid>
        
        <category>Life</category>
        
        <category>Protocol</category>
        
        
        <category>Notes</category>
        
      </item>
    
      <item>
        <title>Ubuntu24.04 配置静态 IP</title>
        <description>&lt;blockquote&gt;
  &lt;p&gt;公司默认给配置的 2016 年的 MBP，实在忍受不了退而求其次申请了一台台式机作为开发机、工作站使用。安装的 Ubuntu24.04 LTS 系统需要配置为静态 IP 远程连接上去进行工作。&lt;/p&gt;
&lt;/blockquote&gt;

&lt;blockquote&gt;
  &lt;p&gt;如下所有操作均使用 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;root&lt;/code&gt; 权限。&lt;/p&gt;
&lt;/blockquote&gt;

&lt;blockquote&gt;
  &lt;p&gt;记录该过程主要是因为想当然的以为网关地址就是同网段的 .1，导致配置后网络不通，通过 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ip route&lt;/code&gt; 查询后方可。&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h1 id=&quot;查看当前-ip&quot;&gt;查看当前 IP&lt;/h1&gt;

&lt;p&gt;系统默认开启 DHCP，自动获取 IP，且查看 IP 不再默认支持&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ifconfig&lt;/code&gt;命令，需要 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ip addr show&lt;/code&gt;进行查看。&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;1: lo: &amp;lt;LOOPBACK,UP,LOWER_UP&amp;gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host noprefixroute
       valid_lft forever preferred_lft forever
2: eno1: &amp;lt;BROADCAST,MULTICAST,UP,LOWER_UP&amp;gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000
    link/ether 2c:f0:5d:2b:11:31 brd ff:ff:ff:ff:ff:ff
    altname enp0s31f6
    inet 100.100.57.20/23 brd 100.100.57.255 scope global noprefixroute eno1
       valid_lft forever preferred_lft forever
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;可以看到自己的 IP 地址为&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;100.100.57.20&lt;/code&gt;。&lt;/p&gt;

&lt;h1 id=&quot;配置静态-ip&quot;&gt;配置静态 IP&lt;/h1&gt;

&lt;p&gt;ubuntu 18 以后版本开始使用&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;netplan&lt;/code&gt;配置网卡信息，查看当前系统目录&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/netplan/&lt;/code&gt;下具体配置文件名：&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ ls /etc/netplan
$ 50-cloud-init.yaml
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;blockquote&gt;
  &lt;p&gt;编辑前建议先进行备份。&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;&lt;strong&gt;默认配置：&lt;/strong&gt;&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# This file is generated from information provided by the datasource.  Changes
# to it will not persist across an instance reboot.  To disable cloud-init&apos;s
# network configuration capabilities, write a file
# /etc/cloud/cloud.cfg.d/99-disable-network-config.cfg with the following:
# network: {config: disabled}
network:
    ethernets:
        eno1:
            dhcp4: true
    version: 2
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;查询路由&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;通过&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ip route&lt;/code&gt;获取当前路由地址：&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ ip route
$ default via 100.100.56.254 dev eno1 proto static metric 100
$ default via 100.100.56.254 dev eno1 proto dhcp src 100.100.57.20 metric 100
$ 100.100.56.0/23 dev eno1 proto kernel scope link src 100.100.57.20 metric 100
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;可以看到默认路由地址为&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;100.100.56.254&lt;/code&gt;。&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;配置文件&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;vim /etc/netplan/50-cloud-init.yaml&lt;/code&gt;进行编辑,最终内容如下：&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# This file is generated from information provided by the datasource.  Changes
# to it will not persist across an instance reboot.  To disable cloud-init&apos;s
# network configuration capabilities, write a file
# /etc/cloud/cloud.cfg.d/99-disable-network-config.cfg with the following:
# network: {config: disabled}
network:
    version: 2
    ethernets:
        eno1:
            dhcp4: no
            addresses:
             - 100.100.57.20/23
            routes:
              - to: default
                via: 100.100.56.254
            nameservers:
              addresses:
                - 8.8.8.8
                - 8.8.4.4
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;blockquote&gt;
  &lt;p&gt;注意缩进的格式和位置，不能使用&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;tab&lt;/code&gt;只能用空格进行缩进。&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;&lt;strong&gt;应用&lt;/strong&gt;&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;netplan apply
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;如果没有格式错误的话，便没有任何输出，否则提示格式错误。
至此配置成功，通过&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ip addr show&lt;/code&gt;查看确认。&lt;/p&gt;

</description>
        <pubDate>Wed, 08 Jan 2025 00:00:00 +0000</pubDate>
        <link>https://gbcpp.github.io/notes/ubuntu24.04-static-ip.html</link>
        <guid isPermaLink="true">https://gbcpp.github.io/notes/ubuntu24.04-static-ip.html</guid>
        
        <category>Life</category>
        
        
        <category>Notes</category>
        
      </item>
    
      <item>
        <title>webtransport-go 在直播场景下的优化</title>
        <description>&lt;h1 id=&quot;背景&quot;&gt;背景&lt;/h1&gt;
&lt;p&gt;公司后台代码以 golang 为主，同事已经选择使用 webtransport-go 的开源方案灰度上线，虽然短期内就要接客户，使用自研的私有传输协议已经完全来不及，当下只能尽量优化 webtransport-go 这个方案，首先尽量在首开上进行优化，卡顿率相关的指标如果能与 tcp 持平甚至更好的话，就不在该方案中继续投入了，转为基于 c++ 的私有协议方案。&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;本人经历 2024年 11月变动以后，刚来公司不久，周边同事基本都以 golang 语言开发为主，且基本没有协议的优化经验，只能选择开源项目进行优化， B本人进入公司的时机也不好，该项目已经选定该方案，并且开始上线进行灰度测试，无法推翻重来。
且对比 Tcp 来看，webtransport-go 带来的性能消耗是 tcp 的 5 倍以上。&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h2 id=&quot;为什么不直接使用-quic-go&quot;&gt;为什么不直接使用 quic-go&lt;/h2&gt;

&lt;p&gt;因为 quic 虽然也是可靠传输，但是 quic 暂不支持通过 Url 来携带业务测参数，如：vhost、token 等的。&lt;/p&gt;

&lt;h1 id=&quot;初始化&quot;&gt;初始化&lt;/h1&gt;
&lt;h2 id=&quot;代码下载&quot;&gt;代码下载&lt;/h2&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;git clone git@github.com:quic-go/webtransport-go.git&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;拉取相关依赖仓库代码：&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# 进入代码目录
cd webtransport-go

# 通过 build 触发代码拉取
go build webtransport_test.go
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Golang 默认将代码存放在&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;$GOPATH&lt;/code&gt;目录下，我的&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;GOPATH&lt;/code&gt;环境变量配置为 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/Users/eddie/develop/go&lt;/code&gt;，那么拉取的依赖仓库 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;quic-go&lt;/code&gt; 的存放目录就是 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/Users/eddie/develop/go/pkg/mod/github.com/quic-go@v0.42.0-mod.1&lt;/code&gt;，为了方便在 VSCode 中查看代码，在 VSCode 的 WorkSpace 空白处通过右键选择：&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Add Folder to WorkSpace&lt;/code&gt;，选择上述目录，即可一起查看 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;quic-go&lt;/code&gt; 相关的代码，如下：
&lt;img src=&quot;/assets/img/blog/vscode-go.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;quic-go&quot;&gt;Quic-go&lt;/h2&gt;

&lt;p&gt;Quic-go 作为 webtransport-go 的依赖仓库，提供 quic 的基础传输能力，但是其提供的传输配置能力非常有限，特别是作为发送端时，一些基础的 CWnd、Burst、Ack 等参数均不支持配置，接口文件为：
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/Users/eddie/develop/go/pkg/mod/github.com/quic-go@v0.42.0-mod.1/interface.go&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;quic-go 内部相关参数主要位于：
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/Users/eddie/develop/go/pkg/mod/github.com/quic-go@v0.42.0-mod.1/internal/congestion/pacer.go&lt;/code&gt;
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/Users/eddie/develop/go/pkg/mod/github.com/quic-go@v0.42.0-mod.1/internal/protocol/protocol.go&lt;/code&gt;
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/Users/eddie/develop/go/pkg/mod/github.com/quic-go@v0.42.0-mod.1/internal/protocol/params.go&lt;/code&gt;&lt;/p&gt;

&lt;h1 id=&quot;优化项&quot;&gt;优化项&lt;/h1&gt;

&lt;ul&gt;
  &lt;li&gt;初始化发送包数：&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;文件：&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/Users/eddie/develop/go/pkg/mod/github.com/quic-go@v0.42.0-mod.1/internal/congestion/pacer.go&lt;/code&gt; 中指定
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;const maxBurstSizePackets = 10&lt;/code&gt;，在直播场景，I 帧切片后（1200Bytes/pkt）基本都会超过 10 片，建议配置为 20~30，具体视业务场景中首帧的切换大小，但也不宜过高，控制在 30 以内。
该配置项生效后对秒开的影响较小，属于毫秒级别，原来可能受 pacer 控制在几个 timerGraulariry 中将一个关键帧发送完，该配置的理想效果是减少这几个 timerGraulariry 的延迟。&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;握手超时时间：
应用层建议也是用 2 秒的配置。&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;// Default
const DefaultHandshakeIdleTimeout = 5 * time.Second
// 建议修改为 2 或者 3 秒，业务测可以快速重连，减少等待时间
const DefaultHandshakeIdleTimeout = 2 * time.Second
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;定时器精度&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;最好是从系统中获取自己的定时器精度（一般是4ms），不建议使用 1 ms 这种精度，过于高频，无效的 cpu 消耗。&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;// Default
const TimerGranularity = time.Millisecond
// 建议值：动态获取系统定时器精度，或者 hardcode 为 4ms 或者 10ms
const TimerGranularity = 4 * time.Millisecond
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;转发模式&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;目前业务集成方在回源时，虽然传输协议使用的是流式传输，但是边缘节点在接收到分片数据后并不会立即进行转发，而是在组装成一个完整的帧以后再一次性进行发送，这样做是为了内部各种封装格式的转换，但是也存在明显的弊端，即在没有收到完整的关键帧以前，不会向 Player 发送任何数据，被回源的关键帧阻塞，间接的增加了首开的延迟。&lt;/p&gt;

&lt;p&gt;可优化选项：比如回源的协议与 Player 请求的协议相同，即均为 HTTP-FLV，那么便不再需要进行完整帧的转封装，而直接进行分片的透明转发，同时边缘节点也异步的 cache 分片数据进行组帧操作，转封装分发给其它请求的协议。&lt;/p&gt;

&lt;h1 id=&quot;faq&quot;&gt;FAQ&lt;/h1&gt;

&lt;h2 id=&quot;webtransport-是否是整帧的收发&quot;&gt;Webtransport 是否是整帧的收发？&lt;/h2&gt;

&lt;p&gt;不是，websocket 在发送大的数据帧时，会通过 FIN 标记位是否为 1 标记为该 Frame 是否结束，而 WebTransport 中是基于流的传输，需要应用层自行组装完整的数据帧。
&lt;a href=&quot;https://www.ietf.org/archive/id/draft-ietf-webtrans-overview-05.html#name-conventions-and-definitions-8&quot;&gt;ref link&lt;/a&gt;&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;A stream is a sequence of bytes that is reliably delivered to the receiving application in the same order as it was transmitted by the sender. Streams can be of arbitrary length, and therefore cannot always be buffered entirely in memory. WebTransport protocols and APIs are expected to provide partial stream data to the application before the stream has been entirely received.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h2 id=&quot;bbr-sender-配置-startup-的较大带宽但是-max-burst-send-packets-number-却较小能将关键帧的几个切片一次性发送出去吗&quot;&gt;BBR sender 配置 startup 的较大带宽，但是 max burst send packets number 却较小，能将关键帧的几个切片一次性发送出去吗？&lt;/h2&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/Users/eddie/develop/go/pkg/mod/github.com/quic-go@v0.42.0-mod.1/internal/congestion/pacer.go&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;        p := &amp;amp;pacer{
                maxDatagramSize: initialMaxDatagramSize,
                adjustedBandwidth: func() uint64 {
                        // Bandwidth is in bits/s. We need the value in bytes/s.
                        bw := uint64(getBandwidth() / BytesPerSecond)
                        // Use a slightly higher value than the actual measured bandwidth.
                        // RTT variations then won&apos;t result in under-utilization of the congestion window.
                        // Ultimately, this will result in sending packets as acknowledgments are received rather than when timers fire,
                        // provided the congestion window is fully utilized and acknowledgments arrive at regular intervals.
                        return bw * 5 / 4
                },
        }
        p.budgetAtLastSent = p.maxBurstSize()
        return p
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;而在初始化时，由于没有 smoothedRTT 的有效值，所以初始化为 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;infBandwidth&lt;/code&gt; (UINT64_MAX)，
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/Users/eddie/develop/go/pkg/mod/github.com/quic-go@v0.42.0-mod.1/internal/congestion/bbr_sender.go&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;func (b *bbrSender) bandwidthEstimate() Bandwidth {
        srtt := b.rttStats.SmoothedRTT()
        if srtt == 0 {
                // If we haven&apos;t measured an rtt, the bandwidth estimate is unknown.
                return infBandwidth
        }
        bw := b.maxBandwidth.GetBest()
        if bw == 0 {
                return infBandwidth
        }
        return bw
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;虽然初始化的 bandwidth 比较大，但是 pacer 在发送数据时依然会受限于 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;maxBurstSizePackets&lt;/code&gt; 的配置，如下：&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;func (p *pacer) maxBurstSize() protocol.ByteCount {
        return utils.Max(
                protocol.ByteCount(uint64((protocol.MinPacingDelay+protocol.TimerGranularity).Nanoseconds())*p.adjustedBandwidth())/1e9,
                maxBurstSizePackets*p.maxDatagramSize,
        )
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;所以建议将 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;maxBurstSizePackets&lt;/code&gt; 值配置为 20 ～ 30 之间，根据业务场景，尽量让首帧（I Frame）的所有切片能够一次性发送出去，但是也不宜过高，避免数据突发导致网络拥塞丢包。&lt;/p&gt;

</description>
        <pubDate>Tue, 07 Jan 2025 00:00:00 +0000</pubDate>
        <link>https://gbcpp.github.io/protocol/webtransport-go-optimze-for-livestream.html</link>
        <guid isPermaLink="true">https://gbcpp.github.io/protocol/webtransport-go-optimze-for-livestream.html</guid>
        
        <category>Protocol</category>
        
        
        <category>Protocol</category>
        
      </item>
    
      <item>
        <title>移植裁剪 srs 到 ARMv64 系统设备</title>
        <description>&lt;h1 id=&quot;srs-版本&quot;&gt;SRS 版本&lt;/h1&gt;

&lt;p&gt;srs 源码选择较新的 stable 版本：v5.0-r3&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;代码拉取&lt;/strong&gt;&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ git clone --branch v5.0-r3 https://github.com/ossrs/srs.git
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;编译&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;已知设备系统：ARMv8 指令集架构的 Debian，此次测试选择在 Debian 系统下部署 srs 服务进行测试。&lt;/p&gt;

&lt;p&gt;使用 docker 进行编译，首先保证开发机上有 docker 服务，编译命令会自行拉取 aarch64 专用编译镜像并编译：&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ cd srs/trunk
$ docker run -it --rm -v `pwd`:/srs -w /srs ossrs/srs:aarch64 \
    bash -c &quot;./configure --srt=off --rtc=off --ffmpeg-fit=off --static=on \
        --sanitizer=off --sanitizer-static=off --sanitizer-log=off &amp;amp;&amp;amp; make -j4&quot;
 

# 查看 srs 二进制文件
$ ls -sh objs/srs
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h1 id=&quot;测试环境&quot;&gt;测试环境&lt;/h1&gt;

&lt;p&gt;基于当前测试条件，此次测试选择将 srs 服务部署在 Debian 系统的小盒子中进行测试。&lt;/p&gt;

&lt;p&gt;Debian 系统小盒子性能如下：&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;CPU：4 核 4 线程，主频 1.5GHz&lt;/li&gt;
  &lt;li&gt;Mem：2GB&lt;/li&gt;
  &lt;li&gt;Disk：8GB&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;观众端：&lt;/p&gt;

&lt;p&gt;Mac 下 Shell 脚本启动 10 路 ffplay 进行播放，启动命令：&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;bash repeat_command.sh &quot;ffplay https://ossrs.com:8088/live/livestream.flv&quot;  10
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;repeat_command.sh 脚本：&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;#!/bin/bash
 
if [ $# -lt 2 ]; then
    echo &quot;Usage: $0 &amp;lt;command&amp;gt; &amp;lt;times&amp;gt;&quot;
    exit 1
fi
 
# 获取参数
command=$1
times=$2
 
# 检查 times 是否是数字
if ! [[ $times =~ ^[0-9]+$ ]]; then
    echo &quot;Error: &amp;lt;times&amp;gt; must be a positive integer.&quot;
    exit 1
fi
 
# 循环执行命令
for ((i=1; i&amp;lt;=times; i++)); do
    echo &quot;Executing command &apos;$command&apos; in the background: iteration $i&quot;
    eval &quot;$command &amp;amp;&quot;
done
 
echo &quot;All commands have been executed in the background.&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h1 id=&quot;srs-配置&quot;&gt;SRS 配置&lt;/h1&gt;

&lt;p&gt;使用了自签名证书 ossrs.com&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;listen              1935;
max_connections     1000;
daemon              off;
srs_log_tank        console;
 
http_api {
    enabled         on;
    listen          1985;
}
 
http_server {
    enabled         on;
    listen          8080;
    dir             ./objs/nginx/html;
 
    https {
        enabled on;
        listen 8088;
        key ./ossrs.key;
        cert ./ossrs.crt;
    }
}
vhost __defaultVhost__ {
    http_remux {
        enabled     on;
        mount       [vhost]/[app]/[stream].flv;
    }
    ingest livestream {
        enabled      on;
        input {
            type    stream;
        url     http://100.100.34.14:8080/live/livestream.flv;
        }
        ffmpeg      ./objs/ffmpeg/bin/ffmpeg;
        engine {
            enabled          off;
            output          rtmp://0.0.0.0:[port]/live/livestream?vhost=[vhost];
        }
    }
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h1 id=&quot;测试结果&quot;&gt;测试结果&lt;/h1&gt;

&lt;p&gt;测试条件有限，目前仅测试了如下两种场景和数据，仅供参考。&lt;/p&gt;

&lt;p&gt;测试场景：为该 SRS 注入一路 stream 做为源，然后远端从该 SRS 通过 HTTPS-FLV 拉取十路该流。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/srs_perf.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h1 id=&quot;srs-支持sni和多证书&quot;&gt;SRS 支持SNI和多证书&lt;/h1&gt;

&lt;p&gt;目前 srs 仅支持单个 HTTPS Server 的部署，需要自行扩展支持 SNI 的读取、选择指定证书下发的实现，TLS 封装代码在 SrsHttpxConn 类中。&lt;/p&gt;

</description>
        <pubDate>Sun, 05 Jan 2025 00:00:00 +0000</pubDate>
        <link>https://gbcpp.github.io/notes/srs-on-arm.html</link>
        <guid isPermaLink="true">https://gbcpp.github.io/notes/srs-on-arm.html</guid>
        
        <category>Life</category>
        
        
        <category>Notes</category>
        
      </item>
    
      <item>
        <title>C++ 程序输出当前堆栈</title>
        <description>&lt;p&gt;将当前程序运行时的堆栈信息输出到控制台，或者 Log 中，用于问题调查。
互联网中找到的，使用均有内存问题，以下是修复后的版本，可正常运行在 Linux 下。&lt;/p&gt;

&lt;h2 id=&quot;头文件&quot;&gt;头文件&lt;/h2&gt;

&lt;div class=&quot;language-cpp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cp&quot;&gt;#include&lt;/span&gt; &lt;span class=&quot;cpf&quot;&gt;&amp;lt;cxxabi.h&amp;gt;&lt;/span&gt;&lt;span class=&quot;cp&quot;&gt;
#include&lt;/span&gt; &lt;span class=&quot;cpf&quot;&gt;&amp;lt;execinfo.h&amp;gt;&lt;/span&gt;&lt;span class=&quot;cp&quot;&gt;
#include&lt;/span&gt; &lt;span class=&quot;cpf&quot;&gt;&amp;lt;stdio.h&amp;gt;&lt;/span&gt;&lt;span class=&quot;cp&quot;&gt;
#include&lt;/span&gt; &lt;span class=&quot;cpf&quot;&gt;&amp;lt;stdlib.h&amp;gt;&lt;/span&gt;&lt;span class=&quot;cp&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;源码&quot;&gt;源码&lt;/h2&gt;

&lt;div class=&quot;language-cpp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Utils&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;PrintStackTrace&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;constexpr&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;size_t&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;kMaxFrames&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;128&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;constexpr&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;size_t&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;kMaxPrettyFunctionNameLength&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;512&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;n&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ostringstream&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;oss&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;addrlist&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;kMaxFrames&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;

  &lt;span class=&quot;c1&quot;&gt;// 获取当前堆栈中的地址&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;addrlen&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;backtrace&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;addrlist&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;sizeof&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;addrlist&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;sizeof&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;

  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;addrlen&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;oss&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;StackTraces: &quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;endl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;c1&quot;&gt;// 解析地址为函数名&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;symbollist&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;backtrace_symbols&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;addrlist&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;addrlen&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

  &lt;span class=&quot;c1&quot;&gt;// 解析函数名的更多信息&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;size_t&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;funcNameSize&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;kMaxPrettyFunctionNameLength&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;funcName&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;static_cast&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&amp;gt;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;malloc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;funcNameSize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;

  &lt;span class=&quot;c1&quot;&gt;// 跳过第一个元素（即本身）&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;addrlen&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;beginName&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;nullptr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;beginOffset&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;nullptr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;endOffset&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;nullptr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;c1&quot;&gt;// 解析符号名称及偏移量&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;p&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;symbollist&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;p&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;sc&quot;&gt;&apos;(&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;beginName&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;p&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;sc&quot;&gt;&apos;+&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;beginOffset&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;p&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;sc&quot;&gt;&apos;)&apos;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;beginOffset&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;endOffset&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;break&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;beginName&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;beginOffset&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;endOffset&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;beginName&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;beginOffset&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;beginName&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;++&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;sc&quot;&gt;&apos;\0&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;beginOffset&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;++&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;sc&quot;&gt;&apos;\0&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;endOffset&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;sc&quot;&gt;&apos;\0&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

      &lt;span class=&quot;c1&quot;&gt;// 解码并打印函数名称&lt;/span&gt;
      &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;status&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ret&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;
          &lt;span class=&quot;n&quot;&gt;abi&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;__cxa_demangle&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;beginName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;funcName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;funcNameSize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;status&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;status&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;oss&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot; &quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ret&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;endl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;c1&quot;&gt;// 如果无法解析，直接输出原始符号信息&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;oss&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;symbollist&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;endl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;free&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;funcName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;free&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;symbollist&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;oss&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;str&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;编译&quot;&gt;编译&lt;/h2&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ldflags&lt;/code&gt; 参数一定要指定 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-ldynamiclib&lt;/code&gt; 告诉链接器将所有符号添加到动态符号表中。这使得运行时调试工具（如 GDB）和运行时函数（如 backtrace）可以访问这些符号。
主要用于调试和诊断目的，以便在运行时能够获取更详细的堆栈信息和符号解析。&lt;/p&gt;

&lt;p&gt;对性能几乎没有影响，但是由于增加了符号表信息，会增加包体大小。&lt;/p&gt;

</description>
        <pubDate>Tue, 11 Jun 2024 00:00:00 +0000</pubDate>
        <link>https://gbcpp.github.io/notes/print_stacktrace.html</link>
        <guid isPermaLink="true">https://gbcpp.github.io/notes/print_stacktrace.html</guid>
        
        <category>C++</category>
        
        
        <category>Notes</category>
        
      </item>
    
      <item>
        <title>温故而知新之-C++</title>
        <description>&lt;h2 id=&quot;指针的退化及如何避免&quot;&gt;指针的退化及如何避免&lt;/h2&gt;

&lt;p&gt;在C++中，”指针退化”是指当数组作为函数参数传递时，它会”退化”为指向第一个元素的指针。这是因为在C++中，数组并不知道它们自己的大小，所以当你把一个数组作为参数传递给一个函数时，函数并不知道这个数组的大小，只知道它的起始地址。&lt;/p&gt;

&lt;p&gt;例如，假设你有一个函数&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;void foo(int arr[])&lt;/code&gt;，当你传递一个数组给这个函数时，例如&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;int arr[10]; foo(arr);&lt;/code&gt;，函数&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;foo&lt;/code&gt;实际上看到的是一个指向&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;arr&lt;/code&gt;的第一个元素的指针，而不是整个数组。&lt;/p&gt;

&lt;p&gt;要防止指针退化，有几种方法：&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;使用标准库容器，如&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;std::vector&lt;/code&gt;或&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;std::array&lt;/code&gt;。这些容器知道它们自己的大小，因此不会发生指针退化。例如： &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;void foo(std::vector&amp;lt;int&amp;gt;&amp;amp; arr)&lt;/code&gt;。&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;使用模板函数，使函数可以接受数组的引用，并且能够保留数组的大小信息。例如： &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;template&amp;lt;size_t N&amp;gt; void foo(int (&amp;amp;arr)[N])&lt;/code&gt;。&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;传递数组的大小作为另一个参数。例如： &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;void foo(int* arr, size_t size)&lt;/code&gt;。这样，即使数组退化为指针，函数仍然可以知道数组的大小。&lt;/p&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&quot;引用与指针的区别&quot;&gt;引用与指针的区别&lt;/h2&gt;

&lt;p&gt;在C++中，指针和引用都可以用于间接引用其他对象。然而，它们在语法和行为上有一些关键的不同：&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;初始化：引用在创建时需要初始化，并且一旦初始化后就不能改变引用的目标，也就是说它始终引用最初赋给它的对象。而指针可以在任何时间指向任何对象或者NULL。&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;空值：指针可以为NULL，表示它不指向任何对象。而引用必须始终引用一个有效的对象，不能有NULL引用。&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;间接访问：使用指针时，需要使用解引用运算符(*)来访问它指向的对象，而引用则可以像普通变量那样直接使用。&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;支持的操作：指针支持更多的操作，例如指针算术（即增加或减少指针的值，以指向内存中的不同位置）。引用则不能进行这种操作。&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;内存占用：引用实际上并不占用任何内存，它只是一个别名。而指针是一个实际的变量，它占用内存空间并存储一个地址值。&lt;/p&gt;
    &lt;blockquote&gt;
      &lt;p&gt;但引用在程序中并不是不占用任何字节，引用本质上就是一个常量指针（constant pointer）。它在内存中占据的空间和指针一样，通常是 4 字节（在 32 位系统）或 8 字节（在 64 位系统）。然而，引用本身并不存储任何值，它只是一个别名，代表它引用的对象。在某些优化的情况下，如果引用没有被用作一个对象的别名（也就是说，它被直接用于访问该对象），编译器可能会优化掉引用，使其不占用任何内存空间。但是，这种优化并不是在所有情况下都会发生。所以，说引用不占用内存空间并不完全准确，实际情况取决于编译器的优化和引用的使用方式。&lt;/p&gt;
    &lt;/blockquote&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;总的来说，引用在某些情况下可以提供更简洁的语法，而指针则提供了更大的灵活性和控制能力。选择使用哪一个取决于具体的编程需求。&lt;/p&gt;
</description>
        <pubDate>Fri, 12 Apr 2024 00:00:00 +0000</pubDate>
        <link>https://gbcpp.github.io/notes/learning-cpp-notes.html</link>
        <guid isPermaLink="true">https://gbcpp.github.io/notes/learning-cpp-notes.html</guid>
        
        <category>C++</category>
        
        
        <category>Notes</category>
        
      </item>
    
      <item>
        <title>面向学习的三种人</title>
        <description>&lt;blockquote&gt;
  &lt;p&gt;人们对学习的态度分为三种类型：犯人、过客和探索者&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h2 id=&quot;1-犯人&quot;&gt;1. 犯人&lt;/h2&gt;

&lt;p&gt;  他们可能视学习为一种负担或义务，而不是一种机会或乐趣。他们可能觉得被迫学习，而不是出于内心的愿望或对知识的渴望。这种态度可能会限制他们的学习潜力，因为他们可能无法全身心投入。&lt;/p&gt;

&lt;h2 id=&quot;2-过客&quot;&gt;2. 过客&lt;/h2&gt;

&lt;p&gt;  他们可能对学习有一种漠不关心的态度，只是偶尔参与，没有持续的投入或深度的参与。他们可能在学习中得到一些知识，但可能无法充分利用学习的潜力，因为他们没有深入研究或投入足够的时间。&lt;/p&gt;

&lt;h2 id=&quot;3-探索者&quot;&gt;3. 探索者&lt;/h2&gt;

&lt;p&gt;  他们热衷于学习，对新知识充满好奇心，愿意花时间和精力去探索和理解。他们可能会从学习中得到最大的收益，因为他们的态度使他们能够深入学习，发现新的想法和观点。&lt;/p&gt;

&lt;h2 id=&quot;总结&quot;&gt;总结&lt;/h2&gt;
&lt;p&gt;  这三种类型并不是固定不变的，人们可以改变自己对待学习的态度。但实际上，一个人在不同的时间或面对不同的主题时，可能会表现出这三种不同的态度。&lt;/p&gt;

</description>
        <pubDate>Tue, 02 Apr 2024 00:00:00 +0000</pubDate>
        <link>https://gbcpp.github.io/notes/learning-oriented.html</link>
        <guid isPermaLink="true">https://gbcpp.github.io/notes/learning-oriented.html</guid>
        
        <category>Life</category>
        
        
        <category>Notes</category>
        
      </item>
    
      <item>
        <title>基于 HTTP/3 的 WebTransport </title>
        <description>&lt;blockquote&gt;
  &lt;p&gt;本文主要翻译自https://datatracker.ietf.org/doc/html/draft-vvv-webtransport-http3 ，如有错误请指正。&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h1 id=&quot;摘要&quot;&gt;摘要&lt;/h1&gt;

&lt;p&gt;WebTransport 是一个协议框架，它强迫客户端受 web 安全模型去与远程服务器进行安全的多路传输；
WebTransport 是一个受 Web 安全模型约束的多路复用安全传输协议，本文将描述一个 WebTransport 协议基于 HTTP3 并提供单向流、双向流和数据报，并全部复用同一个相同的 HTTP3 链接；&lt;/p&gt;

&lt;!--more--&gt;

&lt;h1 id=&quot;现状&quot;&gt;现状&lt;/h1&gt;

&lt;p&gt;这是一份 Internet 标准跟踪文档。
本文是  Internet Engineering Task Force（IETF）的产品，它代表了 IETF 社区已达成的共识，它已经经历了公开的审阅并已被 Internet Engineering Steering Group (IESG) 批准出版；更多信息可以参考 &lt;a href=&quot;!https://datatracker.ietf.org/doc/html/rfc7841#section-2&quot;&gt;Section 2 of RFC 7841&lt;/a&gt;。&lt;/p&gt;

&lt;h1 id=&quot;介绍&quot;&gt;介绍&lt;/h1&gt;

&lt;p&gt;HTTP3 是在 QUIC [QUIC-TRANSPORT] 之上可以通过 QUIC 链接多路复用 HTTP 请求的协议。本文档定义了一种通过 HTTP3 实现 WebTransport 协议的要求，以实现多路复用 non-HTTP 数据的机制。多个 WebTransport 实例可以同时复用在同一个 HTTP3 链接上进行常规的 HTTP 数据传输。&lt;/p&gt;

&lt;h1 id=&quot;协议概述&quot;&gt;协议概述&lt;/h1&gt;

&lt;p&gt;WebTransport Server 通常由一对权限值和录制值来标识  (defined in [RFC3986] Sections 3.2 and 3.3   correspondingly)。
当一个 HTTP3 连接后，Client 和 Server 端都必须发送一个 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;SETTINGS_ENABLE_WEBTRANSPORT&lt;/code&gt; 配置以表明它们都支持基于 HTTP3 的 WebTransport。WebTransport 会话由 Client 在给定的 HTTP3 连接内发起，即由 Client 发送一个扩展的 CONNECT 请求，如果 Server 接受该请求，则一个 WebTransport session 便建立了；生成的 stream 将被进一步称为  &lt;em&gt;CONNECT stream&lt;/em&gt;，其 stream ID 用于唯一标识当前给定链接内的 WebTransport session。在给定的 WebTransport session 上建立的 CONNECT stream 的 ID 将被进一步称为 &lt;em&gt;Session ID&lt;/em&gt;。&lt;/p&gt;

&lt;p&gt;会话建立后，双方便可以使用以下机制交换数据：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Client 可以创建一个由特殊的不限制长度的 HTTP3 frame 组成的双向流（bidirectional stream），然后转移该流的所有权给 WebTransport；&lt;/li&gt;
  &lt;li&gt;Server 也可以创建一个 bidirectional stream，因为 HTTP3 没有为 Server 端创建 bidirectional stream 定义任何语义（言外之意：不禁止便是允许）；&lt;/li&gt;
  &lt;li&gt;Client 和 Server 都可以创建单向流类型（unidirectional stream）；&lt;/li&gt;
  &lt;li&gt;可以通过 QUIC DATAGRAM 帧发送数据包 datagram；&lt;a href=&quot;!https://datatracker.ietf.org/doc/html/draft-vvv-webtransport-http3#ref-QUIC-DATAGRAM&quot;&gt;QUIC-DATAGRAM&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;当创建的 CONNECT stream 关闭时，WebTransport 会话也即终止。&lt;/p&gt;

&lt;h1 id=&quot;会话建立&quot;&gt;会话建立&lt;/h1&gt;

&lt;h2 id=&quot;建立支持传输的-http3-链接&quot;&gt;建立支持传输的 HTTP3 链接&lt;/h2&gt;

&lt;p&gt;Client 和 Server 必须均在它们的设置框架中发送一个为 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;1&lt;/code&gt; 的值。终端不能使用任何 WebTransport 的任何功能，除非它们已经协商各种参数。
如果协商了 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;SETTINGS_ENABLE_WEBTRANSPORT&lt;/code&gt; 参数，则在协商 HTTP3 中 QUIC DATAGRAMS 时，必须按照 &lt;a href=&quot;!https://datatracker.ietf.org/doc/html/draft-vvv-webtransport-http3#ref-HTTP3-DATAGRAM&quot;&gt;HTTP3-DATAGRAM&lt;/a&gt; 进行协商；否则在协商 WebTransport 时如果没有 QUIC DATAGRAM 扩展，将导致 H3_SETTINGS_ERROR。
HTTP3 要求 Client 的 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;initial_max_bidi_streams&lt;/code&gt; 传输参数设置为 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0&lt;/code&gt;。当前的实现是在协商时强制执行这个规定；因此，在 client 发起 bidirectional streams 时，需发送一个非零的 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;MAX_STREAMS&lt;/code&gt; 。&lt;/p&gt;

&lt;h2 id=&quot;http3-扩展方法-connect&quot;&gt;HTTP3 扩展方法 CONNECT&lt;/h2&gt;

&lt;p&gt;RFC8441 在第 4 节中定义了一个扩展方法 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;CONNECT&lt;/code&gt;，可以通过 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;SETTINGS_ENABLE_CONNECT_PROTOCOL&lt;/code&gt; 参数激活，该参数是为 HTTP2 定义的，但是该协议不会在 HTTP3 中为 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;CONNECT&lt;/code&gt; 创建更多的扩展含义；因为 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;SETTINGS_ENABLE_WEBTRANSPORT&lt;/code&gt; 配置已经代表了终端支持扩展的 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;CONNECT&lt;/code&gt;。&lt;/p&gt;

&lt;h2 id=&quot;创建会话&quot;&gt;创建会话&lt;/h2&gt;

&lt;p&gt;由于 WebTransport 会话是通过 HTTP3 建立的，所以它们使用 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;https&lt;/code&gt; URI 规则 &lt;a href=&quot;!https://datatracker.ietf.org/doc/html/rfc7230&quot;&gt;RFC 7230&lt;/a&gt; 。
为了创建一个 WebTransport 会话，client 可以发送一个 HTTP CONNNECT 请求，其 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;:protocol&lt;/code&gt; 伪-头域 &lt;a href=&quot;!https://datatracker.ietf.org/doc/html/rfc8441&quot;&gt;RFC8441&lt;/a&gt; 字段必须设置为 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;webtransport&lt;/code&gt;，&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;:scheme&lt;/code&gt; 字段必须设置为 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;https&lt;/code&gt;, 同时 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;:authorith&lt;/code&gt;和 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;:path&lt;/code&gt; 必须配置，这些字段标识这是一个 WebTransport 服务；一个 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Origin&lt;/code&gt; header 必须包含在这个请求中。&lt;/p&gt;

&lt;p&gt;在收到一个 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;:protocol&lt;/code&gt; 字段设置为 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;webtransport&lt;/code&gt; 的 CONNECT 扩展请求时，HTTP3 服务器可以检查自己是否包含该请求中指定的 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;:authorith&lt;/code&gt; 和 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;:path&lt;/code&gt; 配置的 WebTransport 服务，如果没有，它应该返回状态码 404；如果有，它可以通过回复状态码 200 标识接受会话请求。WebTransport server 必须验证 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Origin&lt;/code&gt; header 以确保指定 origin 是可以被访问的。&lt;/p&gt;

&lt;p&gt;从客户端的角度看，一个 WebTransport 会话建立的标识是 client 收到了 server 的 200 响应；
从服务端的角度来看，一旦发送了 200 响应，就算是建了会话，两端都不能在会话建立之前打开任何 streams 或者发送任何的 datagrams。&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;基于 HTTP3 的 WebTransport 不支持 0-RTT。&lt;/strong&gt;&lt;/p&gt;

&lt;h2 id=&quot;限制同时会话的数量&quot;&gt;限制同时会话的数量&lt;/h2&gt;

&lt;p&gt;从流控的角度来看，WebTransport 会话数量针对stream 的流控就像常规的 HTTP 请求一样（通过 HTTP CONNECT 请求建立连接）。本协议没有引入新的，单独的流控机制，也不将 HTTP 请求与  WebTransport 会话分离，如果服务器需要限制接收请求的速率，它可以使用其它的机制：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;HTTP_REQUEST_REJECTED&lt;/code&gt; error code 定义在 &lt;a href=&quot;!https://datatracker.ietf.org/doc/html/draft-vvv-webtransport-http3#ref-HTTP3&quot;&gt;HTTP3&lt;/a&gt; 标识未处理的请求的 HTTP3 堆栈；&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;HTTP 状态码 429 表示达到了服务器的速率控制，请求被拒绝 &lt;a href=&quot;!https://datatracker.ietf.org/doc/html/rfc6585&quot;&gt;RFC6585&lt;/a&gt;；与上一个方法不一样，它直接将这个信号通知给发起的请求的应用程序；&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;webtransport-功能列表&quot;&gt;WebTransport 功能列表&lt;/h1&gt;

&lt;p&gt;WebTransport over HTTP3 提供了以下功能特性：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;单向流 unidirectional streams&lt;/li&gt;
  &lt;li&gt;双向流 bidirectional streams&lt;/li&gt;
  &lt;li&gt;数据包 datagrams&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;以上功能均可由任意一端发起。
Session ID 可用于解复用 Streams 和 Datagrams 以判断属于不同的 WebTransport session，在网络中，session IDs 使用的是 QUIC 可变长度整数方案编码的  &lt;a href=&quot;!https://datatracker.ietf.org/doc/html/draft-vvv-webtransport-http3#ref-QUIC-TRANSPORT&quot;&gt;QUIC-TRANSPORT&lt;/a&gt;。&lt;/p&gt;

&lt;h2 id=&quot;unidirectional-streams&quot;&gt;Unidirectional streams&lt;/h2&gt;

&lt;p&gt;WebTransport 连接一旦建立，两端均可以打开 Unidirectional streams。HTTP3 unidirectional stream type 应为 0x54，整个包体结构依次是 stream type [0x54]、Session ID、已编码的可变整数类型的长度信息、用户指定的流数据，如下：&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Unidirectional WebTransport stream format：&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;     0                   1                   2                   3
     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     |                           0x54 (i)                          ...
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     |                        Session ID (i)                       ...
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     |                         Stream Body                         ...
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;客户端发起的-birectional-streams&quot;&gt;客户端发起的 Birectional Streams&lt;/h2&gt;

&lt;p&gt;WebTransport 客户端可以通过打开一个 HTTP3 双向流并发送一个帧类型为 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;WEBTRANSPORT_STREAM&lt;/code&gt; (type=0x41) 的 HTTP3 frame 以初始化一个 WebTransport 的双向流。帧的格式为：frame type、Session ID、已编码可变数据长度、用户数据；
数据帧应该持续到流结束。&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;WEBTRANSPORT_STREAM frame format:&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;     0                   1                   2                   3
     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     |                           0x41 (i)                          ...
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     |                        Session ID (i)                       ...
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     |                         Stream Body                         ...
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;服务端发起的-bidirectional-streams&quot;&gt;服务端发起的 Bidirectional Streams&lt;/h2&gt;

&lt;p&gt;WebTransport 服务端可以通过打开一个 HTTP3 双向流初始化 Bidirectional Stream。请注意：由于 HTTP3 没有为服务器启动定义任何的 Bidirectional Strream 的相关语义，本协议中此类流适用于所有的 HTTP3 连接，前提是 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;SETTINGS_ENABLE_WEBTRANSPORT&lt;/code&gt; 选项已经协商过了。这些流的格式如下：&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;*Server-initiated bidirectional stream format：&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;     0                   1                   2                   3
     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     |                        Session ID (i)                       ...
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     |                         Stream Body                         ...
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;数据包-datagrams&quot;&gt;数据包 Datagrams&lt;/h2&gt;

&lt;p&gt;Datagrams 可以发送   &lt;a href=&quot;!https://datatracker.ietf.org/doc/html/draft-vvv-webtransport-http3#ref-QUIC-DATAGRAM&quot;&gt;QUIC-DATAGRAM&lt;/a&gt; and &lt;a href=&quot;!https://datatracker.ietf.org/doc/html/draft-vvv-webtransport-http3#ref-HTTP3-DATAGRAM&quot;&gt;HTTP3-DATAGRAM&lt;/a&gt; 定义的 DATAGRAM frame，前提是 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;SETTINGS_ENABLE_WEBTRANSPORT&lt;/code&gt; 已协商，流标识符（Flow Identifier）被设置为 session ID，格式如下：&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Datagram format：&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;  0                   1                   2                   3
     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     |                        Session ID (i)                       ...
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     |                        Datagram Body                        ...
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;在 QUIC 中，一个 Datagram 帧最多可以跨越一个数据包中，因为于此，应用程序必须知道可以发送的最大1数据报大小；然而当代理数据报时，逐跳的 MTU 可能并不相同。&lt;/p&gt;

&lt;h1 id=&quot;会话终止&quot;&gt;会话终止&lt;/h1&gt;

&lt;p&gt;任何一方都可以通过关闭起初通过发送 CONNECT 请求建立起来的流来关闭当前  WebTransport 会话；在得知会话正在终止时，断点必须停止发送新的 datagrams 并且重置所有与此 session 相关联的 sterams。&lt;/p&gt;

&lt;h1 id=&quot;安全注意事项&quot;&gt;安全注意事项&lt;/h1&gt;

&lt;p&gt;WebTransport over HTTP3 满足所有对 WebTransport 协议施加的所有安全要求，由于 Client 有可能不被信任，所以提供了一个client-server 通信的安全框架。
WebTransport over HTTP3 需要基于 QUIC 传输参数，这样可以通过 HTTP3 server 的支持来避免潜在的协议混淆带来的攻击；它还需要使用 Origin header，为服务器提供拒绝访问非源自于 Web 客户端的不被信任的 origin。&lt;/p&gt;

&lt;p&gt;就像通过 HTTP3 传输的 HTTP 流量一样，WebTransport 流量汇集不同的来源到同一个链接中，不同的源代表不同的信任域，意味着需要在同一个链接上应对不同的潜在的攻击，一种潜在的攻击是耗尽所有资源，因为所有的传输共享拥塞控制和流量控制，单个客户端大量使用这些资源可能会导致其它传输被终止。所以用户代理应该实施一个公平的方案，以确保链接内的每个传输可以获得可控的合理资源份额，这适用于数据发送和创建新流操作。&lt;/p&gt;

</description>
        <pubDate>Thu, 01 Feb 2024 00:00:00 +0000</pubDate>
        <link>https://gbcpp.github.io/protocol/WebTransport.html</link>
        <guid isPermaLink="true">https://gbcpp.github.io/protocol/WebTransport.html</guid>
        
        <category>Protocol</category>
        
        
        <category>Protocol</category>
        
      </item>
    
      <item>
        <title>NeoVim 安装配置记录</title>
        <description>&lt;blockquote&gt;
  &lt;p&gt;安装配置 NeoVim，体验一下，对比 VSCode 谁更强大。&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h2 id=&quot;windows-wsl-ubuntu&quot;&gt;Windows WSL Ubuntu&lt;/h2&gt;

&lt;p&gt;  WSL 下 Ubuntu 子系统的安装与原生的 Ubuntu 系统安装有所不同，主要是字体的配置方式上有所区别。&lt;/p&gt;

&lt;h3 id=&quot;install-neovim&quot;&gt;Install NeoVim&lt;/h3&gt;

&lt;p&gt;  我选择手动下载 NeoVim，这样可以安装官方最新版本，这里选择目前官方的最新版本 0.10.0，依次执行以下命令：&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;mkdir&lt;/span&gt; ~/tools
&lt;span class=&quot;nb&quot;&gt;cd&lt;/span&gt; ~/tools
wget https://github.com/neovim/neovim/releases/download/v0.10.0/nvim-linux64.tar.gz
&lt;span class=&quot;nb&quot;&gt;tar &lt;/span&gt;xzf nvim-linux64.tar.gz
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;上面下载的 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nvim-linux64.tar.gz&lt;/code&gt; 为 NeoVim 的二进制包，可直接运行，可以将上述解压的 NeoVim 中的 bin 目录添加到系统环境变量 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;PATH&lt;/code&gt;中，或者为 NeoVim 在 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/usr/bin&lt;/code&gt;目录下添加一个软连接：&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;sudo ln&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-s&lt;/span&gt; ~/tools/nvim-linux64/bin/nvim /usr/bin/nvim

&lt;span class=&quot;c&quot;&gt;# 可通过执行以下命令进行校验&lt;/span&gt;
nvim &lt;span class=&quot;nt&quot;&gt;--version&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;neovim-configuration&quot;&gt;NeoVim Configuration&lt;/h3&gt;

&lt;p&gt;  使用 NeoVim 一个很大的门槛就是前期各种 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Plugins&lt;/code&gt;的配置，目前有 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;lazyVim&lt;/code&gt;将很多易用的 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Plugins&lt;/code&gt;打包在了一起，做到了开箱即用。&lt;/p&gt;

&lt;p&gt;将 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;LazyVim&lt;/code&gt; 下载并解压到 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;NeoVim&lt;/code&gt;的配置目录下，启动 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;NeoVim&lt;/code&gt;便会自动安装了。&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# 直接 clone 代码到 neovim 的配置文件目录下&lt;/span&gt;
git clone https://github.com/LazyVim/starter ~/.config/nvim

&lt;span class=&quot;c&quot;&gt;# 启动 nvim，自动开始安装&lt;/span&gt;
nvim
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;安装完成后，使用 nvim 随便打开一个目录可以看到 NeoTree 中的图标全是小方块，即乱码：&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/nerofont_0.png&quot; alt=&quot;NeroFont0&quot; /&gt;&lt;/p&gt;

&lt;p&gt;继续以下操作，安装所有符号等宽展示的字体。&lt;/p&gt;

&lt;h3 id=&quot;install-nerd-font&quot;&gt;Install Nerd Font&lt;/h3&gt;

&lt;p&gt;&lt;a href=&quot;https://www.nerdfonts.com/&quot;&gt;Nerd Font&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;选择下载 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;JetBrainsMono Font&lt;/code&gt; 字体，在 Windows 中解压缩后，可以看到内部全是后缀为 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.ttf&lt;/code&gt; 的文件，选中后，右键 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;安装&lt;/code&gt; 即安装成功。&lt;/p&gt;

&lt;h3 id=&quot;windows-terminal-配置-mono-字体&quot;&gt;Windows Terminal 配置 Mono 字体&lt;/h3&gt;

&lt;p&gt;我的 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;windows terminal&lt;/code&gt; 版本如下 ：&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/win_terminal.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;该版本没有 UI 的配置界面，通过 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;settings.json&lt;/code&gt; 进行配置，在 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;profiles&lt;/code&gt; 的 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;defaults&lt;/code&gt; 配置中添加 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;fontFace&lt;/code&gt; 字段指定字体，如下：&lt;/p&gt;

&lt;div class=&quot;language-json highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nl&quot;&gt;&quot;defaults&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
   &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;//&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;Put&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;settings&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;here&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;that&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;you&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;want&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;to&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;apply&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;to&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;all&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;profiles.&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
   &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;fontFace&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;JetBrainsMono Nerd Font Mono&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;....&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;配置成功后，重启 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;windows terminal&lt;/code&gt;，通过 NeoVim 打开上一次的目录，查看图标显示已正常：&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/nerofont_1.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;mac&quot;&gt;Mac&lt;/h2&gt;

&lt;h2 id=&quot;ubuntu&quot;&gt;Ubuntu&lt;/h2&gt;

&lt;h2 id=&quot;常用功能介绍&quot;&gt;常用功能介绍&lt;/h2&gt;

&lt;h3 id=&quot;窗口管理&quot;&gt;窗口管理&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;打开内置控制台，执行命令，这是比较常用的场景，不需要切换窗口，快捷键 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Ctrl + L&lt;/code&gt;，目录定位在当前路径，不是当前被打开的目录：&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/nvim_console.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;关闭亦是使用该快捷键。&lt;/p&gt;
&lt;/blockquote&gt;

&lt;ul&gt;
  &lt;li&gt;切换光标在 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;NeoTree&lt;/code&gt; 和代码窗口中，使用 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Ctrl + h|l|j|k&lt;/code&gt;，即是 nvim 中移动光标位置的快捷键加上 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Ctrl&lt;/code&gt; 键便是上下左右切换窗口的快捷键。&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;快捷键引导&quot;&gt;快捷键引导&lt;/h3&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Normal&lt;/code&gt;模式下输入空格键弹出功能菜单，均可按照快捷键说明进行操作，功能菜单有多层，退格键可返回，Esc 键退出。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/nvim_menu.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

</description>
        <pubDate>Mon, 01 Jan 2024 00:00:00 +0000</pubDate>
        <link>https://gbcpp.github.io/notes/neovim.html</link>
        <guid isPermaLink="true">https://gbcpp.github.io/notes/neovim.html</guid>
        
        <category>develop</category>
        
        
        <category>notes</category>
        
      </item>
    
      <item>
        <title>Blog title</title>
        <description>&lt;blockquote&gt;
  &lt;p&gt;人们对学习的态度分为三种类型：犯人、过客和探索者。&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h2 id=&quot;犯人&quot;&gt;犯人&lt;/h2&gt;

&lt;p&gt;  他们可能视学习为一种负担或义务，而不是一种机会或乐趣。他们可能觉得被迫学习，而不是出于内心的愿望或对知识的渴望。这种态度可能会限制他们的学习潜力，因为他们可能无法全身心投入。&lt;/p&gt;

&lt;h2 id=&quot;过客&quot;&gt;过客&lt;/h2&gt;

&lt;p&gt;  他们可能对学习有一种漠不关心的态度，只是偶尔参与，没有持续的投入或深度的参与。他们可能在学习中得到一些知识，但可能无法充分利用学习的潜力，因为他们没有深入研究或投入足够的时间。&lt;/p&gt;

&lt;h2 id=&quot;探索者&quot;&gt;探索者&lt;/h2&gt;

&lt;p&gt;  他们热衷于学习，对新知识充满好奇心，愿意花时间和精力去探索和理解。他们可能会从学习中得到最大的收益，因为他们的态度使他们能够深入学习，发现新的想法和观点。&lt;/p&gt;

&lt;h2 id=&quot;总结&quot;&gt;总结&lt;/h2&gt;
&lt;p&gt;  这三种类型并不是固定不变的，人们可以改变自己对待学习的态度。但实际上，一个人在不同的时间或面对不同的主题时，可能会表现出这三种不同的态度。&lt;/p&gt;

</description>
        <pubDate>Mon, 01 Jan 2024 00:00:00 +0000</pubDate>
        <link>https://gbcpp.github.io/notes/blog-templete.html</link>
        <guid isPermaLink="true">https://gbcpp.github.io/notes/blog-templete.html</guid>
        
        <category>Life</category>
        
        
        <category>Notes</category>
        
      </item>
    
  </channel>
</rss>
