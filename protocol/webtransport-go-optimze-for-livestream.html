<!DOCTYPE html>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
<script src="https://unpkg.com/gitalk@latest/dist/gitalk.min.js"></script>


<html lang="zh-Hans">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>webtransport-go åœ¨ç›´æ’­åœºæ™¯ä¸‹çš„ä¼˜åŒ– - Mr Chen</title>
    <meta name="author"  content="Mr Chen">
    <meta name="description" content="webtransport-go åœ¨ç›´æ’­åœºæ™¯ä¸‹çš„ä¼˜åŒ–">
    <meta name="keywords"  content="Protocol">
    <!-- Open Graph -->
    <meta property="og:title" content="webtransport-go åœ¨ç›´æ’­åœºæ™¯ä¸‹çš„ä¼˜åŒ– - Mr Chen">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://gbcpp.github.io/protocol/webtransport-go-optimze-for-livestream.html">
    <meta property="og:baseurl" content="">
    <meta property="og:description" content="ä¸ªäººçš„ä¸€ä¸ªæŠ€æœ¯åšå®¢ç«™ç‚¹ï¼Œä¸»è¦ç”¨äºè®°å½•ä¸ªäººåœ¨å­¦ä¹ è¿‡ç¨‹ä¸­é‡åˆ°çš„æŠ€æœ¯é—®é¢˜åŠè§£å†³æ–¹æ³•ã€æŠ€æœ¯å®éªŒï¼Œä»¥åŠä¸€äº›æ¯”è¾ƒæœ‰è¶£çš„äº‹æƒ…ã€‚">
    <meta property="og:site_name" content="Mr Chen">
    <meta property="og:gray" content="false">
    
    
    <meta property="og:next_url" content="/notes/srs-on-arm.html">
    
    <meta property="post-date-format" content="0">
    
    <meta property="post-date" content="2025-01-07 00:00:00 +0000" />
    
    
    
    <meta name="theme-color" content="#81BBFF" />
    <link rel="manifest" href="/manifest.json" />
    <link rel="apple-touch-icon" href="/assets/img/touch/apple-touch-icon.png"/>
    <link rel="Shortcut Icon" href="/favicon.ico">
    <link rel="icon" href="/favicon.ico" type="image/x-icon" />
    <link rel="bookmark" href="/favicon.ico" type="image/x-icon" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/normalize.min.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lxgw-wenkai-screen-webfont@1.1.0/style.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@5.2.0/github-markdown-light.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/css/share.min.css">
    
    
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prism-themes@1.9.0/themes/prism-one-light.min.css" />
    
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.28.0/plugins/line-numbers/prism-line-numbers.min.css">
    
    <link rel="stylesheet" href="/assets/css/app.min.css">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@fancyapps/ui@4.0/dist/fancybox.min.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@waline/client/dist/waline.css" />
    <script src="//cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script>
</head>



<body class="line-numbers" ontouchstart="">




  <!--[if lt IE 10]>
  <div class="alert-danger" role="alert">ä½ çš„æµè§ˆå™¨å®åœ¨å¤ªå¤ªå¤ªæ—§äº†ï¼Œæ”¾å­¦åˆ«èµ°ï¼Œå‡çº§å®Œæµè§ˆå™¨å†è¯´ï¼<a target="_blank" class="alert-link" href="http://browsehappy.com">ç«‹å³å‡çº§</a></div>
  <![endif]-->
  
  <div id="all" class="post" data-theme="default">
  
    <div class="alert-tip" id="no-previous">
      å·²ç»æ˜¯æœ€æ–°ä¸€ç¯‡æ–‡ç« äº†ï¼
    </div>
    <div class="alert-tip" id="no-next">
      å·²ç»æ˜¯æœ€åä¸€ç¯‡æ–‡ç« äº†ï¼
    </div>
    <input id="nm-switch" type="hidden" value="false"> <header class="g-header" data-theme="default">
    <div class="g-logo">
      <a href="/" aria-label="logo"></a>
    </div>
    <!-- <i id="menu-toggle" class="iconfont icon-menu"></i> -->
    <div id="mode-toggle">
        <svg class="icon icon-day" aria-hidden="true">
            <use xlink:href="#icon-day"></use>
        </svg>
        <svg class="icon icon-night" aria-hidden="true">
            <use xlink:href="#icon-night"></use>
        </svg>
    </div>
    <svg id="menu-toggle" class="icon-menu" aria-hidden="true">
        <use xlink:href="#icon-menu"></use>
    </svg>
    <nav class="g-nav">
        <ul>
            
                
                <li>
                    <a href="/" aria-label="home">
                        home
                    </a>
                </li>
                
            
                
                <li>
                    <a href="/blog/index.html" aria-label="blog">
                        blog
                    </a>
                </li>
                
            
                
                <li>
                    <a href="/archives.html" aria-label="archives">
                        archives
                    </a>
                </li>
                
            
                
                <li>
                    <a href="/tags.html" aria-label="tags">
                        tags
                    </a>
                </li>
                
            
                
                <li class="dropdown">
                    <a class="dropdown-toggle"> about </a>
                    <ul class="dropdown-menu">
                    
                        <li>
                            <a href="/feed.xml" aria-label="RSS">
                                RSS
                            </a>
                        </li>
                    
                    </ul> 
                </li>
                
            
            <li class="mode">
                <svg class="icon day" aria-hidden="true">
                    <use xlink:href="#icon-day"></use>
                </svg>
                <svg class="icon night" aria-hidden="true">
                    <use xlink:href="#icon-night"></use>
                </svg>
            </li>
        </ul>
    </nav>
</header>


    <header
      class="g-banner post-header post-pattern-circuitBoard bgcolor-default "
      data-theme="default"
    >
      <div class="post-wrapper">
        <div class="post-tags">
          
            
              <a href="/tags.html#Protocol" class="post-tag">Protocol</a>
            
          
        </div>
        <h1>webtransport-go åœ¨ç›´æ’­åœºæ™¯ä¸‹çš„ä¼˜åŒ–</h1>
        <div class="post-meta">
          <span class="post-meta-item">
            <svg class="icon" aria-hidden="true">
              <use xlink:href="#icon-user"></use>
            </svg>
            Mr Chen
          </span>
          <time class="post-meta-item" datetime="25-01-07">
            <svg class="icon" aria-hidden="true">
              <use xlink:href="#icon-calendar"></use>
            </svg>
            <span class="create-at"></span>
          </time>
          <time class="post-meta-item" datetime="25-01-07">
            <svg class="icon" aria-hidden="true">
              <use xlink:href="#icon-update"></use>
            </svg>
            <span class="update-at"></span>
          </time>
            <span class="post-meta-item">
              <svg class="icon words" aria-hidden="true">
                <use xlink:href="#icon-words"></use>
              </svg>
              
              æœ¬æ–‡æ€»å…±  4.1k  å­—
            </span>
            <span class="post-meta-item">
              <svg class="icon time" aria-hidden="true">
                <use xlink:href="#icon-time"></use>
              </svg>
              é˜…è¯»å…¨æ–‡å¤§çº¦éœ€è¦ 12 åˆ†é’Ÿ
            </span>
            
              <span class="post-meta-item">
                <svg class="icon pv" aria-hidden="true">
                  <use xlink:href="#icon-pv"></use>
                </svg>
                æœ¬æ–‡æ€»é˜…è¯»é‡ <span id="busuanzi_value_page_pv"></span> æ¬¡
              </span>
            
            
        </div>
      </div>
      
      <div class="filter"></div>
        <div class="post-cover" style="background: url('/assets/img/shan.jpg') center no-repeat; background-size: cover;"></div>
      
    </header>
    <div class="post-content visible">
      

      
      
      <div class="container">  
        <div class="contents">
          <article class="markdown-body post">
              
            <h1 id="èƒŒæ™¯">èƒŒæ™¯</h1>
<p>å…¬å¸åå°ä»£ç ä»¥ golang ä¸ºä¸»ï¼ŒåŒäº‹å·²ç»é€‰æ‹©ä½¿ç”¨ webtransport-go çš„å¼€æºæ–¹æ¡ˆç°åº¦ä¸Šçº¿ï¼Œè™½ç„¶çŸ­æœŸå†…å°±è¦æ¥å®¢æˆ·ï¼Œä½¿ç”¨è‡ªç ”çš„ç§æœ‰ä¼ è¾“åè®®å·²ç»å®Œå…¨æ¥ä¸åŠï¼Œå½“ä¸‹åªèƒ½å°½é‡ä¼˜åŒ– webtransport-go è¿™ä¸ªæ–¹æ¡ˆï¼Œé¦–å…ˆå°½é‡åœ¨é¦–å¼€ä¸Šè¿›è¡Œä¼˜åŒ–ï¼Œå¡é¡¿ç‡ç›¸å…³çš„æŒ‡æ ‡å¦‚æœèƒ½ä¸ tcp æŒå¹³ç”šè‡³æ›´å¥½çš„è¯ï¼Œå°±ä¸åœ¨è¯¥æ–¹æ¡ˆä¸­ç»§ç»­æŠ•å…¥äº†ï¼Œè½¬ä¸ºåŸºäº c++ çš„ç§æœ‰åè®®æ–¹æ¡ˆã€‚</p>

<blockquote>
  <p>æœ¬äººç»å† 2024å¹´ 11æœˆå˜åŠ¨ä»¥åï¼Œåˆšæ¥å…¬å¸ä¸ä¹…ï¼Œå‘¨è¾¹åŒäº‹åŸºæœ¬éƒ½ä»¥ golang è¯­è¨€å¼€å‘ä¸ºä¸»ï¼Œä¸”åŸºæœ¬æ²¡æœ‰åè®®çš„ä¼˜åŒ–ç»éªŒï¼Œåªèƒ½é€‰æ‹©å¼€æºé¡¹ç›®è¿›è¡Œä¼˜åŒ–ï¼Œ Bæœ¬äººè¿›å…¥å…¬å¸çš„æ—¶æœºä¹Ÿä¸å¥½ï¼Œè¯¥é¡¹ç›®å·²ç»é€‰å®šè¯¥æ–¹æ¡ˆï¼Œå¹¶ä¸”å¼€å§‹ä¸Šçº¿è¿›è¡Œç°åº¦æµ‹è¯•ï¼Œæ— æ³•æ¨ç¿»é‡æ¥ã€‚
ä¸”å¯¹æ¯” Tcp æ¥çœ‹ï¼Œwebtransport-go å¸¦æ¥çš„æ€§èƒ½æ¶ˆè€—æ˜¯ tcp çš„ 5 å€ä»¥ä¸Šã€‚</p>
</blockquote>

<h2 id="ä¸ºä»€ä¹ˆä¸ç›´æ¥ä½¿ç”¨-quic-go">ä¸ºä»€ä¹ˆä¸ç›´æ¥ä½¿ç”¨ quic-go</h2>

<p>å› ä¸º quic è™½ç„¶ä¹Ÿæ˜¯å¯é ä¼ è¾“ï¼Œä½†æ˜¯ quic æš‚ä¸æ”¯æŒé€šè¿‡ Url æ¥æºå¸¦ä¸šåŠ¡æµ‹å‚æ•°ï¼Œå¦‚ï¼švhostã€token ç­‰çš„ã€‚</p>

<h1 id="åˆå§‹åŒ–">åˆå§‹åŒ–</h1>
<h2 id="ä»£ç ä¸‹è½½">ä»£ç ä¸‹è½½</h2>

<p><code class="language-plaintext highlighter-rouge">git clone git@github.com:quic-go/webtransport-go.git</code></p>

<p>æ‹‰å–ç›¸å…³ä¾èµ–ä»“åº“ä»£ç ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># è¿›å…¥ä»£ç ç›®å½•
cd webtransport-go

# é€šè¿‡ build è§¦å‘ä»£ç æ‹‰å–
go build webtransport_test.go
</code></pre></div></div>

<p>Golang é»˜è®¤å°†ä»£ç å­˜æ”¾åœ¨<code class="language-plaintext highlighter-rouge">$GOPATH</code>ç›®å½•ä¸‹ï¼Œæˆ‘çš„<code class="language-plaintext highlighter-rouge">GOPATH</code>ç¯å¢ƒå˜é‡é…ç½®ä¸º <code class="language-plaintext highlighter-rouge">/Users/eddie/develop/go</code>ï¼Œé‚£ä¹ˆæ‹‰å–çš„ä¾èµ–ä»“åº“ <code class="language-plaintext highlighter-rouge">quic-go</code> çš„å­˜æ”¾ç›®å½•å°±æ˜¯ <code class="language-plaintext highlighter-rouge">/Users/eddie/develop/go/pkg/mod/github.com/quic-go@v0.42.0-mod.1</code>ï¼Œä¸ºäº†æ–¹ä¾¿åœ¨ VSCode ä¸­æŸ¥çœ‹ä»£ç ï¼Œåœ¨ VSCode çš„ WorkSpace ç©ºç™½å¤„é€šè¿‡å³é”®é€‰æ‹©ï¼š<code class="language-plaintext highlighter-rouge">Add Folder to WorkSpace</code>ï¼Œé€‰æ‹©ä¸Šè¿°ç›®å½•ï¼Œå³å¯ä¸€èµ·æŸ¥çœ‹ <code class="language-plaintext highlighter-rouge">quic-go</code> ç›¸å…³çš„ä»£ç ï¼Œå¦‚ä¸‹ï¼š
<img src="/assets/img/blog/vscode-go.jpg" alt=""></p>

<h2 id="quic-go">Quic-go</h2>

<p>Quic-go ä½œä¸º webtransport-go çš„ä¾èµ–ä»“åº“ï¼Œæä¾› quic çš„åŸºç¡€ä¼ è¾“èƒ½åŠ›ï¼Œä½†æ˜¯å…¶æä¾›çš„ä¼ è¾“é…ç½®èƒ½åŠ›éå¸¸æœ‰é™ï¼Œç‰¹åˆ«æ˜¯ä½œä¸ºå‘é€ç«¯æ—¶ï¼Œä¸€äº›åŸºç¡€çš„ CWndã€Burstã€Ack ç­‰å‚æ•°å‡ä¸æ”¯æŒé…ç½®ï¼Œæ¥å£æ–‡ä»¶ä¸ºï¼š
<code class="language-plaintext highlighter-rouge">/Users/eddie/develop/go/pkg/mod/github.com/quic-go@v0.42.0-mod.1/interface.go</code></p>

<p>quic-go å†…éƒ¨ç›¸å…³å‚æ•°ä¸»è¦ä½äºï¼š
<code class="language-plaintext highlighter-rouge">/Users/eddie/develop/go/pkg/mod/github.com/quic-go@v0.42.0-mod.1/internal/congestion/pacer.go</code>
<code class="language-plaintext highlighter-rouge">/Users/eddie/develop/go/pkg/mod/github.com/quic-go@v0.42.0-mod.1/internal/protocol/protocol.go</code>
<code class="language-plaintext highlighter-rouge">/Users/eddie/develop/go/pkg/mod/github.com/quic-go@v0.42.0-mod.1/internal/protocol/params.go</code></p>

<h1 id="ä¼˜åŒ–é¡¹">ä¼˜åŒ–é¡¹</h1>

<ul>
  <li>åˆå§‹åŒ–å‘é€åŒ…æ•°ï¼š</li>
</ul>

<p>æ–‡ä»¶ï¼š<code class="language-plaintext highlighter-rouge">/Users/eddie/develop/go/pkg/mod/github.com/quic-go@v0.42.0-mod.1/internal/congestion/pacer.go</code> ä¸­æŒ‡å®š
<code class="language-plaintext highlighter-rouge">const maxBurstSizePackets = 10</code>ï¼Œåœ¨ç›´æ’­åœºæ™¯ï¼ŒI å¸§åˆ‡ç‰‡åï¼ˆ1200Bytes/pktï¼‰åŸºæœ¬éƒ½ä¼šè¶…è¿‡ 10 ç‰‡ï¼Œå»ºè®®é…ç½®ä¸º 20~30ï¼Œå…·ä½“è§†ä¸šåŠ¡åœºæ™¯ä¸­é¦–å¸§çš„åˆ‡æ¢å¤§å°ï¼Œä½†ä¹Ÿä¸å®œè¿‡é«˜ï¼Œæ§åˆ¶åœ¨ 30 ä»¥å†…ã€‚
è¯¥é…ç½®é¡¹ç”Ÿæ•ˆåå¯¹ç§’å¼€çš„å½±å“è¾ƒå°ï¼Œå±äºæ¯«ç§’çº§åˆ«ï¼ŒåŸæ¥å¯èƒ½å— pacer æ§åˆ¶åœ¨å‡ ä¸ª timerGraulariry ä¸­å°†ä¸€ä¸ªå…³é”®å¸§å‘é€å®Œï¼Œè¯¥é…ç½®çš„ç†æƒ³æ•ˆæœæ˜¯å‡å°‘è¿™å‡ ä¸ª timerGraulariry çš„å»¶è¿Ÿã€‚</p>

<ul>
  <li>æ¡æ‰‹è¶…æ—¶æ—¶é—´ï¼š
åº”ç”¨å±‚å»ºè®®ä¹Ÿæ˜¯ç”¨ 2 ç§’çš„é…ç½®ã€‚</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// Default
const DefaultHandshakeIdleTimeout = 5 * time.Second
// å»ºè®®ä¿®æ”¹ä¸º 2 æˆ–è€… 3 ç§’ï¼Œä¸šåŠ¡æµ‹å¯ä»¥å¿«é€Ÿé‡è¿ï¼Œå‡å°‘ç­‰å¾…æ—¶é—´
const DefaultHandshakeIdleTimeout = 2 * time.Second
</code></pre></div></div>

<ul>
  <li>å®šæ—¶å™¨ç²¾åº¦</li>
</ul>

<p>æœ€å¥½æ˜¯ä»ç³»ç»Ÿä¸­è·å–è‡ªå·±çš„å®šæ—¶å™¨ç²¾åº¦ï¼ˆä¸€èˆ¬æ˜¯4msï¼‰ï¼Œä¸å»ºè®®ä½¿ç”¨ 1 ms è¿™ç§ç²¾åº¦ï¼Œè¿‡äºé«˜é¢‘ï¼Œæ— æ•ˆçš„ cpu æ¶ˆè€—ã€‚</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// Default
const TimerGranularity = time.Millisecond
// å»ºè®®å€¼ï¼šåŠ¨æ€è·å–ç³»ç»Ÿå®šæ—¶å™¨ç²¾åº¦ï¼Œæˆ–è€… hardcode ä¸º 4ms æˆ–è€… 10ms
const TimerGranularity = 4 * time.Millisecond
</code></pre></div></div>

<ul>
  <li>è½¬å‘æ¨¡å¼</li>
</ul>

<p>ç›®å‰ä¸šåŠ¡é›†æˆæ–¹åœ¨å›æºæ—¶ï¼Œè™½ç„¶ä¼ è¾“åè®®ä½¿ç”¨çš„æ˜¯æµå¼ä¼ è¾“ï¼Œä½†æ˜¯è¾¹ç¼˜èŠ‚ç‚¹åœ¨æ¥æ”¶åˆ°åˆ†ç‰‡æ•°æ®åå¹¶ä¸ä¼šç«‹å³è¿›è¡Œè½¬å‘ï¼Œè€Œæ˜¯åœ¨ç»„è£…æˆä¸€ä¸ªå®Œæ•´çš„å¸§ä»¥åå†ä¸€æ¬¡æ€§è¿›è¡Œå‘é€ï¼Œè¿™æ ·åšæ˜¯ä¸ºäº†å†…éƒ¨å„ç§å°è£…æ ¼å¼çš„è½¬æ¢ï¼Œä½†æ˜¯ä¹Ÿå­˜åœ¨æ˜æ˜¾çš„å¼Šç«¯ï¼Œå³åœ¨æ²¡æœ‰æ”¶åˆ°å®Œæ•´çš„å…³é”®å¸§ä»¥å‰ï¼Œä¸ä¼šå‘ Player å‘é€ä»»ä½•æ•°æ®ï¼Œè¢«å›æºçš„å…³é”®å¸§é˜»å¡ï¼Œé—´æ¥çš„å¢åŠ äº†é¦–å¼€çš„å»¶è¿Ÿã€‚</p>

<p>å¯ä¼˜åŒ–é€‰é¡¹ï¼šæ¯”å¦‚å›æºçš„åè®®ä¸ Player è¯·æ±‚çš„åè®®ç›¸åŒï¼Œå³å‡ä¸º HTTP-FLVï¼Œé‚£ä¹ˆä¾¿ä¸å†éœ€è¦è¿›è¡Œå®Œæ•´å¸§çš„è½¬å°è£…ï¼Œè€Œç›´æ¥è¿›è¡Œåˆ†ç‰‡çš„é€æ˜è½¬å‘ï¼ŒåŒæ—¶è¾¹ç¼˜èŠ‚ç‚¹ä¹Ÿå¼‚æ­¥çš„ cache åˆ†ç‰‡æ•°æ®è¿›è¡Œç»„å¸§æ“ä½œï¼Œè½¬å°è£…åˆ†å‘ç»™å…¶å®ƒè¯·æ±‚çš„åè®®ã€‚</p>

<h1 id="faq">FAQ</h1>

<h2 id="webtransport-æ˜¯å¦æ˜¯æ•´å¸§çš„æ”¶å‘">Webtransport æ˜¯å¦æ˜¯æ•´å¸§çš„æ”¶å‘ï¼Ÿ</h2>

<p>ä¸æ˜¯ï¼Œwebsocket åœ¨å‘é€å¤§çš„æ•°æ®å¸§æ—¶ï¼Œä¼šé€šè¿‡ FIN æ ‡è®°ä½æ˜¯å¦ä¸º 1 æ ‡è®°ä¸ºè¯¥ Frame æ˜¯å¦ç»“æŸï¼Œè€Œ WebTransport ä¸­æ˜¯åŸºäºæµçš„ä¼ è¾“ï¼Œéœ€è¦åº”ç”¨å±‚è‡ªè¡Œç»„è£…å®Œæ•´çš„æ•°æ®å¸§ã€‚
<a href="https://www.ietf.org/archive/id/draft-ietf-webtrans-overview-05.html#name-conventions-and-definitions-8" rel="nofollow" target="_blank" class="extlinks">ref link</a></p>

<blockquote>
  <p>A stream is a sequence of bytes that is reliably delivered to the receiving application in the same order as it was transmitted by the sender. Streams can be of arbitrary length, and therefore cannot always be buffered entirely in memory. WebTransport protocols and APIs are expected to provide partial stream data to the application before the stream has been entirely received.</p>
</blockquote>

<h2 id="bbr-sender-é…ç½®-startup-çš„è¾ƒå¤§å¸¦å®½ä½†æ˜¯-max-burst-send-packets-number-å´è¾ƒå°èƒ½å°†å…³é”®å¸§çš„å‡ ä¸ªåˆ‡ç‰‡ä¸€æ¬¡æ€§å‘é€å‡ºå»å—">BBR sender é…ç½® startup çš„è¾ƒå¤§å¸¦å®½ï¼Œä½†æ˜¯ max burst send packets number å´è¾ƒå°ï¼Œèƒ½å°†å…³é”®å¸§çš„å‡ ä¸ªåˆ‡ç‰‡ä¸€æ¬¡æ€§å‘é€å‡ºå»å—ï¼Ÿ</h2>

<p><code class="language-plaintext highlighter-rouge">/Users/eddie/develop/go/pkg/mod/github.com/quic-go@v0.42.0-mod.1/internal/congestion/pacer.go</code></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        p := &amp;pacer{
                maxDatagramSize: initialMaxDatagramSize,
                adjustedBandwidth: func() uint64 {
                        // Bandwidth is in bits/s. We need the value in bytes/s.
                        bw := uint64(getBandwidth() / BytesPerSecond)
                        // Use a slightly higher value than the actual measured bandwidth.
                        // RTT variations then won't result in under-utilization of the congestion window.
                        // Ultimately, this will result in sending packets as acknowledgments are received rather than when timers fire,
                        // provided the congestion window is fully utilized and acknowledgments arrive at regular intervals.
                        return bw * 5 / 4
                },
        }
        p.budgetAtLastSent = p.maxBurstSize()
        return p
}
</code></pre></div></div>

<p>è€Œåœ¨åˆå§‹åŒ–æ—¶ï¼Œç”±äºæ²¡æœ‰ smoothedRTT çš„æœ‰æ•ˆå€¼ï¼Œæ‰€ä»¥åˆå§‹åŒ–ä¸º <code class="language-plaintext highlighter-rouge">infBandwidth</code> (UINT64_MAX)ï¼Œ
<code class="language-plaintext highlighter-rouge">/Users/eddie/develop/go/pkg/mod/github.com/quic-go@v0.42.0-mod.1/internal/congestion/bbr_sender.go</code></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>func (b *bbrSender) bandwidthEstimate() Bandwidth {
        srtt := b.rttStats.SmoothedRTT()
        if srtt == 0 {
                // If we haven't measured an rtt, the bandwidth estimate is unknown.
                return infBandwidth
        }
        bw := b.maxBandwidth.GetBest()
        if bw == 0 {
                return infBandwidth
        }
        return bw
}
</code></pre></div></div>

<p>è™½ç„¶åˆå§‹åŒ–çš„ bandwidth æ¯”è¾ƒå¤§ï¼Œä½†æ˜¯ pacer åœ¨å‘é€æ•°æ®æ—¶ä¾ç„¶ä¼šå—é™äº <code class="language-plaintext highlighter-rouge">maxBurstSizePackets</code> çš„é…ç½®ï¼Œå¦‚ä¸‹ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>func (p *pacer) maxBurstSize() protocol.ByteCount {
        return utils.Max(
                protocol.ByteCount(uint64((protocol.MinPacingDelay+protocol.TimerGranularity).Nanoseconds())*p.adjustedBandwidth())/1e9,
                maxBurstSizePackets*p.maxDatagramSize,
        )
}
</code></pre></div></div>

<p>æ‰€ä»¥å»ºè®®å°† <code class="language-plaintext highlighter-rouge">maxBurstSizePackets</code> å€¼é…ç½®ä¸º 20 ï½ 30 ä¹‹é—´ï¼Œæ ¹æ®ä¸šåŠ¡åœºæ™¯ï¼Œå°½é‡è®©é¦–å¸§ï¼ˆI Frameï¼‰çš„æ‰€æœ‰åˆ‡ç‰‡èƒ½å¤Ÿä¸€æ¬¡æ€§å‘é€å‡ºå»ï¼Œä½†æ˜¯ä¹Ÿä¸å®œè¿‡é«˜ï¼Œé¿å…æ•°æ®çªå‘å¯¼è‡´ç½‘ç»œæ‹¥å¡ä¸¢åŒ…ã€‚</p>


            <div class="post-copyright">
              <p>
                <span>ç‰ˆæƒå£°æ˜ï¼š</span>
                å¦‚æ— ç‰¹åˆ«å£°æ˜ï¼Œæœ¬æ–‡ç‰ˆæƒå½’
                <a href="https://gbcpp.github.io" class="cplink">Mr Chen</a>
                æ‰€æœ‰ï¼Œè½¬è½½è¯·æ³¨æ˜æœ¬æ–‡é“¾æ¥ã€‚ 
              </p>
              
                <p> 
                  ï¼ˆé‡‡ç”¨ 
                  <a href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank" class="extlinks">CC BY-NC-SA 4.0</a> 
                  è®¸å¯åè®®è¿›è¡Œæˆæƒï¼‰
                </p>
              
              <p><span>æœ¬æ–‡æ ‡é¢˜ï¼š</span>ã€Š webtransport-go åœ¨ç›´æ’­åœºæ™¯ä¸‹çš„ä¼˜åŒ– ã€‹</p>
              <p><span>æœ¬æ–‡é“¾æ¥ï¼š</span><a href="https://gbcpp.github.io/protocol/webtransport-go-optimze-for-livestream.html" class="cplink">https://gbcpp.github.io/protocol/webtransport-go-optimze-for-livestream.html</a></p>
              <p class="tips">æœ¬æ–‡æœ€åä¸€æ¬¡æ›´æ–°ä¸º <span></span> å¤©å‰ï¼Œæ–‡ç« ä¸­çš„æŸäº›å†…å®¹å¯èƒ½å·²è¿‡æ—¶ï¼</p>
            </div>
          </article>
        </div>   
        <div class="table-of-contents">
          <h2>ç›®å½•</h2>
          <ul><li><a onclick="scrollToAdjust('èƒŒæ™¯')">èƒŒæ™¯</a><ul><li><a onclick="scrollToAdjust('ä¸ºä»€ä¹ˆä¸ç›´æ¥ä½¿ç”¨-quic-go')">ä¸ºä»€ä¹ˆä¸ç›´æ¥ä½¿ç”¨ quic-go</a></li></ul></li><li><a onclick="scrollToAdjust('åˆå§‹åŒ–')">åˆå§‹åŒ–</a><ul><li><a onclick="scrollToAdjust('ä»£ç ä¸‹è½½')">ä»£ç ä¸‹è½½</a></li><li><a onclick="scrollToAdjust('quic-go')">Quic-go</a></li></ul></li><li><a onclick="scrollToAdjust('ä¼˜åŒ–é¡¹')">ä¼˜åŒ–é¡¹</a></li><li><a onclick="scrollToAdjust('faq')">FAQ</a><ul><li><a onclick="scrollToAdjust('webtransport-æ˜¯å¦æ˜¯æ•´å¸§çš„æ”¶å‘ï¼Ÿ')">Webtransport æ˜¯å¦æ˜¯æ•´å¸§çš„æ”¶å‘ï¼Ÿ</a></li><li><a onclick="scrollToAdjust('bbr-sender-é…ç½®-startup-çš„è¾ƒå¤§å¸¦å®½ï¼Œä½†æ˜¯-max-burst-send-packets-number-å´è¾ƒå°ï¼Œèƒ½å°†å…³é”®å¸§çš„å‡ ä¸ªåˆ‡ç‰‡ä¸€æ¬¡æ€§å‘é€å‡ºå»å—ï¼Ÿ')">BBR sender é…ç½® startup çš„è¾ƒå¤§å¸¦å®½ï¼Œä½†æ˜¯ max burst send packets number å´è¾ƒå°ï¼Œèƒ½å°†å…³é”®å¸§çš„å‡ ä¸ªåˆ‡ç‰‡ä¸€æ¬¡æ€§å‘é€å‡ºå»å—ï¼Ÿ</a></li></ul></li></ul>
        </div>
      </div>
      

      
      <div class="social-share-wrapper">
        <div class="social-share"></div>
      </div>
      
    </div>

    <div>
     
     <section class="post-footer-item comment" style="padding-bottom: 4em">
     <div id="gitalk_container"></div>
     <div id="disqus_thread"></div>
     </section>
     
    </div>

    <section class="author-detail">
      <section class="post-footer-item author-card">
        <div class="avatar">
          <img src="/assets/img/wx_avatar.jpg" alt="">
        </div>
        <div class="author-name" rel="author">Mr Chen</div>
        <div class="bio">
          <p>èµ„æ·±æµåª’ä½“å¼€å‘å·¥ä½œè€…</p>
        </div>
        
        <ul class="sns-links">
          
          <li>
            <a href="https://github.com/gbcpp" target="_blank" aria-label="github">
              <svg class="icon" aria-hidden="true">
                <use xlink:href="#icon-github"></use>
              </svg>
            </a>
          </li>
          
          <li>
            <a href="https://blog.csdn.net/m0_59561186?spm=1010.2135.3001.5343)" target="_blank" aria-label="csdn">
              <svg class="icon" aria-hidden="true">
                <use xlink:href="#icon-csdn"></use>
              </svg>
            </a>
          </li>
          
        </ul>
        
      </section>
      <section class="post-footer-item read-next">
        

        
        <div class="read-next-item">
          <a href="/notes/srs-on-arm.html" class="read-next-link" aria-label="ç§»æ¤è£å‰ª srs åˆ° ARMv64 ç³»ç»Ÿè®¾å¤‡"></a>
            <section>
              <span>ç§»æ¤è£å‰ª srs åˆ° ARMv64 ç³»ç»Ÿè®¾å¤‡</span>
              <p>SRS ç‰ˆæœ¬</p>
            </section>
            
            <div class="filter"></div>
            <img src="/assets/img/shan.jpg" alt="">
            
        </div>
        
      </section>
      
   
      

      
    </section>

  
  <script>
    var gitalk = new Gitalk({
      id: '2025-01-07 00:00:00 +0000',
      clientID: '7795ee35cc3373147f6e',  //è¿™é‡Œå…¶å®å¯ä»¥ç›´æ¥å¡«å€¼ï¼Œä½†æ˜¯è€ƒè™‘åˆ°é¡µé¢å®‰å…¨æ€§ï¼Œè¿˜æ˜¯é€šè¿‡é…ç½®çš„æ–¹å¼æ·»åŠ 
      clientSecret: '3c90889603d18c17cfd73289591b50a716925392',
      repo: 'gbcpp.github.io',
      owner: 'gbcpp',
      admin: 'gbcpp',
      distractionFreeMode: 'true'
    })

    gitalk.render('disqus_thread')
  </script>
  

    


<footer class="g-footer">
  <div class="g-container">
    <div class="g-left">
      <section class="links">
        æœ¬ç«™ç”± <a href="//jekyllrb.com" target="_blank" class="extlinks">Jekyll</a> å’Œ (åŸºäº <a href="https://github.com/kaeyleo/jekyll-theme-H2O" target="_blank" class="extlinks">H2O</a> çš„) <a href="https://github.com/zhonger/jekyll-theme-H2O-ac" target="_blank" class="extlinks">H2O-ac</a> å¼ºåŠ›é©±åŠ¨
         (<a href="https://github.com/zhonger/jekyll-theme-H2O-ac/releases/tag/v.1.2.1" target="_blank" class="extlinks">v1.2.1</a>)  
        
      </section>
      <section class="links">Mr Chen Â©
        
        
          2023
          -
        
        2025
        
          <a href="https://beian.miit.gov.cn/" target="_blank" class="extlinks">æ²ªICPå¤‡xxxxxxxxå·</a>
        
      </section>
      
      <section>
        <span id="busuanzi_container_site_pv">
          ğŸ‘ï¸ æ€»æµè§ˆé‡ <span id="busuanzi_value_site_pv"></span> <b>Â·</b>
        </span>
        <span id="busuanzi_container_site_uv">
          ğŸ‘¤ æ€»è®¿é—®é‡ <span id="busuanzi_value_site_uv"></span>
        </span>
      </section>
      
      <section>
        
      </section>
    </div>
    <div class="g-right">
      
      
    </div>
    
  </div>
</footer>
<div class="cookie-tip">
   ä¸ºäº†æå‡æœ¬ç«™çš„ä½¿ç”¨ä½“éªŒå’Œå¿…è¦åŠŸèƒ½çš„æ­£å¸¸ä½¿ç”¨ï¼Œæœ¬ç«™ä¼šä½¿ç”¨æœ¬åœ° Cookieã€‚è¯¦ç»†è¯·æŸ¥çœ‹ã€Œ <a href="/tos.html">æœ¬ç«™ä½¿ç”¨æ¡æ¬¾</a> ã€äº†è§£æ›´å¤šã€‚

  <button id="accept-tos">åŒæ„</button>
</div>
<button id="list" aria-label="Scroll back to top" class="mobile-list" type="button">
  <svg class="icon list day" aria-hidden="true">
    <use xlink:href="#icon-list-day"></use>
  </svg>
  <svg class="icon list night" aria-hidden="true">
    <use xlink:href="#icon-list-night"></use>
  </svg>
  <svg class="icon exit day" aria-hidden="true">
    <use xlink:href="#icon-exit-day"></use>
  </svg>
  <svg class="icon exit night" aria-hidden="true">
    <use xlink:href="#icon-exit-night"></use>
  </svg>
</button>
<button id="bttb" aria-label="Scroll back to top" class="bttb" type="button">
  <svg class="icon up day" aria-hidden="true">
    <use xlink:href="#icon-up-day"></use>
  </svg>
  <svg class="icon up night" aria-hidden="true">
    <use xlink:href="#icon-up-night"></use>
  </svg>
</button>


    
    <div class="modal">
        <div class="modal-content">
          <header>
            <span class="close">&times;</span>
          </header>
          <div class="container"></div>
        </div>
    </div>
    
  </div>

  <script src="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/js/social-share.min.js"></script>
  <script>
    socialShare('.social-share', {
      sites: [
        
          'wechat'
          ,
          
        
          'weibo'
          ,
          
        
          'douban'
          ,
          
        
          'twitter'
          
        
      ],
      wechatQrcodeTitle: "åˆ†äº«åˆ°å¾®ä¿¡æœ‹å‹åœˆ",
      wechatQrcodeHelper: '<p>æ‰«ç åç‚¹å‡»å³ä¸Šè§’</p><p>å°†æœ¬æ–‡åˆ†äº«è‡³æœ‹å‹åœˆ</p>'
    });
    $("a.social-share-icon").each(function() {
      $(this).attr("aria-label", $(this).attr("class").split(' ')[1])
    });
  </script>

  

  <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/line-numbers/prism-line-numbers.min.js"></script>
  <script src="/assets/js/app.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@4.0/dist/fancybox.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/clipboard/dist/clipboard.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/hotkeys-js/dist/hotkeys.min.js"></script>
  
  <script src="https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js" async></script>
  <script src="https://cdn.jsdelivr.net/npm/dayjs@1.11.2/dayjs.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/dayjs@1.11.2/plugin/customParseFormat.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/dayjs@1.11.2/plugin/relativeTime.js"></script>
  <script>
    /**
    * Better Scroll Experience
    */
    function scrollToAdjust(id){
      var element = document.getElementById(id);
      var headerOffset = 90;
      var elementPosition = element.getBoundingClientRect().top;
      var offsetPosition = elementPosition + window.scrollY - headerOffset;
      window.scrollTo({
          top: offsetPosition,
          behavior: "smooth"
      });
    }
      // ç»™å›¾ç‰‡æ·»åŠ é“¾æ¥
      $(document).ready(function() {
          var baseurl = $("meta[property='og:baseurl']").attr('content');
          $("p img").each(function() {
              $(this).attr('data-src', $(this).attr('src')).removeAttr('src').addClass("lazyload").attr('src', baseurl + '/assets/img/loading.gif');
              var strA = "<a data-fancybox='gallery' ref='gallery' href='" + $(this).attr('data-src') + "' data-caption='" + $(this).attr('alt') + "'></a>";
              $(this).wrapAll(strA);
              var caption = $(this)[0].alt;
              $(this).parent().after('<span class="caption">' + caption + '</span>');
          });

          Fancybox.bind('[data-fancybox]', {
            on: {
              load: (fancybox, slide) => {
                var gray = $("meta[property='og:gray']").attr('content');
                if(gray == "true"){
                    $(".fancybox__content img").addClass("gray");
                    $(".carousel__track .fancybox__thumb").addClass("gray");
                }
              }
            }
          });   
          
          

          if($("#comments-switch").length > 0){
            var comment_status = $("#cmn-toggle-4")[0].checked;
            if(comment_status){
              $("#waline").addClass("active");
            }else {
              $("#disqus_thread").addClass("active");
            }
            $("#cmn-toggle-4").click(function(){
              $("#disqus_thread").toggleClass("active");
              $("#waline").toggleClass("active");
            })
          }else {
            if($("#disqus_thread").length > 0) {
              $("#disqus_thread").addClass("active");
            }else if($("#waline").length > 0) {
              $("#waline").addClass("active");
            }
          }

          var time_formats = ['YYYY-MM-DD HH:mm:ss ZZ', 'YYYY DD MMM HH:mm:ss ZZ', 'YYYYå¹´MMæœˆDDæ—¥ HH:mm:ss ZZ'];
          function dateFormat(date, format){
            var date_org = dayjs(date, time_formats[format]);
            var date     = date_org.format(time_formats[format]);
            return {"date_org": date_org, "date": date}
          }

          dayjs.extend(window.dayjs_plugin_customParseFormat);
          dayjs.extend(window.dayjs_plugin_relativeTime);
          var post_date = $("meta[property='post-date']").attr('content');
          var post_date_format = $("meta[property='post-date-format']").attr('content');
          var local_post_date = dateFormat(post_date, post_date_format);

          $(".post time span.create-at").html(local_post_date["date"]);

          fetch("https://api.github.com/repos/gbcpp/gbcpp.github.io/commits?path=_posts/2025-01-07-webtransport-go-optimze-for-livestream.md")
          .then((response) => {
            return response.json();
          })
          .then((commits) => {
            if(commits.length != 0){
              var update_at = dayjs(commits[0]['commit']['committer']['date']);
            }else {
              var update_at = post_date
            }

            var local_update_at = dateFormat(update_at, post_date_format);
            $('.post time span.update-at').html(local_update_at["date"]);

            var relative_time = dayjs().diff(local_update_at["date_org"], 'day');
            $(".post-copyright .tips span").append(relative_time);
            if(relative_time > 365){
              $(".post-copyright .tips").addClass("active");
            }
          });   
          
          /*
          * Keyboard shortcut bind: left and right
          */

          var previous_url = $("meta[property='og:previous_url']").attr('content');
          var next_url = $("meta[property='og:next_url']").attr('content');

          hotkeys('left', function(event, handler){
              // Prevent the default refresh event under WINDOWS system
              event.preventDefault();
              if(previous_url){
                  console.log('you pressed left!');
                  window.location.href = previous_url;
              }else {
                  $("#no-previous").addClass("active");
                  setTimeout(function(){$("#no-previous").removeClass("active");}, 1500);
              }
          });

          hotkeys('right', function(event, handler){
              // Prevent the default refresh event under WINDOWS system
              event.preventDefault();
              if(next_url){
                  console.log('you pressed right!');
                  window.location.href = next_url;
              }else {
                  $("#no-next").addClass("active");
                  setTimeout(function(){$("#no-next").removeClass("active");}, 1500);
              }
          });
      });
  </script>
  <script src="https://at.alicdn.com/t/font_3046306_skfh9jzzbbf.js"></script>

  
  
  
<script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  <script>
    if ("serviceWorker" in navigator) {
        if (navigator.serviceWorker.controller) {
            console.log("An active service worker found, no need to register");
        } else {
            // Register the service worker
            navigator.serviceWorker
            .register("/sw.js", {
                scope: "/"
            })
            .then(function (reg) {
                console.log("Service worker has been registered for scope: " + reg.scope);
            });
        }
    }

// æ£€æµ‹æµè§ˆå™¨æ˜¯å¦æ”¯æŒSW
// if(navigator.serviceWorker != null){
//     navigator.serviceWorker.register("/sw.js")
//         .then(function(registartion){
//             console.log('æ”¯æŒsw:',registartion.scope)
//         })
// } else {
//     console.log('ä¸æ”¯æŒsw')
// }
</script>
	<!--
Author: Ray-Eldath
refer to:
 - http://docs.mathjax.org/en/latest/options/index.html
-->

	<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
		jax: ["input/TeX", "output/HTML-CSS"],
		tex2jax: {
			inlineMath: [ ["$", "$"] ],
			displayMath: [ ["$$", "$$"] ],
			skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
		},
		"HTML-CSS": { preferredFont: "TeX", availableFonts: ["STIX","TeX"] }
      });
    </script>

   
    <script src="https://cdn.jsdelivr.net/npm/mermaid@9.1.6/dist/mermaid.min.js"></script>
    <script>
        $(document).ready(function (){
            mermaid.initialize({
                startOnLoad:true,
                theme: "default",
            });
            mermaid.init(undefined, $('.mermaid2'));
        });
    </script>
 
   
</body>

</html>
