<!DOCTYPE html>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
<script src="https://unpkg.com/gitalk@latest/dist/gitalk.min.js"></script>


<html lang="zh-Hans">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RtcDataChannel(sctp) protocol optimize - Mr Chen</title>
    <meta name="author"  content="Mr Chen">
    <meta name="description" content="RtcDataChannel(sctp) protocol optimize">
    <meta name="keywords"  content="Protocol">
    <!-- Open Graph -->
    <meta property="og:title" content="RtcDataChannel(sctp) protocol optimize - Mr Chen">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://gbcpp.github.io/protocol/sctp-optimize.html">
    <meta property="og:baseurl" content="">
    <meta property="og:description" content="ä¸ªäººçš„ä¸€ä¸ªæŠ€æœ¯åšå®¢ç«™ç‚¹ï¼Œä¸»è¦ç”¨äºè®°å½•ä¸ªäººåœ¨å­¦ä¹ è¿‡ç¨‹ä¸­é‡åˆ°çš„æŠ€æœ¯é—®é¢˜åŠè§£å†³æ–¹æ³•ã€æŠ€æœ¯å®éªŒï¼Œä»¥åŠä¸€äº›æ¯”è¾ƒæœ‰è¶£çš„äº‹æƒ…ã€‚">
    <meta property="og:site_name" content="Mr Chen">
    <meta property="og:gray" content="false">
    
    <meta property="og:previous_url" content="/service-bind-cpu.html">
    
    
    <meta property="og:next_url" content="/packet_number.html">
    
    <meta property="post-date-format" content="0">
    
    <meta property="post-date" content="2023-09-30 00:00:00 +0000" />
    
    
    
    <meta name="theme-color" content="#81BBFF" />
    <link rel="manifest" href="/manifest.json" />
    <link rel="apple-touch-icon" href="/assets/img/touch/apple-touch-icon.png"/>
    <link rel="Shortcut Icon" href="/favicon.ico">
    <link rel="icon" href="/favicon.ico" type="image/x-icon" />
    <link rel="bookmark" href="/favicon.ico" type="image/x-icon" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/normalize.min.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lxgw-wenkai-screen-webfont@1.1.0/style.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@5.2.0/github-markdown-light.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/css/share.min.css">
    
    
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prism-themes@1.9.0/themes/prism-one-light.min.css" />
    
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.28.0/plugins/line-numbers/prism-line-numbers.min.css">
    
    <link rel="stylesheet" href="/assets/css/app.min.css">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@fancyapps/ui@4.0/dist/fancybox.min.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@waline/client/dist/waline.css" />
    <script src="//cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script>
</head>



<body class="line-numbers" ontouchstart="">




  <!--[if lt IE 10]>
  <div class="alert-danger" role="alert">ä½ çš„æµè§ˆå™¨å®åœ¨å¤ªå¤ªå¤ªæ—§äº†ï¼Œæ”¾å­¦åˆ«èµ°ï¼Œå‡çº§å®Œæµè§ˆå™¨å†è¯´ï¼<a target="_blank" class="alert-link" href="http://browsehappy.com">ç«‹å³å‡çº§</a></div>
  <![endif]-->
  
  <div id="all" class="post" data-theme="default">
  
    <div class="alert-tip" id="no-previous">
      å·²ç»æ˜¯æœ€æ–°ä¸€ç¯‡æ–‡ç« äº†ï¼
    </div>
    <div class="alert-tip" id="no-next">
      å·²ç»æ˜¯æœ€åä¸€ç¯‡æ–‡ç« äº†ï¼
    </div>
    <input id="nm-switch" type="hidden" value="false"> <header class="g-header" data-theme="default">
    <div class="g-logo">
      <a href="/" aria-label="logo"></a>
    </div>
    <!-- <i id="menu-toggle" class="iconfont icon-menu"></i> -->
    <div id="mode-toggle">
        <svg class="icon icon-day" aria-hidden="true">
            <use xlink:href="#icon-day"></use>
        </svg>
        <svg class="icon icon-night" aria-hidden="true">
            <use xlink:href="#icon-night"></use>
        </svg>
    </div>
    <svg id="menu-toggle" class="icon-menu" aria-hidden="true">
        <use xlink:href="#icon-menu"></use>
    </svg>
    <nav class="g-nav">
        <ul>
            
                
                <li>
                    <a href="/" aria-label="home">
                        home
                    </a>
                </li>
                
            
                
                <li>
                    <a href="/blog/index.html" aria-label="blog">
                        blog
                    </a>
                </li>
                
            
                
                <li>
                    <a href="/archives.html" aria-label="archives">
                        archives
                    </a>
                </li>
                
            
                
                <li>
                    <a href="/tags.html" aria-label="tags">
                        tags
                    </a>
                </li>
                
            
                
                <li class="dropdown">
                    <a class="dropdown-toggle"> about </a>
                    <ul class="dropdown-menu">
                    
                        <li>
                            <a href="/feed.xml" aria-label="RSS">
                                RSS
                            </a>
                        </li>
                    
                    </ul> 
                </li>
                
            
            <li class="mode">
                <svg class="icon day" aria-hidden="true">
                    <use xlink:href="#icon-day"></use>
                </svg>
                <svg class="icon night" aria-hidden="true">
                    <use xlink:href="#icon-night"></use>
                </svg>
            </li>
        </ul>
    </nav>
</header>


    <header
      class="g-banner post-header post-pattern-circuitBoard bgcolor-default post-no-cover"
      data-theme="default"
    >
      <div class="post-wrapper">
        <div class="post-tags">
          
            
              <a href="/tags.html#Protocol" class="post-tag">Protocol</a>
            
          
        </div>
        <h1>RtcDataChannel(sctp) protocol optimize</h1>
        <div class="post-meta">
          <span class="post-meta-item">
            <svg class="icon" aria-hidden="true">
              <use xlink:href="#icon-user"></use>
            </svg>
            Mr Chen
          </span>
          <time class="post-meta-item" datetime="23-09-30">
            <svg class="icon" aria-hidden="true">
              <use xlink:href="#icon-calendar"></use>
            </svg>
            <span class="create-at"></span>
          </time>
          <time class="post-meta-item" datetime="23-09-30">
            <svg class="icon" aria-hidden="true">
              <use xlink:href="#icon-update"></use>
            </svg>
            <span class="update-at"></span>
          </time>
            <span class="post-meta-item">
              <svg class="icon words" aria-hidden="true">
                <use xlink:href="#icon-words"></use>
              </svg>
              
              æœ¬æ–‡æ€»å…±  12.7k  å­—
            </span>
            <span class="post-meta-item">
              <svg class="icon time" aria-hidden="true">
                <use xlink:href="#icon-time"></use>
              </svg>
              é˜…è¯»å…¨æ–‡å¤§çº¦éœ€è¦ 37 åˆ†é’Ÿ
            </span>
            
              <span class="post-meta-item">
                <svg class="icon pv" aria-hidden="true">
                  <use xlink:href="#icon-pv"></use>
                </svg>
                æœ¬æ–‡æ€»é˜…è¯»é‡ <span id="busuanzi_value_page_pv"></span> æ¬¡
              </span>
            
            
        </div>
      </div>
      
    </header>
    <div class="post-content visible">
      
      <h2 class="post-subtitle">å®ç° RTCDataChannel ç±»ä¼¼äºè£¸ UDP çš„ä¼ è¾“æ•ˆç‡</h2>
      

      
      
      <div class="container">  
        <div class="contents">
          <article class="markdown-body post">
              
            <h1 id="datachannel-å®ç°">DataChannel å®ç°</h1>
<p>DataChannel çš„å®ç°æœ‰ä¸¤ç§ï¼Œwebrtc ç›®å‰ä½¿ç”¨è‡ªè¡ŒåŸºäº C++ å¼€å‘çš„ dcsctpï¼Œmediasoup å’Œ libdatachannel åŸºäº usrsctpï¼Œusrsctp ä¸ºå¼€æº sctp åè®®å®ç°ï¼Œå‡éµå®ˆ rfc 4960 æ ‡å‡†ã€‚
RFCï¼šhttps://tools.ietf.org/html/rfc4960</p>

<h1 id="èƒ½åŠ›æ¦‚è¿°">èƒ½åŠ›æ¦‚è¿°</h1>
<p>DataChannel (SCTPï¼‰æ”¯æŒå¯é ä¼ è¾“ã€ä¸å¯é ä¼ è¾“ä¸¤ç§æ¨¡å¼ï¼Œå…¶ä¸­ä¸å¯é ä¼ è¾“æœ‰ä¸¤ç§æ–¹å¼ï¼šä¸€ç§åŸºäºé…ç½®åŒ…æœ€å¤§ç”Ÿå‘½å‘¨æœŸè¿›è¡Œé…ç½®ï¼Œå¦ä¸€ç§æ˜¯åŸºäºæœ€å¤§é‡ä¼ æ¬¡æ•°è¿›è¡Œé…ç½®ã€‚</p>

<p>å¦‚è‹¥ä½¿ç”¨å¯é ä¼ è¾“åªéœ€å°†Client ç«¯çš„ reliable é…ç½®ä¸º true å³å¯ï¼ŒServer çš„ usrsctp ä¸­çš„ <code class="language-plaintext highlighter-rouge">spa.sendv_prinfo.pr_policy</code> é…ç½®ä¸º  <code class="language-plaintext highlighter-rouge">SCTP_PR_SCTP_NONE</code> å³å¯ï¼›</p>

<p>å¦‚è‹¥éœ€è¦ä½¿ç”¨ä¸å¯é ä¼ è¾“æ¨¡å¼ï¼Œåˆ™åˆ†ä»¥ä¸‹ä¸¤ç§æ–¹å¼ï¼šåŸºäºç”Ÿå­˜æ—¶é—´å’Œé‡ä¼ æ¬¡æ•°ï¼ŒäºŒè€…åªèƒ½é€‰å…¶ä¸€ï¼š
åŸºäºæœ€å¤§ç”Ÿå‘½å‘¨æœŸ <code class="language-plaintext highlighter-rouge">maxRetransTime</code> ä¸ºæ•°æ®æŠ¥åœ¨ sctp é˜Ÿåˆ—ä¸­æœ€å¤§å­˜æ´»æ—¶é—´ï¼Œè¯¥å‚æ•°å¯ä»¥ä¿è¯å‘é€é˜Ÿåˆ—å¯ä»¥å¿«é€Ÿçš„æƒ…å†µï¼Œå°½é‡é™ä½åç»­åŒ…å‘é€å¤±è´¥çš„æ¦‚ç‡ï¼Œä½†æ˜¯å­˜åœ¨åœ¨ç½‘ç»œæ‹¥å¡çš„æƒ…å†µä¸‹ï¼Œå›  CC æ§åˆ¶å¯¼è‡´æ•°æ®æŠ¥å°šæœªå‘é€ä¾¿è¢«æ¸…ç†çš„é—®é¢˜ï¼Œå³æ•°æ®åŒ…æ²¡æœ‰ç»è¿‡ä¸€æ¬¡å‘é€ä¾¿å› è¶…æ—¶è€Œè¢«æ¸…ç†äº†ã€‚</p>

<p>åŸºäºæœ€å¤§é‡ä¼ æ¬¡æ•° <code class="language-plaintext highlighter-rouge">maxRetrans</code> ä¸ºæ•°æ®æŠ¥åœ¨å‘é€é˜Ÿåˆ—ä¸­æœ€å¤šé‡ä¼ çš„æ¬¡æ•°ï¼Œå¯ä¿è¯æ•°æ®è‡³å°‘åœ¨ç½‘ç»œä¸­å‘é€ä¸€æ¬¡ï¼Œä½†å¦‚è‹¥å‡ºç°äº†ç½‘ç»œä¸¢åŒ…ï¼Œä¸ä¼šè¿›è¡Œé‡ä¼ ï¼›æ³¨æ„ï¼šåœ¨ usrsctp ä¸­ï¼Œæ­¤å‚æ•°è‡³å°‘è¦é…ç½®ä¸º 1 æ‰èƒ½ä¿è¯è‡³å°‘å‘é€ä¸€æ¬¡ï¼Œä¸ client ä¸åŒã€‚</p>

<h1 id="æ€§èƒ½">æ€§èƒ½</h1>
<p>ä¸¤è€…é»˜è®¤éƒ½è¾ƒå¼±ï¼Œä¸è®ºæ˜¯å…¶å¯é ä¼ è¾“ï¼Œè¿˜æ˜¯ä¸å¯é ä¼ è¾“ï¼ŒæŠ—å¼±ç½‘èƒ½åŠ›å‡è¾ƒå¼±ï¼Œä½†æµ‹è¯•ä¸‹æ¥ usrsctp æ¯” dcsctp è¦å¼ºä¸€äº›ï¼Œä¸è¿‡ usrsctp åŸºäº c å¼€å‘ï¼Œä»£ç ç¼©å†™ã€ç®€å†™ä¸¥é‡ï¼Œéš¾ä»¥é˜…è¯»ç†è§£ï¼Œè€Œ dcsctp åŸºäº C++ å®ç°ï¼Œç›¸å¯¹è¦å®¹æ˜“ç†è§£ä¸€äº›ï¼›</p>

<h1 id="å¼±ç½‘æ€§èƒ½">å¼±ç½‘æ€§èƒ½</h1>
<p>åœ¨å¯é ä¼ è¾“æ¨¡å¼ä¸‹ï¼Œ30% çš„ä¸¢åŒ…å³ä¸ºä¸Šé™ï¼Œæ•´ä½“è¿˜ä¸å¦‚ tcpï¼Œå…·ä½“æ•°æ®æš‚ä¸åˆ—äº†ï¼Œæ›´é«˜çš„ä¸¢åŒ…ç‡æµ‹è¯•æ— æ³•è¿›è¡Œä¸‹å»ã€‚</p>

<h2 id="åŸå› åˆ†æ">åŸå› åˆ†æ</h2>

<h3 id="å‘é€çª—å£">å‘é€çª—å£</h3>

<p>sctp åœ¨æ‹¥å¡æ§åˆ¶ç®—æ³•ä¸Šä¸ tcp ç±»ä¼¼ï¼Œåˆ†ä¸ºæ…¢å¯åŠ¨ã€æ‹¥å¡é¿å…ã€å¿«é€Ÿæ¢å¤ å’Œå¿«é€Ÿé‡ä¼ å‡ ä¸ªé˜¶æ®µã€‚
åœ¨å‡ºç°å¼±ç½‘ï¼Œå³å‡ºç° ä¸¢åŒ… æˆ–è€… é‡ä¼ è¶…æ—¶çš„æƒ…å†µæ—¶ï¼Œå‘é€çª—å£ cwnd å’Œ æ…¢å¯åŠ¨é˜ˆå€¼ ssthresh å‡åŠï¼Œé™ä½è¿‡å¿«ï¼ŒåŒæ—¶å…¶ cwnd æœ€ä½å€¼è¿‡ä½ï¼Œé¦–å…ˆä»è¿™ä¸€ç‚¹è¿›è¡Œå…¥æ‰‹åˆ†æã€‚
ä»¥ä¸‹ Url æ˜¯ RFC ä¸­å¯¹ CWnd å’Œ SStreash çš„é…ç½®ç­–ç•¥ï¼š
	https://datatracker.ietf.org/doc/html/rfc4960#section-6.3.3
	https://datatracker.ietf.org/doc/html/rfc4960#section-7.2.3
åŸæ–‡å¦‚ä¸‹ï¼š</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>7.2.3.  Congestion Control

   Upon detection of packet losses from SACK (see Section 7.2.4), an
   endpoint should do the following:

      ssthresh = max(cwnd/2, 4*MTU)
      cwnd = ssthresh
      partial_bytes_acked = 0

   Basically, a packet loss causes cwnd to be cut in half.

   When the T3-rtx timer expires on an address, SCTP should perform slow
   start by:

      ssthresh = max(cwnd/2, 4*MTU)
      cwnd = 1*MTU

   and ensure that no more than one SCTP packet will be in flight for
   that address until the endpoint receives acknowledgement for
   successful delivery of data to that address.
</code></pre></div></div>
<p>å¤§è‡´æ„æ€å¦‚ä¸‹ï¼š
åœ¨æ£€æµ‹åˆ°ä¸¢åŒ…æ—¶ï¼Œæ›´æ–° sstresh å’Œ cwnd æœºåˆ¶å¦‚ä¸‹ï¼š
å¯¹åŸ ssthresh å‡åŠï¼Œä½†æœ€å¤§ä¸º 4 ä¸ª MTU å¤§å°ï¼Œè¿™ä¸ªæ˜¯è‡´å‘½çš„ï¼ŒåŒæ—¶å°† cwnd æ›´æ–°ä¸º ssthreshï¼›
å½“ T3-rtx é‡ä¼ å®šæ—¶å™¨è¶…æ—¶æ—¶ï¼š
å¯¹åŸ ssthresh å‡åŠï¼Œä½†æœ€å¤§ä¸º 4 ä¸ª MTU å¤§å°ï¼Œä½†å¯¹ cwnd æ›´æ–°ä¸ºä»… 1 ä¸ª MTUã€‚
é€šè¿‡ä¸Šè¿°ä¸¤ç§æœºåˆ¶ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œåœ¨é«˜ä¸¢åŒ…ç‡çš„å¼±ç½‘ç¯å¢ƒä¸­ï¼Œå¾ˆå®¹æ˜“è¿›å…¥åˆ°ä¸Šè¿°ä¸¤ç§ case ä¸­ï¼Œç»“åˆ flighting çš„æ•°æ®å¤§å°ï¼Œå¯¼è‡´ sctp åè®®å¯å‘é€æ•°æ®é‡å¥‡å° ï¼ˆcwnd è¿‡å°ï¼‰ï¼ŒåŒæ—¶å› ä¸ºé‡ä¼ åŒ…çš„ä¼˜å…ˆçº§é«˜äºæ–°ç”Ÿæˆçš„æ•°æ®åŒ…ï¼Œå¯¼è‡´åè®®å”¯ä¸€çš„ä¸€ä¸ªå‘é€çª—å£ä¸€ç›´åœ¨é‡ä¼ æ—§åŒ…ï¼Œæ–°åŒ…å¾ˆéš¾è·å–å‘é€æœºä¼šï¼Œè¿™å°±å¯¼è‡´äº†æ˜æ˜¾çš„é˜Ÿå¤´é˜»å¡ç°è±¡ã€‚
è§£å†³æ–¹æ¡ˆï¼šç›®æ ‡åªæ˜¯ä¸ºäº†ä¸ä½¿ CWnd çš„å¤§å°é™ä½çš„è¿‡å¿«ï¼Œå³åœ¨æ£€æµ‹åˆ°ä¸¢åŒ…å’Œ T3-rtx è¶…æ—¶æ—¶ï¼Œä¸è¦ç«‹å³å¯¹ ssthresh å‡åŠï¼Œè€Œæ˜¯æ›´åŠ å¹³æ»‘çš„å»é™ä½ï¼Œå¹¶ä¸”æé«˜æœ€å°å€¼çš„ä¸Šé™ï¼Œé€šè¿‡è¿™ä¸¤ç§ç­–ç•¥çš„ä¼˜åŒ–ï¼Œå¯ä»¥ä¿è¯ sctp åè®®æœ‰å¾ˆé«˜çš„å¸¦å®½æŠ¢å èƒ½åŠ›ï¼Œå› ä¸ºå‘é€çª—å£è¶Šå¤§ï¼Œå¸¦å®½æŠ¢å èƒ½åŠ›å°±è¶Šé«˜ã€‚</p>

<h3 id="æ¸…ç©ºé˜Ÿåˆ—">æ¸…ç©ºé˜Ÿåˆ—</h3>

<p>é€šè¿‡ä¸Šè¿°ç­–ç•¥ä¼˜åŒ–å‘é€çª—å£åï¼Œå¯ä»¥å¤§å¹…åº¦æé«˜ sctp åœ¨å¼±ç½‘ï¼ˆåŒå‘å„30%ä¸¢åŒ…ç‡ï¼‰ä¸‹çš„å¸¦å®½ä¼ è¾“èƒ½åŠ›ï¼Œä½†æ˜¯åœ¨æ›´æç«¯çš„ç½‘æŸï¼ˆ40%ä¸¢åŒ…ï¼Œç”šè‡³æ›´é«˜ï¼‰åœºæ™¯ä¸‹ï¼Œä¾ç„¶ä¼šå‡ºç°é˜Ÿå¤´é˜»å¡ç°è±¡ï¼Œå‘é€ç«¯ä¸å†ä¸»åŠ¨å‘é€æ–°æ’å…¥çš„æ•°æ®ï¼Œè€Œæ˜¯ä¼˜å…ˆå‘é€æ—§åŒ…ï¼ˆæœªæ”¶åˆ° Ackï¼‰ï¼Œåœ¨å®é™…åº”ç”¨åœºæ™¯ä¸­ï¼Œæˆ‘ä»¬å¸Œæœ›ä¸è®ºæ˜¯å¦æ”¶åˆ°å¯¹ç«¯çš„ç¡®è®¤ï¼Œéƒ½ä¸åº”è¯¥é˜»å¡æ–°åŒ…çš„å‘é€ï¼Œå’Œæ—§åŒ…çš„æ¸…ç†ï¼Œä»¥ä¿è¯å‘é€é˜Ÿåˆ—æœ‰ä¸€ä¸ªå¿«é€Ÿçš„æ¸…ç†é€Ÿåº¦ï¼Œä¸”ä¿è¯æ‰€æœ‰çš„æ•°æ®å‡æœ‰æœºä¼šè¢«å¿«é€Ÿçš„å‘é€åˆ°ç½‘ç»œä¸­å»ã€‚
å¦‚æœåŒæ–¹å‡ä¸ºå¼€æºçš„å®ç°ï¼Œæˆ‘ä»¬å¯ä»¥éšæ„ä¿®æ”¹ sctpï¼Œå¯å¿«é€Ÿè§£å†³ä¸Šè¿°é—®é¢˜ï¼Œä½†æ˜¯å½“ä¸€ç«¯ä¸ºæµè§ˆå™¨æ—¶ï¼Œæˆ‘ä»¬åªèƒ½è€ƒè™‘ä¿®æ”¹ Server ä¾§çš„åè®®å®ç°ï¼Œä»¥æœŸå¯ä»¥é—´æ¥çš„å½±å“åˆ°å¯¹ç«¯ï¼ˆæµè§ˆå™¨ï¼‰ï¼Œè®©å¯¹ç«¯ï¼ˆæµè§ˆå™¨ï¼‰æœ€ä¸ºå‘é€ç«¯æ—¶ï¼Œå¯ä»¥å¿«é€Ÿçš„æ¸…ç©ºå‘é€é˜Ÿåˆ—ï¼Œé¿å…é˜Ÿå¤´é˜»å¡ï¼Œç­”æ¡ˆå°±åœ¨ SACK åŒ…ä¸­ï¼Œé¦–å…ˆçœ‹ä¸‹ SACK åŒ…çš„åè®®å®šä¹‰ï¼š
https://datatracker.ietf.org/doc/html/rfc4960#section-3.3.4</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>3.3.4.  Selective Acknowledgement (SACK) (3)

   This chunk is sent to the peer endpoint to acknowledge received DATA
   chunks and to inform the peer endpoint of gaps in the received
   subsequences of DATA chunks as represented by their TSNs.

   The SACK MUST contain the Cumulative TSN Ack, Advertised Receiver
   Window Credit (a_rwnd), Number of Gap Ack Blocks, and Number of
   Duplicate TSNs fields.

   By definition, the value of the Cumulative TSN Ack parameter is the
   last TSN received before a break in the sequence of received TSNs
   occurs; the next TSN value following this one has not yet been
   received at the endpoint sending the SACK.  This parameter therefore
   acknowledges receipt of all TSNs less than or equal to its value.

   The handling of a_rwnd by the receiver of the SACK is discussed in
   detail in Section 6.2.1.

   The SACK also contains zero or more Gap Ack Blocks.  Each Gap Ack
   Block acknowledges a subsequence of TSNs received following a break
   in the sequence of received TSNs.  By definition, all TSNs
   acknowledged by Gap Ack Blocks are greater than the value of the
   Cumulative TSN Ack.


        0                   1                   2                   3
        0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |   Type = 3    |Chunk  Flags   |      Chunk Length             |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |                      Cumulative TSN Ack                       |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |          Advertised Receiver Window Credit (a_rwnd)           |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       | Number of Gap Ack Blocks = N  |  Number of Duplicate TSNs = X |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |  Gap Ack Block #1 Start       |   Gap Ack Block #1 End        |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       /                                                               /
       \                              ...                              \
       /                                                               /
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |   Gap Ack Block #N Start      |  Gap Ack Block #N End         |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |                       Duplicate TSN 1                         |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       /                                                               /
       \                              ...                              \
       /                                                               /
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |                       Duplicate TSN X                         |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

   Chunk Flags: 8 bits

      Set to all '0's on transmit and ignored on receipt.

   Cumulative TSN Ack: 32 bits (unsigned integer)

      This parameter contains the TSN of the last DATA chunk received in
      sequence before a gap.  In the case where no DATA chunk has been
      received, this value is set to the peer's Initial TSN minus one.

   Advertised Receiver Window Credit (a_rwnd): 32 bits (unsigned
   integer)

      This field indicates the updated receive buffer space in bytes of
      the sender of this SACK; see Section 6.2.1 for details.

   Number of Gap Ack Blocks: 16 bits (unsigned integer)

      Indicates the number of Gap Ack Blocks included in this SACK.

   

   Number of Duplicate TSNs: 16 bit

      This field contains the number of duplicate TSNs the endpoint has
      received.  Each duplicate TSN is listed following the Gap Ack
      Block list.

   Gap Ack Blocks:

      These fields contain the Gap Ack Blocks.  They are repeated for
      each Gap Ack Block up to the number of Gap Ack Blocks defined in
      the Number of Gap Ack Blocks field.  All DATA chunks with TSNs
      greater than or equal to (Cumulative TSN Ack + Gap Ack Block
      Start) and less than or equal to (Cumulative TSN Ack + Gap Ack
      Block End) of each Gap Ack Block are assumed to have been received
      correctly.

   Gap Ack Block Start: 16 bits (unsigned integer)

      Indicates the Start offset TSN for this Gap Ack Block.  To
      calculate the actual TSN number the Cumulative TSN Ack is added to
      this offset number.  This calculated TSN identifies the first TSN
      in this Gap Ack Block that has been received.

   Gap Ack Block End: 16 bits (unsigned integer)

      Indicates the End offset TSN for this Gap Ack Block.  To calculate
      the actual TSN number, the Cumulative TSN Ack is added to this
      offset number.  This calculated TSN identifies the TSN of the last
      DATA chunk received in this Gap Ack Block.
</code></pre></div></div>

<p>æ¯ä¸€ä¸ª SACK åŒ…ä¸­ï¼Œå‡åŒ…æ‹¬ä¸€ä¸ªå­—æ®µï¼š<code class="language-plaintext highlighter-rouge">Cumulative TSN</code>ï¼Œè¯¥å­—æ®µæ ‡è¯†æ¥æ”¶ç«¯å·²ç¡®è®¤ï¼ˆé€šçŸ¥ç»™ Applicationï¼‰çš„æœ€å¤§åŒ…åºå·ï¼ˆTSNï¼‰ï¼Œé€šè¿‡æ­¤å­—æ®µå‘Šè¯‰å‘é€ç«¯ï¼Œä¸è¦å†å‘é€å°äºæ­¤ TSN çš„åŒ…ï¼Œå¹¶æ¸…ç©ºæ‰€æœ‰é˜Ÿåˆ—ä¸­ï¼Œå°äºç­‰äºæ­¤ TSN çš„æ•°æ®åŒ…ï¼Œå…¶å®ƒçš„å­—æ®µå‡ä¸æ˜¯æœ€é‡è¦çš„ï¼Œå¯ä»¥è‡ªè¡Œå†³å®šæ˜¯å¦è°ƒæ•´ã€‚
åªæœ‰å½“å‘é€ç«¯ä¸æ–­çš„æ¥æ”¶åˆ°æ¥æ”¶ç«¯å‘æ¥çš„ SACK åŒ…åï¼Œé€šè¿‡å…¶æºå¸¦çš„å¼ºåˆ¶å‰ç§»çš„ <code class="language-plaintext highlighter-rouge">Cumulative TSN</code> æ¥æ¸…ç†æœ¬åœ°çš„å‘é€é˜Ÿåˆ—ï¼Œå¯ä»¥ä¿è¯è‡ªå·±çš„å‘é€é˜Ÿåˆ—ä¸€ç›´å¤„äºä¸€ä¸ªè¾ƒå°çš„ Cacheï¼Œè¿™æ ·ï¼Œæ–°æ’å…¥çš„æ•°æ®åŒ…ä¾¿å¯ä»¥è¢«å¿«é€Ÿçš„å‘é€å‡ºå»ï¼Œé¿å…äº†å› æ—§åŒ…æœªè¢« Ack è€Œå¯¼è‡´çš„é˜Ÿå¤´é˜»å¡é—®é¢˜ï¼Œæ›´åŠ çš„è´´è¿‘ UDP çš„è¡Œä¸ºã€‚</p>

<p>Okï¼Œé‚£ä¹ˆå›æº¯ä¸‹è¿™ä¸ªé—®é¢˜çš„ä¸Šä¸€æ­¥ï¼šä¸ºä»€ä¹ˆå‘é€ç«¯æ— æ³•å¿«é€Ÿçš„æ¸…ç©ºè‡ªå·±çš„å‘é€é˜Ÿåˆ—çš„å‘¢ï¼Ÿæˆ‘ä»¬çœ‹ä¸‹ RFC çš„å®šä¹‰ä¾¿çŸ¥ï¼Œhttps://datatracker.ietf.org/doc/html/rfc4960#section-6.1
åŸæ–‡å¦‚ä¸‹ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>6.1.  Transmission of DATA Chunks

   This document is specified as if there is a single retransmission
   timer per destination transport address, but implementations MAY have
   a retransmission timer for each DATA chunk.

   The following general rules MUST be applied by the data sender for
   transmission and/or retransmission of outbound DATA chunks:

   A) At any given time, the data sender MUST NOT transmit new data to
      any destination transport address if its peer's rwnd indicates
      that the peer has no buffer space (i.e., rwnd is 0; see Section
      6.2.1).  However, regardless of the value of rwnd (including if it
      is 0), the data sender can always have one DATA chunk in flight to
      the receiver if allowed by cwnd (see rule B, below).  This rule
      allows the sender to probe for a change in rwnd that the sender
      missed due to the SACK's having been lost in transit from the data
      receiver to the data sender.

      When the receiver's advertised window is zero, this probe is
      called a zero window probe.  Note that a zero window probe SHOULD
      only be sent when all outstanding DATA chunks have been
      cumulatively acknowledged and no DATA chunks are in flight.  Zero
      window probing MUST be supported.

      If the sender continues to receive new packets from the receiver
      while doing zero window probing, the unacknowledged window probes
      should not increment the error counter for the association or any
      destination transport address.  This is because the receiver MAY
      keep its window closed for an indefinite time.  Refer to Section
      6.2 on the receiver behavior when it advertises a zero window.
      The sender SHOULD send the first zero window probe after 1 RTO
      when it detects that the receiver has closed its window and SHOULD
      increase the probe interval exponentially afterwards.  Also note
      that the cwnd SHOULD be adjusted according to Section 7.2.1.  Zero
      window probing does not affect the calculation of cwnd.

      The sender MUST also have an algorithm for sending new DATA chunks
      to avoid silly window syndrome (SWS) as described in [RFC0813].
      The algorithm can be similar to the one described in Section
      4.2.3.4 of [RFC1122].

      However, regardless of the value of rwnd (including if it is 0),
      the data sender can always have one DATA chunk in flight to the
      receiver if allowed by cwnd (see rule B below).  This rule allows
      the sender to probe for a change in rwnd that the sender missed
      due to the SACK having been lost in transit from the data receiver
      to the data sender.

   B) At any given time, the sender MUST NOT transmit new data to a
      given transport address if it has cwnd or more bytes of data
      outstanding to that transport address.

   C) When the time comes for the sender to transmit, before sending new
      DATA chunks, the sender MUST first transmit any outstanding DATA
      chunks that are marked for retransmission (limited by the current
      cwnd).

   D) When the time comes for the sender to transmit new DATA chunks,
      the protocol parameter Max.Burst SHOULD be used to limit the
      number of packets sent.  The limit MAY be applied by adjusting
      cwnd as follows:

      if((flightsize + Max.Burst*MTU) &lt; cwnd) cwnd = flightsize +
      Max.Burst*MTU

      Or it MAY be applied by strictly limiting the number of packets
      emitted by the output routine.

   E) Then, the sender can send out as many new DATA chunks as rule A
      and rule B allow.

   Multiple DATA chunks committed for transmission MAY be bundled in a
   single packet.  Furthermore, DATA chunks being retransmitted MAY be
   bundled with new DATA chunks, as long as the resulting packet size
   does not exceed the path MTU.  A ULP may request that no bundling is
   performed, but this should only turn off any delays that an SCTP
   implementation may be using to increase bundling efficiency.  It does
   not in itself stop all bundling from occurring (i.e., in case of
   congestion or retransmission).

   Before an endpoint transmits a DATA chunk, if any received DATA
   chunks have not been acknowledged (e.g., due to delayed ack), the
   sender should create a SACK and bundle it with the outbound DATA
   chunk, as long as the size of the final SCTP packet does not exceed
   the current MTU.  See Section 6.2.

   IMPLEMENTATION NOTE: When the window is full (i.e., transmission is
   disallowed by rule A and/or rule B), the sender MAY still accept send
   requests from its upper layer, but MUST transmit no more DATA chunks
   until some or all of the outstanding DATA chunks are acknowledged and
   transmission is allowed by rule A and rule B again.

   Whenever a transmission or retransmission is made to any address, if
   the T3-rtx timer of that address is not currently running, the sender
   MUST start that timer.  If the timer for that address is already
   running, the sender MUST restart the timer if the earliest (i.e.,
   lowest TSN) outstanding DATA chunk sent to that address is being
   retransmitted.  Otherwise, the data sender MUST NOT restart the
   timer.

   When starting or restarting the T3-rtx timer, the timer value must be
   adjusted according to the timer rules defined in Sections 6.3.2 and
   6.3.3.

   Note: The data sender SHOULD NOT use a TSN that is more than 2**31 -
   1 above the beginning TSN of the current send window.
</code></pre></div></div>

<p>æ ¹æ®ä¸Šè¿°å®šä¹‰ï¼Œå†ç»“åˆä¸Šé¢ CWND çš„æ›´æ–°ç­–ç•¥ï¼Œå¯ä»¥æ¨æµ‹å‡ºï¼Œåœ¨é«˜ä¸¢åŒ…çš„å¼±ç½‘æƒ…å†µä¸‹ï¼ŒSender å¾ˆå®¹æ˜“ Trigger å› è¿ç»­æœªæ”¶åˆ° Receiver çš„ Ackï¼ŒåŒæ—¶è‡ªå·±çš„ Inflighting æ•°æ®é‡è¾ƒå¤šï¼Œå¯¼è‡´è‡ªå·±å¯å‘é€çš„æ•°æ®é‡éå¸¸å°ï¼ˆæœ€å°ä¸º 1 ä¸ª MTUï¼‰ï¼Œç”šè‡³å‘é€ 0 Bytes çš„æ¢æµ‹åŒ…ä»£æ›¿ï¼Œä»è€Œå‡ºç°ä¸¥é‡çš„å¯¹å¤´é˜»å¡é—®é¢˜ã€‚</p>

<blockquote>
  <p>ä½†æ˜¯æŒ‰ç…§ä¸Šè¿°æ–¹æ¡ˆé€šè¿‡æ¥æ”¶ç«¯å¼ºåˆ¶åç§» TSNï¼Œä»¥è¾¾åˆ°å‘é€ç«¯å¿«é€Ÿæ¸…ç©ºå‘é€é˜Ÿåˆ—çš„ç›®æ ‡æ—¶ï¼ŒDataChannel/SCTP çš„å¯é ä¼ è¾“èƒ½åŠ›ä¾¿ä¸§å¤±äº†ã€‚</p>
</blockquote>

<h3 id="sack-chunk-æºç ">SACK Chunk æºç </h3>

<p>é¦–å…ˆæ•´ç†ä¸‹ sctp åè®®å†…æ¥æ”¶ç«¯ç»„è£…sack çš„æ•°æ®ç»“æ„ ï¼ˆhttps://tools.ietf.org/html/rfc4960#section-3.3.4ï¼‰ï¼Œåœ¨ dcsctp çš„ä»£ç ä¸­æ¯”è¾ƒæ˜“æ‡‚ï¼Œå®šä¹‰å¦‚ä¸‹ï¼š</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">SackChunk</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Chunk</span><span class="p">,</span> <span class="k">public</span> <span class="n">TLVTrait</span><span class="o">&lt;</span><span class="n">SackChunkConfig</span><span class="o">&gt;</span> <span class="p">{</span>
 <span class="nl">public:</span>
  <span class="k">static</span> <span class="k">constexpr</span> <span class="kt">int</span> <span class="n">kType</span> <span class="o">=</span> <span class="n">SackChunkConfig</span><span class="o">::</span><span class="n">kType</span><span class="p">;</span>

  <span class="c1">// å¯ä»¥çœ‹å‡ºåŒ…åºå·ä½¿ç”¨çš„æ˜¯ uint16_tï¼Œåªéœ€ä¸¤ä¸ªå­—èŠ‚  </span>
  <span class="k">struct</span> <span class="nc">GapAckBlock</span> <span class="p">{</span>
    <span class="n">GapAckBlock</span><span class="p">(</span><span class="kt">uint16_t</span> <span class="n">start</span><span class="p">,</span> <span class="kt">uint16_t</span> <span class="n">end</span><span class="p">)</span> <span class="o">:</span> <span class="n">start</span><span class="p">(</span><span class="n">start</span><span class="p">),</span> <span class="n">end</span><span class="p">(</span><span class="n">end</span><span class="p">)</span> <span class="p">{}</span>

    <span class="kt">uint16_t</span> <span class="n">start</span><span class="p">;</span>
    <span class="kt">uint16_t</span> <span class="n">end</span><span class="p">;</span>

    <span class="kt">bool</span> <span class="k">operator</span><span class="o">==</span><span class="p">(</span><span class="k">const</span> <span class="n">GapAckBlock</span><span class="o">&amp;</span> <span class="n">other</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span>
      <span class="k">return</span> <span class="n">start</span> <span class="o">==</span> <span class="n">other</span><span class="p">.</span><span class="n">start</span> <span class="o">&amp;&amp;</span> <span class="n">end</span> <span class="o">==</span> <span class="n">other</span><span class="p">.</span><span class="n">end</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">};</span>

  <span class="n">SackChunk</span><span class="p">(</span><span class="n">TSN</span> <span class="n">cumulative_tsn_ack</span><span class="p">,</span>
            <span class="kt">uint32_t</span> <span class="n">a_rwnd</span><span class="p">,</span>
            <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">GapAckBlock</span><span class="o">&gt;</span> <span class="n">gap_ack_blocks</span><span class="p">,</span>
            <span class="n">std</span><span class="o">::</span><span class="n">set</span><span class="o">&lt;</span><span class="n">TSN</span><span class="o">&gt;</span> <span class="n">duplicate_tsns</span><span class="p">)</span>
      <span class="o">:</span> <span class="n">cumulative_tsn_ack_</span><span class="p">(</span><span class="n">cumulative_tsn_ack</span><span class="p">),</span>
        <span class="n">a_rwnd_</span><span class="p">(</span><span class="n">a_rwnd</span><span class="p">),</span>
        <span class="n">gap_ack_blocks_</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">gap_ack_blocks</span><span class="p">)),</span>
        <span class="n">duplicate_tsns_</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">duplicate_tsns</span><span class="p">))</span> <span class="p">{}</span>
  <span class="k">static</span> <span class="n">absl</span><span class="o">::</span><span class="n">optional</span><span class="o">&lt;</span><span class="n">SackChunk</span><span class="o">&gt;</span> <span class="n">Parse</span><span class="p">(</span><span class="n">rtc</span><span class="o">::</span><span class="n">ArrayView</span><span class="o">&lt;</span><span class="k">const</span> <span class="kt">uint8_t</span><span class="o">&gt;</span> <span class="n">data</span><span class="p">);</span>

  <span class="kt">void</span> <span class="n">SerializeTo</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">uint8_t</span><span class="o">&gt;&amp;</span> <span class="n">out</span><span class="p">)</span> <span class="k">const</span> <span class="k">override</span><span class="p">;</span>
  <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">ToString</span><span class="p">()</span> <span class="k">const</span> <span class="k">override</span><span class="p">;</span>
  <span class="n">TSN</span> <span class="n">cumulative_tsn_ack</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">cumulative_tsn_ack_</span><span class="p">;</span> <span class="p">}</span>
  <span class="kt">uint32_t</span> <span class="n">a_rwnd</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">a_rwnd_</span><span class="p">;</span> <span class="p">}</span>
  <span class="n">rtc</span><span class="o">::</span><span class="n">ArrayView</span><span class="o">&lt;</span><span class="k">const</span> <span class="n">GapAckBlock</span><span class="o">&gt;</span> <span class="n">gap_ack_blocks</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">gap_ack_blocks_</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">set</span><span class="o">&lt;</span><span class="n">TSN</span><span class="o">&gt;&amp;</span> <span class="n">duplicate_tsns</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">duplicate_tsns_</span><span class="p">;</span> <span class="p">}</span>

 <span class="k">private</span><span class="o">:</span>
  <span class="k">static</span> <span class="k">constexpr</span> <span class="kt">size_t</span> <span class="n">kGapAckBlockSize</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
  <span class="k">static</span> <span class="k">constexpr</span> <span class="kt">size_t</span> <span class="n">kDupTsnBlockSize</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>

  <span class="k">const</span> <span class="n">TSN</span> <span class="n">cumulative_tsn_ack_</span><span class="p">;</span>             <span class="c1">// æœ€å¤§å·²ç¡®è®¤åŒ…åºå·ï¼ŒTSN å³ä¸ºå†…éƒ¨ä¼ è¾“å—çš„åºå·</span>
  <span class="k">const</span> <span class="kt">uint32_t</span> <span class="n">a_rwnd_</span><span class="p">;</span>                    <span class="c1">// æ¥æ”¶çª—å£çš„å¤§å°</span>
  <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">GapAckBlock</span><span class="o">&gt;</span> <span class="n">gap_ack_blocks_</span><span class="p">;</span>  <span class="c1">// GAP åŒ…åºå·èŒƒå›´ï¼Œä¸€æ¬¡èšåˆå¤šä¸ª</span>
  <span class="n">std</span><span class="o">::</span><span class="n">set</span><span class="o">&lt;</span><span class="n">TSN</span><span class="o">&gt;</span> <span class="n">duplicate_tsns_</span><span class="p">;</span>             <span class="c1">// æ”¶åˆ°çš„å·²ç¡®è®¤çš„åŒ…åºå·</span>
<span class="p">};</span>
</code></pre></div></div>

<p>è¿™é‡Œï¼Œå¯èƒ½æœ‰äº›ç–‘é—®ï¼Œæ¯æ¬¡æ‰“åŒ…çš„ SACK ä¸­ï¼Œå…¶ gap_ack_blocks_ å’Œ duplicate_tsns_ æ˜¯å¦æœ‰æœ€å¤§ä¸ªæ•°/é•¿åº¦é™åˆ¶ï¼Œå› ä¸ºå®ƒä»¬ä¸¤ä¸ªæ¯•ç«Ÿæ˜¯è¦å…¨éƒ¨ä¸€ä¸ªä¸ªçš„åºåˆ—åŒ–åˆ°ç½‘ç»œåŒ…ä¸­çš„ï¼Œç­”æ¡ˆæ˜¯ï¼šæœ‰çš„ã€‚
ä¸¤è€… gap_ack_blocks_ å’Œ duplicate_tsns_ å•æ¬¡é™åˆ¶ä¸Šé™ä¸º 20 ä¸ªï¼ŒkMaxGapAckBlocksReported å’Œ kMazhimaxDuplicateTsnReported å‡å®šä¹‰ä¸º constexpr å€¼ï¼š20ï¼Œå£°æ˜åœ¨ä»£ç æ–‡ä»¶ï¼šdata_tracker.hä¸­ã€‚</p>

<h3 id="sack-å‘åŒ…æ—¶æœº">SACK å‘åŒ…æ—¶æœº</h3>

<p>åœ¨ dcsctp çš„å®ç°ä¸­ï¼Œsack çš„å‘é€æ—¶æœºæ˜¯åŠ¨æ€çš„ã€‚åœ¨æ²¡æœ‰æ•°æ®åŒ…ä¸¢å¤±æ—¶ï¼Œæ¯ç§’é’Ÿå‘é€ä¸€æ¬¡ï¼Œå½“ç›‘æµ‹åˆ°ä¸¢åŒ…æ—¶ï¼Œé’ˆå¯¹æ¯ä¸ªæ•°æ®åŒ…å‘é€ä¸€æ¬¡ sackï¼›å½“ä¸ç›´æ¥å‘é€ SACKS æ—¶ï¼Œå°†ä½¿ç”¨ timer æ§åˆ¶ sack çš„å»¶è¿Ÿå‘é€ï¼Œæ¯”å¦‚ min(RTO/2ï¼Œ200ms)ã€‚</p>

<p>å‘é€ç«¯æ¥æ”¶åˆ°å¯¹ç«¯å›åº”çš„ SACK åï¼Œåˆ¤æ–­å¦‚æœå…¶ cumulative tsn æ¯”æœ¬åœ°è®°å½•çš„æœ€å¤§çš„ last cumulative tsn è¦å¤§ï¼ˆå³æ²¡æœ‰å›é€€ï¼‰ï¼Œåˆ™é‡å¯ ts_rtx_ å®šæ—¶å™¨ã€‚</p>

<h1 id="é—ç•™é—®é¢˜">é—ç•™é—®é¢˜</h1>

<h2 id="rtt-è®¡ç®—">RTT è®¡ç®—</h2>

<p>æœ‰æ˜æ˜¾é—®é¢˜ï¼Œå¦‚ä¸‹ä¸¤ç§ï¼š
åœ¨ dcsctp ä¸­çœ‹åˆ° RTT çš„è®¡ç®—æ˜¯æœ‰æ¼æ´çš„ï¼Œå…¶åœ¨ sack ä¸­æ²¡æœ‰ gap_ack_blocks æ—¶ï¼Œé€šè¿‡ cumulative tsn è®¡ç®—å…¶ rttï¼Œå­˜åœ¨ä¸¤ç§é£é™©:</p>
<ul>
  <li>è¿™ä¸ª sack æ•´ä½“æ˜¯æœ‰å»¶è¿Ÿçš„ï¼Œå…¶è®¡ç®— rtt æ—¶ï¼Œæ˜¯ç›´æ¥é€šè¿‡ sendts - current tsï¼Œæ˜æ˜¾æ²¡æœ‰è€ƒè™‘ delay ack timeï¼›</li>
  <li>å…¶åªæœ‰åœ¨æ²¡æœ‰ gap_ack_blocks æ—¶ï¼Œå³æ²¡æœ‰å‡ºç°ä¸¢åŒ…æ—¶æ‰ç»Ÿè®¡å…¶ RTTï¼Œè¿™æ ·åœ¨ä¸¢åŒ…ä¸¥é‡æ—¶ï¼Œå¯èƒ½ä¼šå‡ºç°é•¿æ—¶é—´æ— æ³•æ›´æ–° rttï¼Œæˆ–è€…åœ¨ rtt å’Œ loss çªç„¶å¢å¤§æ—¶ï¼Œå‡ºç°é•¿æ—¶é—´æ— æ³•æ›´æ–° rtt çš„æƒ…å†µï¼Œä¸€ç›´ä»¥æ—§çš„ rtt ä¸ºå‡†ã€‚</li>
</ul>

            <div class="post-copyright">
              <p>
                <span>ç‰ˆæƒå£°æ˜ï¼š</span>
                å¦‚æ— ç‰¹åˆ«å£°æ˜ï¼Œæœ¬æ–‡ç‰ˆæƒå½’
                <a href="https://gbcpp.github.io" class="cplink">Mr Chen</a>
                æ‰€æœ‰ï¼Œè½¬è½½è¯·æ³¨æ˜æœ¬æ–‡é“¾æ¥ã€‚ 
              </p>
              
                <p> 
                  ï¼ˆé‡‡ç”¨ 
                  <a href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank" class="extlinks">CC BY-NC-SA 4.0</a> 
                  è®¸å¯åè®®è¿›è¡Œæˆæƒï¼‰
                </p>
              
              <p><span>æœ¬æ–‡æ ‡é¢˜ï¼š</span>ã€Š RtcDataChannel(sctp) protocol optimize ã€‹</p>
              <p><span>æœ¬æ–‡é“¾æ¥ï¼š</span><a href="https://gbcpp.github.io/protocol/sctp-optimize.html" class="cplink">https://gbcpp.github.io/protocol/sctp-optimize.html</a></p>
              <p class="tips">æœ¬æ–‡æœ€åä¸€æ¬¡æ›´æ–°ä¸º <span></span> å¤©å‰ï¼Œæ–‡ç« ä¸­çš„æŸäº›å†…å®¹å¯èƒ½å·²è¿‡æ—¶ï¼</p>
            </div>
          </article>
        </div>   
        <div class="table-of-contents">
          <h2>ç›®å½•</h2>
          <ul><li><a onclick="scrollToAdjust('datachannel-å®ç°')">DataChannel å®ç°</a></li><li><a onclick="scrollToAdjust('èƒ½åŠ›æ¦‚è¿°')">èƒ½åŠ›æ¦‚è¿°</a></li><li><a onclick="scrollToAdjust('æ€§èƒ½')">æ€§èƒ½</a></li><li><a onclick="scrollToAdjust('å¼±ç½‘æ€§èƒ½')">å¼±ç½‘æ€§èƒ½</a><ul><li><a onclick="scrollToAdjust('åŸå› åˆ†æ')">åŸå› åˆ†æ</a><ul><li><a onclick="scrollToAdjust('å‘é€çª—å£')">å‘é€çª—å£</a></li><li><a onclick="scrollToAdjust('æ¸…ç©ºé˜Ÿåˆ—')">æ¸…ç©ºé˜Ÿåˆ—</a></li><li><a onclick="scrollToAdjust('sack-chunk-æºç ')">SACK Chunk æºç </a></li><li><a onclick="scrollToAdjust('sack-å‘åŒ…æ—¶æœº')">SACK å‘åŒ…æ—¶æœº</a></li></ul></li></ul></li><li><a onclick="scrollToAdjust('é—ç•™é—®é¢˜')">é—ç•™é—®é¢˜</a><ul><li><a onclick="scrollToAdjust('rtt-è®¡ç®—')">RTT è®¡ç®—</a></li></ul></li></ul>
        </div>
      </div>
      

      
      <div class="social-share-wrapper">
        <div class="social-share"></div>
      </div>
      
    </div>

    <div>
     
     <section class="post-footer-item comment" style="padding-bottom: 4em">
     <div id="gitalk_container"></div>
     <div id="disqus_thread"></div>
     </section>
     
    </div>

    <section class="author-detail">
      <section class="post-footer-item author-card">
        <div class="avatar">
          <img src="/assets/img/wx_avatar.jpg" alt="">
        </div>
        <div class="author-name" rel="author">Mr Chen</div>
        <div class="bio">
          <p>èµ„æ·±æµåª’ä½“å¼€å‘å·¥ä½œè€…</p>
        </div>
        
        <ul class="sns-links">
          
          <li>
            <a href="https://github.com/gbcpp" target="_blank" aria-label="github">
              <svg class="icon" aria-hidden="true">
                <use xlink:href="#icon-github"></use>
              </svg>
            </a>
          </li>
          
          <li>
            <a href="https://blog.csdn.net/m0_59561186?spm=1010.2135.3001.5343)" target="_blank" aria-label="csdn">
              <svg class="icon" aria-hidden="true">
                <use xlink:href="#icon-csdn"></use>
              </svg>
            </a>
          </li>
          
        </ul>
        
      </section>
      <section class="post-footer-item read-next">
        
        <div class="read-next-item">
          <a href="/service-bind-cpu.html" class="read-next-link" aria-label="åå°æœåŠ¡ç»‘å®š CPU æ ¸"></a>
          <section>
            <span>åå°æœåŠ¡ç»‘å®š CPU æ ¸</span>
            <p>  ä¸€ä¸ª Prod ç”¨çš„æœåŠ¡å¯åŠ¨å‡çº§è„šæœ¬ï¼Œæ£€æŸ¥äº† CPU æ ¸å¿ƒæ•°ï¼Œå¹¶æŒ‰ç…§æŒ‡å®šé¡ºåºç»‘å®š CPU æ ¸å¿ƒï¼Œä»¥æå‡æ€§èƒ½ã€‚</p>
          </section>
          
      </div>
        

        
        <div class="read-next-item">
          <a href="/packet_number.html" class="read-next-link" aria-label="ç½‘ç»œåŒ…åºå·å›ç»•"></a>
            <section>
              <span>ç½‘ç»œåŒ…åºå·å›ç»•</span>
              <p>  Transform your plain text into static websites and blogs.</p>
            </section>
            
        </div>
        
      </section>
      
   
      

      
    </section>

  
  <script>
    var gitalk = new Gitalk({
      id: '2023-09-30 00:00:00 +0000',
      clientID: '7795ee35cc3373147f6e',  //è¿™é‡Œå…¶å®å¯ä»¥ç›´æ¥å¡«å€¼ï¼Œä½†æ˜¯è€ƒè™‘åˆ°é¡µé¢å®‰å…¨æ€§ï¼Œè¿˜æ˜¯é€šè¿‡é…ç½®çš„æ–¹å¼æ·»åŠ 
      clientSecret: '3c90889603d18c17cfd73289591b50a716925392',
      repo: 'gbcpp.github.io',
      owner: 'gbcpp',
      admin: 'gbcpp',
      distractionFreeMode: 'true'
    })

    gitalk.render('disqus_thread')
  </script>
  

    


<footer class="g-footer">
  <div class="g-container">
    <div class="g-left">
      <section class="links">
        æœ¬ç«™ç”± <a href="//jekyllrb.com" target="_blank" class="extlinks">Jekyll</a> å’Œ (åŸºäº <a href="https://github.com/kaeyleo/jekyll-theme-H2O" target="_blank" class="extlinks">H2O</a> çš„) <a href="https://github.com/zhonger/jekyll-theme-H2O-ac" target="_blank" class="extlinks">H2O-ac</a> å¼ºåŠ›é©±åŠ¨
         (<a href="https://github.com/zhonger/jekyll-theme-H2O-ac/releases/tag/v.1.2.1" target="_blank" class="extlinks">v1.2.1</a>)  
        
      </section>
      <section class="links">Mr Chen Â©
        
        
          2023
          -
        
        2025
        
          <a href="https://beian.miit.gov.cn/" target="_blank" class="extlinks">æ²ªICPå¤‡xxxxxxxxå·</a>
        
      </section>
      
      <section>
        <span id="busuanzi_container_site_pv">
          ğŸ‘ï¸ æ€»æµè§ˆé‡ <span id="busuanzi_value_site_pv"></span> <b>Â·</b>
        </span>
        <span id="busuanzi_container_site_uv">
          ğŸ‘¤ æ€»è®¿é—®é‡ <span id="busuanzi_value_site_uv"></span>
        </span>
      </section>
      
      <section>
        
      </section>
    </div>
    <div class="g-right">
      
      
    </div>
    
  </div>
</footer>
<div class="cookie-tip">
   ä¸ºäº†æå‡æœ¬ç«™çš„ä½¿ç”¨ä½“éªŒå’Œå¿…è¦åŠŸèƒ½çš„æ­£å¸¸ä½¿ç”¨ï¼Œæœ¬ç«™ä¼šä½¿ç”¨æœ¬åœ° Cookieã€‚è¯¦ç»†è¯·æŸ¥çœ‹ã€Œ <a href="/tos.html">æœ¬ç«™ä½¿ç”¨æ¡æ¬¾</a> ã€äº†è§£æ›´å¤šã€‚

  <button id="accept-tos">åŒæ„</button>
</div>
<button id="list" aria-label="Scroll back to top" class="mobile-list" type="button">
  <svg class="icon list day" aria-hidden="true">
    <use xlink:href="#icon-list-day"></use>
  </svg>
  <svg class="icon list night" aria-hidden="true">
    <use xlink:href="#icon-list-night"></use>
  </svg>
  <svg class="icon exit day" aria-hidden="true">
    <use xlink:href="#icon-exit-day"></use>
  </svg>
  <svg class="icon exit night" aria-hidden="true">
    <use xlink:href="#icon-exit-night"></use>
  </svg>
</button>
<button id="bttb" aria-label="Scroll back to top" class="bttb" type="button">
  <svg class="icon up day" aria-hidden="true">
    <use xlink:href="#icon-up-day"></use>
  </svg>
  <svg class="icon up night" aria-hidden="true">
    <use xlink:href="#icon-up-night"></use>
  </svg>
</button>


    
    <div class="modal">
        <div class="modal-content">
          <header>
            <span class="close">&times;</span>
          </header>
          <div class="container"></div>
        </div>
    </div>
    
  </div>

  <script src="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/js/social-share.min.js"></script>
  <script>
    socialShare('.social-share', {
      sites: [
        
          'wechat'
          ,
          
        
          'weibo'
          ,
          
        
          'douban'
          ,
          
        
          'twitter'
          
        
      ],
      wechatQrcodeTitle: "åˆ†äº«åˆ°å¾®ä¿¡æœ‹å‹åœˆ",
      wechatQrcodeHelper: '<p>æ‰«ç åç‚¹å‡»å³ä¸Šè§’</p><p>å°†æœ¬æ–‡åˆ†äº«è‡³æœ‹å‹åœˆ</p>'
    });
    $("a.social-share-icon").each(function() {
      $(this).attr("aria-label", $(this).attr("class").split(' ')[1])
    });
  </script>

  

  <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/line-numbers/prism-line-numbers.min.js"></script>
  <script src="/assets/js/app.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@4.0/dist/fancybox.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/clipboard/dist/clipboard.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/hotkeys-js/dist/hotkeys.min.js"></script>
  
  <script src="https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js" async></script>
  <script src="https://cdn.jsdelivr.net/npm/dayjs@1.11.2/dayjs.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/dayjs@1.11.2/plugin/customParseFormat.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/dayjs@1.11.2/plugin/relativeTime.js"></script>
  <script>
    /**
    * Better Scroll Experience
    */
    function scrollToAdjust(id){
      var element = document.getElementById(id);
      var headerOffset = 90;
      var elementPosition = element.getBoundingClientRect().top;
      var offsetPosition = elementPosition + window.scrollY - headerOffset;
      window.scrollTo({
          top: offsetPosition,
          behavior: "smooth"
      });
    }
      // ç»™å›¾ç‰‡æ·»åŠ é“¾æ¥
      $(document).ready(function() {
          var baseurl = $("meta[property='og:baseurl']").attr('content');
          $("p img").each(function() {
              $(this).attr('data-src', $(this).attr('src')).removeAttr('src').addClass("lazyload").attr('src', baseurl + '/assets/img/loading.gif');
              var strA = "<a data-fancybox='gallery' ref='gallery' href='" + $(this).attr('data-src') + "' data-caption='" + $(this).attr('alt') + "'></a>";
              $(this).wrapAll(strA);
              var caption = $(this)[0].alt;
              $(this).parent().after('<span class="caption">' + caption + '</span>');
          });

          Fancybox.bind('[data-fancybox]', {
            on: {
              load: (fancybox, slide) => {
                var gray = $("meta[property='og:gray']").attr('content');
                if(gray == "true"){
                    $(".fancybox__content img").addClass("gray");
                    $(".carousel__track .fancybox__thumb").addClass("gray");
                }
              }
            }
          });   
          
          

          if($("#comments-switch").length > 0){
            var comment_status = $("#cmn-toggle-4")[0].checked;
            if(comment_status){
              $("#waline").addClass("active");
            }else {
              $("#disqus_thread").addClass("active");
            }
            $("#cmn-toggle-4").click(function(){
              $("#disqus_thread").toggleClass("active");
              $("#waline").toggleClass("active");
            })
          }else {
            if($("#disqus_thread").length > 0) {
              $("#disqus_thread").addClass("active");
            }else if($("#waline").length > 0) {
              $("#waline").addClass("active");
            }
          }

          var time_formats = ['YYYY-MM-DD HH:mm:ss ZZ', 'YYYY DD MMM HH:mm:ss ZZ', 'YYYYå¹´MMæœˆDDæ—¥ HH:mm:ss ZZ'];
          function dateFormat(date, format){
            var date_org = dayjs(date, time_formats[format]);
            var date     = date_org.format(time_formats[format]);
            return {"date_org": date_org, "date": date}
          }

          dayjs.extend(window.dayjs_plugin_customParseFormat);
          dayjs.extend(window.dayjs_plugin_relativeTime);
          var post_date = $("meta[property='post-date']").attr('content');
          var post_date_format = $("meta[property='post-date-format']").attr('content');
          var local_post_date = dateFormat(post_date, post_date_format);

          $(".post time span.create-at").html(local_post_date["date"]);

          fetch("https://api.github.com/repos/gbcpp/gbcpp.github.io/commits?path=_posts/protocol/2023-09-30-sctp-optimize.md")
          .then((response) => {
            return response.json();
          })
          .then((commits) => {
            if(commits.length != 0){
              var update_at = dayjs(commits[0]['commit']['committer']['date']);
            }else {
              var update_at = post_date
            }

            var local_update_at = dateFormat(update_at, post_date_format);
            $('.post time span.update-at').html(local_update_at["date"]);

            var relative_time = dayjs().diff(local_update_at["date_org"], 'day');
            $(".post-copyright .tips span").append(relative_time);
            if(relative_time > 365){
              $(".post-copyright .tips").addClass("active");
            }
          });   
          
          /*
          * Keyboard shortcut bind: left and right
          */

          var previous_url = $("meta[property='og:previous_url']").attr('content');
          var next_url = $("meta[property='og:next_url']").attr('content');

          hotkeys('left', function(event, handler){
              // Prevent the default refresh event under WINDOWS system
              event.preventDefault();
              if(previous_url){
                  console.log('you pressed left!');
                  window.location.href = previous_url;
              }else {
                  $("#no-previous").addClass("active");
                  setTimeout(function(){$("#no-previous").removeClass("active");}, 1500);
              }
          });

          hotkeys('right', function(event, handler){
              // Prevent the default refresh event under WINDOWS system
              event.preventDefault();
              if(next_url){
                  console.log('you pressed right!');
                  window.location.href = next_url;
              }else {
                  $("#no-next").addClass("active");
                  setTimeout(function(){$("#no-next").removeClass("active");}, 1500);
              }
          });
      });
  </script>
  <script src="https://at.alicdn.com/t/font_3046306_skfh9jzzbbf.js"></script>

  
  
  
<script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  <script>
    if ("serviceWorker" in navigator) {
        if (navigator.serviceWorker.controller) {
            console.log("An active service worker found, no need to register");
        } else {
            // Register the service worker
            navigator.serviceWorker
            .register("/sw.js", {
                scope: "/"
            })
            .then(function (reg) {
                console.log("Service worker has been registered for scope: " + reg.scope);
            });
        }
    }

// æ£€æµ‹æµè§ˆå™¨æ˜¯å¦æ”¯æŒSW
// if(navigator.serviceWorker != null){
//     navigator.serviceWorker.register("/sw.js")
//         .then(function(registartion){
//             console.log('æ”¯æŒsw:',registartion.scope)
//         })
// } else {
//     console.log('ä¸æ”¯æŒsw')
// }
</script>
	<!--
Author: Ray-Eldath
refer to:
 - http://docs.mathjax.org/en/latest/options/index.html
-->

	<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
		jax: ["input/TeX", "output/HTML-CSS"],
		tex2jax: {
			inlineMath: [ ["$", "$"] ],
			displayMath: [ ["$$", "$$"] ],
			skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
		},
		"HTML-CSS": { preferredFont: "TeX", availableFonts: ["STIX","TeX"] }
      });
    </script>

   
    <script src="https://cdn.jsdelivr.net/npm/mermaid@9.1.6/dist/mermaid.min.js"></script>
    <script>
        $(document).ready(function (){
            mermaid.initialize({
                startOnLoad:true,
                theme: "default",
            });
            mermaid.init(undefined, $('.mermaid2'));
        });
    </script>
 
   
</body>

</html>
